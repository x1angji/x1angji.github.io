<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>C++23 新特性完全指南：从语法到实践</title>
      <link href="/2026/02/05/Cpp23%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2026/02/05/Cpp23%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="C-23-新特性完全指南：从语法到实践"><a href="#C-23-新特性完全指南：从语法到实践" class="headerlink" title="C++23 新特性完全指南：从语法到实践"></a>C++23 新特性完全指南：从语法到实践</h1><p>C++23 是 C++20 的”完善版”，修复了边界情况并引入众多实用特性。本文按使用频率和实用性排序，结合实际场景深入分析。</p><hr><h2 id="一、std-expected-⭐⭐⭐⭐⭐"><a href="#一、std-expected-⭐⭐⭐⭐⭐" class="headerlink" title="一、std::expected ⭐⭐⭐⭐⭐"></a>一、std::expected ⭐⭐⭐⭐⭐</h2><p><strong>使用频率：极高</strong> | <strong>实用性：极强</strong></p><h3 id="1-1-标准化的-Result-类型"><a href="#1-1-标准化的-Result-类型" class="headerlink" title="1.1 标准化的 Result 类型"></a>1.1 标准化的 Result 类型</h3><p><code>std::expected&lt;T, E&gt;</code> 是”成功值或错误”的类型安全表示：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;expected&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::expected&lt;<span class="type">int</span>, std::string&gt; <span class="title">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">unexpected</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> result = <span class="built_in">divide</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">if</span> (result) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; *result &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; result.<span class="built_in">error</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-内存布局"><a href="#1-2-内存布局" class="headerlink" title="1.2 内存布局"></a>1.2 内存布局</h3><p>理解 expected 的内存结构有助于性能分析：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> E&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">expected</span> &#123;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        T value_;    <span class="comment">// 成功时使用</span></span><br><span class="line">        E error_;    <span class="comment">// 失败时使用</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">bool</span> has_value_;  <span class="comment">// 标记当前状态</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌────────────────────────────────────┬───────────┐</span><br><span class="line">│   value_ / error_ (union)          │ has_value │</span><br><span class="line">│   max(sizeof(T), sizeof(E))        │   1 byte  │</span><br><span class="line">└────────────────────────────────────┴───────────┘</span><br></pre></td></tr></table></figure><p><strong>关键点</strong>：</p><ul><li>只使用一份内存存储值或错误</li><li>无堆分配</li><li>类似 <code>std::variant&lt;T, E&gt;</code> 但语义更明确</li></ul><h3 id="1-3-Monadic-操作"><a href="#1-3-Monadic-操作" class="headerlink" title="1.3 Monadic 操作"></a>1.3 Monadic 操作</h3><p>expected 支持链式调用，避免层层嵌套 if：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">std::expected&lt;<span class="type">int</span>, Error&gt; result = <span class="built_in">getValue</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// and_then：成功时继续处理</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">final</span> = result</span><br><span class="line">    .<span class="built_in">and_then</span>([](<span class="type">int</span> x) -&gt; std::expected&lt;<span class="type">int</span>, Error&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) <span class="keyword">return</span> std::<span class="built_in">unexpected</span>(Error::NEGATIVE);</span><br><span class="line">        <span class="keyword">return</span> x * <span class="number">2</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="built_in">and_then</span>([](<span class="type">int</span> x) &#123;</span><br><span class="line">        <span class="keyword">return</span> std::expected&lt;<span class="type">int</span>, Error&gt;&#123;x + <span class="number">1</span>&#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// transform：成功时转换值（不改变错误类型）</span></span><br><span class="line"><span class="keyword">auto</span> doubled = result.<span class="built_in">transform</span>([](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x * <span class="number">2</span>; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// or_else：失败时处理错误</span></span><br><span class="line"><span class="keyword">auto</span> recovered = result.<span class="built_in">or_else</span>([](<span class="type">const</span> Error&amp; e) &#123;</span><br><span class="line">    <span class="built_in">log</span>(e);</span><br><span class="line">    <span class="keyword">return</span> std::expected&lt;<span class="type">int</span>, Error&gt;&#123;<span class="number">0</span>&#125;;  <span class="comment">// 默认值</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// transform_error：转换错误类型</span></span><br><span class="line"><span class="keyword">auto</span> mapped = result.<span class="built_in">transform_error</span>([](Error e) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">toHttpStatus</span>(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="1-4-实用案例"><a href="#1-4-实用案例" class="headerlink" title="1.4 实用案例"></a>1.4 实用案例</h3><p><strong>案例：替代异常的 API</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::expected&lt;User, DbError&gt; <span class="title">getUser</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> db.<span class="built_in">find</span>(id)</span><br><span class="line">        .<span class="built_in">and_then</span>([](<span class="keyword">auto</span> record) &#123; <span class="keyword">return</span> <span class="built_in">parseUser</span>(record); &#125;)</span><br><span class="line">        .<span class="built_in">and_then</span>([](<span class="keyword">auto</span> user) &#123; <span class="keyword">return</span> <span class="built_in">validateUser</span>(user); &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用方</span></span><br><span class="line"><span class="keyword">auto</span> user = <span class="built_in">getUser</span>(<span class="number">42</span>);</span><br><span class="line"><span class="keyword">if</span> (!user) &#123;</span><br><span class="line">    <span class="built_in">handleError</span>(user.<span class="built_in">error</span>());</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">doSomething</span>(*user);</span><br></pre></td></tr></table></figure></p><hr><h2 id="二、std-print-std-println-⭐⭐⭐⭐⭐"><a href="#二、std-print-std-println-⭐⭐⭐⭐⭐" class="headerlink" title="二、std::print / std::println ⭐⭐⭐⭐⭐"></a>二、std::print / std::println ⭐⭐⭐⭐⭐</h2><p><strong>使用频率：极高</strong> | <strong>实用性：极强</strong></p><h3 id="2-1-现代化的输出"><a href="#2-1-现代化的输出" class="headerlink" title="2.1 现代化的输出"></a>2.1 现代化的输出</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;print&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::<span class="built_in">print</span>(<span class="string">&quot;Hello, &#123;&#125;!\n&quot;</span>, <span class="string">&quot;World&quot;</span>);</span><br><span class="line">std::<span class="built_in">println</span>(<span class="string">&quot;Value: &#123;&#125;&quot;</span>, <span class="number">42</span>);  <span class="comment">// 自动换行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 输出到其他流</span></span><br><span class="line">std::<span class="built_in">print</span>(stderr, <span class="string">&quot;Error: &#123;&#125;\n&quot;</span>, message);</span><br></pre></td></tr></table></figure><h3 id="2-2-性能优势"><a href="#2-2-性能优势" class="headerlink" title="2.2 性能优势"></a>2.2 性能优势</h3><p><code>std::print</code> 直接写入输出缓冲区，无临时字符串：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// std::format + cout：创建临时字符串</span></span><br><span class="line">std::cout &lt;&lt; std::format(<span class="string">&quot;Value: &#123;&#125;&quot;</span>, x);  <span class="comment">// 堆分配</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// std::print：直接格式化到输出</span></span><br><span class="line">std::<span class="built_in">print</span>(<span class="string">&quot;Value: &#123;&#125;&quot;</span>, x);  <span class="comment">// 无临时对象</span></span><br></pre></td></tr></table></figure><h3 id="2-3-格式化语法"><a href="#2-3-格式化语法" class="headerlink" title="2.3 格式化语法"></a>2.3 格式化语法</h3><p>沿用 <code>std::format</code> 的语法：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::<span class="built_in">println</span>(<span class="string">&quot;&#123;:&gt;10&#125;&quot;</span>, <span class="number">42</span>);      <span class="comment">// &quot;        42&quot;</span></span><br><span class="line">std::<span class="built_in">println</span>(<span class="string">&quot;&#123;:#x&#125;&quot;</span>, <span class="number">255</span>);      <span class="comment">// &quot;0xff&quot;</span></span><br><span class="line">std::<span class="built_in">println</span>(<span class="string">&quot;&#123;:.2f&#125;&quot;</span>, <span class="number">3.14159</span>); <span class="comment">// &quot;3.14&quot;</span></span><br></pre></td></tr></table></figure><hr><h2 id="三、推导-this-参数（Deducing-This）⭐⭐⭐⭐⭐"><a href="#三、推导-this-参数（Deducing-This）⭐⭐⭐⭐⭐" class="headerlink" title="三、推导 this 参数（Deducing This）⭐⭐⭐⭐⭐"></a>三、推导 this 参数（Deducing This）⭐⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：极强</strong></p><h3 id="3-1-解决重载爆炸问题"><a href="#3-1-解决重载爆炸问题" class="headerlink" title="3.1 解决重载爆炸问题"></a>3.1 解决重载爆炸问题</h3><p>传统上，支持 const/非const、左值/右值需要多个重载：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++20：需要 4 个重载</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="function">Data&amp; <span class="title">data</span><span class="params">()</span> &amp; </span>&#123; <span class="keyword">return</span> data_; &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> Data&amp; <span class="title">data</span><span class="params">()</span> <span class="type">const</span>&amp; </span>&#123; <span class="keyword">return</span> data_; &#125;</span><br><span class="line">    <span class="function">Data&amp;&amp; <span class="title">data</span><span class="params">()</span> &amp;&amp; </span>&#123; <span class="keyword">return</span> std::<span class="built_in">move</span>(data_); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> Data&amp;&amp; <span class="title">data</span><span class="params">()</span> <span class="type">const</span>&amp;&amp; </span>&#123; <span class="keyword">return</span> std::<span class="built_in">move</span>(data_); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++23：一个模板搞定</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Self&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">auto</span>&amp;&amp; <span class="title">data</span><span class="params">(<span class="keyword">this</span> Self&amp;&amp; self)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::forward&lt;Self&gt;(self).data_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="3-2-语法说明"><a href="#3-2-语法说明" class="headerlink" title="3.2 语法说明"></a>3.2 语法说明</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">S</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Self&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">this</span> Self&amp;&amp; self, <span class="type">int</span> x)</span></span>;</span><br><span class="line">    <span class="comment">//       ^^^^^^^^^^^^^^^^</span></span><br><span class="line">    <span class="comment">//       显式 this 参数</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">S s;</span><br><span class="line">s.<span class="built_in">foo</span>(<span class="number">42</span>);              <span class="comment">// Self = S&amp;</span></span><br><span class="line">std::<span class="built_in">move</span>(s).<span class="built_in">foo</span>(<span class="number">42</span>);   <span class="comment">// Self = S</span></span><br><span class="line"><span class="type">const</span> S cs;</span><br><span class="line">cs.<span class="built_in">foo</span>(<span class="number">42</span>);             <span class="comment">// Self = const S&amp;</span></span><br></pre></td></tr></table></figure><h3 id="3-3-递归-Lambda"><a href="#3-3-递归-Lambda" class="headerlink" title="3.3 递归 Lambda"></a>3.3 递归 Lambda</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++20：需要传递自身</span></span><br><span class="line"><span class="keyword">auto</span> fib = [](<span class="keyword">auto</span>&amp;&amp; self, <span class="type">int</span> n) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">self</span>(self, n<span class="number">-1</span>) + <span class="built_in">self</span>(self, n<span class="number">-2</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">fib</span>(fib, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++23：直接递归</span></span><br><span class="line"><span class="keyword">auto</span> fib = [](<span class="keyword">this</span> <span class="keyword">auto</span>&amp;&amp; self, <span class="type">int</span> n) -&gt; <span class="type">int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) <span class="keyword">return</span> n;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">self</span>(n<span class="number">-1</span>) + <span class="built_in">self</span>(n<span class="number">-2</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">fib</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><h3 id="3-4-CRTP-简化"><a href="#3-4-CRTP-简化" class="headerlink" title="3.4 CRTP 简化"></a>3.4 CRTP 简化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++20 CRTP</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Derived&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">interface</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">static_cast</span>&lt;Derived*&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">implementation</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++23：无需模板参数</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Self&gt;</span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">interface</span><span class="params">(<span class="keyword">this</span> Self&amp;&amp; self)</span> </span>&#123;</span><br><span class="line">        self.<span class="built_in">implementation</span>();  <span class="comment">// 自动推导 Derived</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="四、多维下标运算符-⭐⭐⭐⭐"><a href="#四、多维下标运算符-⭐⭐⭐⭐" class="headerlink" title="四、多维下标运算符 ⭐⭐⭐⭐"></a>四、多维下标运算符 ⭐⭐⭐⭐</h2><p><strong>使用频率：中高</strong> | <strong>实用性：强</strong></p><h3 id="4-1-自然的矩阵语法"><a href="#4-1-自然的矩阵语法" class="headerlink" title="4.1 自然的矩阵语法"></a>4.1 自然的矩阵语法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Matrix</span> &#123;</span><br><span class="line">    std::vector&lt;T&gt; data_;</span><br><span class="line">    <span class="type">size_t</span> rows_, cols_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// C++23：多参数 operator[]</span></span><br><span class="line">    T&amp; <span class="keyword">operator</span>[](<span class="type">size_t</span> i, <span class="type">size_t</span> j) &#123;</span><br><span class="line">        <span class="keyword">return</span> data_[i * cols_ + j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Matrix&lt;<span class="type">double</span>&gt; <span class="title">m</span><span class="params">(<span class="number">3</span>, <span class="number">4</span>)</span></span>;</span><br><span class="line">m[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">3.14</span>;  <span class="comment">// 直观！</span></span><br></pre></td></tr></table></figure><h3 id="4-2-与传统方式对比"><a href="#4-2-与传统方式对比" class="headerlink" title="4.2 与传统方式对比"></a>4.2 与传统方式对比</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++20：需要变通</span></span><br><span class="line"><span class="built_in">m</span>(<span class="number">1</span>, <span class="number">2</span>) = <span class="number">3.14</span>;    <span class="comment">// operator()</span></span><br><span class="line">m[<span class="number">1</span>][<span class="number">2</span>] = <span class="number">3.14</span>;    <span class="comment">// 返回代理对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++23：符合直觉</span></span><br><span class="line">m[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">3.14</span>;</span><br></pre></td></tr></table></figure><h3 id="4-3-可变参数版本"><a href="#4-3-可变参数版本" class="headerlink" title="4.3 可变参数版本"></a>4.3 可变参数版本</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="type">size_t</span>... Dims&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NDArray</span> &#123;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Indices&gt;</span><br><span class="line">    T&amp; <span class="keyword">operator</span>[](Indices... is) &#123;</span><br><span class="line">        <span class="keyword">return</span> data_[<span class="built_in">computeIndex</span>(is...)];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">NDArray&lt;<span class="type">float</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&gt; arr;</span><br><span class="line">arr[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] = <span class="number">1.0f</span>;  <span class="comment">// 三维索引</span></span><br></pre></td></tr></table></figure><hr><h2 id="五、std-generator-⭐⭐⭐⭐"><a href="#五、std-generator-⭐⭐⭐⭐" class="headerlink" title="五、std::generator ⭐⭐⭐⭐"></a>五、std::generator ⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：强</strong></p><h3 id="5-1-标准生成器类型"><a href="#5-1-标准生成器类型" class="headerlink" title="5.1 标准生成器类型"></a>5.1 标准生成器类型</h3><p>C++23 提供开箱即用的生成器：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;generator&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::generator&lt;<span class="type">int</span>&gt; <span class="title">range</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = start; i &lt; end; ++i) &#123;</span><br><span class="line">        <span class="keyword">co_yield</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>)) &#123;</span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-嵌套生成器"><a href="#5-2-嵌套生成器" class="headerlink" title="5.2 嵌套生成器"></a>5.2 嵌套生成器</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::generator&lt;<span class="type">int</span>&gt; <span class="title">flatten</span><span class="params">(std::vector&lt;std::vector&lt;<span class="type">int</span>&gt;&gt;&amp; vv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; v : vv) &#123;</span><br><span class="line">        <span class="keyword">co_yield</span> std::ranges::<span class="built_in">elements_of</span>(v);  <span class="comment">// 展开</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-与-Ranges-集成"><a href="#5-3-与-Ranges-集成" class="headerlink" title="5.3 与 Ranges 集成"></a>5.3 与 Ranges 集成</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> result = <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">    | std::views::<span class="built_in">filter</span>([](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x % <span class="number">2</span> == <span class="number">0</span>; &#125;)</span><br><span class="line">    | std::views::<span class="built_in">transform</span>([](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x * x; &#125;)</span><br><span class="line">    | std::views::<span class="built_in">take</span>(<span class="number">10</span>);</span><br></pre></td></tr></table></figure><hr><h2 id="六、if-consteval-⭐⭐⭐⭐"><a href="#六、if-consteval-⭐⭐⭐⭐" class="headerlink" title="六、if consteval ⭐⭐⭐⭐"></a>六、if consteval ⭐⭐⭐⭐</h2><p><strong>使用频率：中高</strong> | <strong>实用性：强</strong></p><h3 id="6-1-区分编译时-运行时路径"><a href="#6-1-区分编译时-运行时路径" class="headerlink" title="6.1 区分编译时/运行时路径"></a>6.1 区分编译时/运行时路径</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">double</span> <span class="title">fastSqrt</span><span class="params">(<span class="type">double</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">consteval</span> &#123;</span><br><span class="line">        <span class="comment">// 编译时：用简单算法</span></span><br><span class="line">        <span class="type">double</span> guess = x / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; ++i) &#123;</span><br><span class="line">            guess = (guess + x / guess) / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> guess;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 运行时：用硬件指令</span></span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">sqrt</span>(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-与-if-constexpr-的区别"><a href="#6-2-与-if-constexpr-的区别" class="headerlink" title="6.2 与 if constexpr 的区别"></a>6.2 与 if constexpr 的区别</h3><div class="table-container"><table><thead><tr><th>特性</th><th><code>if constexpr</code></th><th><code>if consteval</code></th></tr></thead><tbody><tr><td>条件</td><td>编译时常量表达式</td><td>是否在常量求值上下文</td></tr><tr><td>用途</td><td>类型分支</td><td>编译时/运行时策略</td></tr></tbody></table></div><hr><h2 id="七、std-mdspan-⭐⭐⭐⭐"><a href="#七、std-mdspan-⭐⭐⭐⭐" class="headerlink" title="七、std::mdspan ⭐⭐⭐⭐"></a>七、std::mdspan ⭐⭐⭐⭐</h2><p><strong>使用频率：中</strong> | <strong>实用性：强</strong></p><h3 id="7-1-多维数组视图"><a href="#7-1-多维数组视图" class="headerlink" title="7.1 多维数组视图"></a>7.1 多维数组视图</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mdspan&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">storage</span><span class="params">(<span class="number">12</span>)</span></span>;</span><br><span class="line"><span class="function">std::mdspan <span class="title">matrix</span><span class="params">(storage.data(), <span class="number">3</span>, <span class="number">4</span>)</span></span>;  <span class="comment">// 3×4 视图</span></span><br><span class="line"></span><br><span class="line">matrix[<span class="number">1</span>, <span class="number">2</span>] = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; matrix.<span class="built_in">extent</span>(<span class="number">0</span>); ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> j = <span class="number">0</span>; j &lt; matrix.<span class="built_in">extent</span>(<span class="number">1</span>); ++j) &#123;</span><br><span class="line">        std::cout &lt;&lt; matrix[i, j] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2-布局策略"><a href="#7-2-布局策略" class="headerlink" title="7.2 布局策略"></a>7.2 布局策略</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 行优先（C 风格，默认）</span></span><br><span class="line">std::mdspan&lt;<span class="type">int</span>, ..., std::layout_right&gt; rowMajor;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 列优先（Fortran 风格）</span></span><br><span class="line">std::mdspan&lt;<span class="type">int</span>, ..., std::layout_left&gt; colMajor;</span><br></pre></td></tr></table></figure><h3 id="7-3-实用案例"><a href="#7-3-实用案例" class="headerlink" title="7.3 实用案例"></a>7.3 实用案例</h3><p><strong>案例：图像处理</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">grayscale</span><span class="params">(std::mdspan&lt;<span class="type">uint8_t</span>, std::dextents&lt;<span class="type">size_t</span>, <span class="number">3</span>&gt;&gt; img)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> y = <span class="number">0</span>; y &lt; img.<span class="built_in">extent</span>(<span class="number">0</span>); ++y) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> x = <span class="number">0</span>; x &lt; img.<span class="built_in">extent</span>(<span class="number">1</span>); ++x) &#123;</span><br><span class="line">            <span class="type">int</span> gray = (img[y,x,<span class="number">0</span>] + img[y,x,<span class="number">1</span>] + img[y,x,<span class="number">2</span>]) / <span class="number">3</span>;</span><br><span class="line">            img[y,x,<span class="number">0</span>] = img[y,x,<span class="number">1</span>] = img[y,x,<span class="number">2</span>] = gray;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="八、std-flat-map-std-flat-set-⭐⭐⭐⭐"><a href="#八、std-flat-map-std-flat-set-⭐⭐⭐⭐" class="headerlink" title="八、std::flat_map / std::flat_set ⭐⭐⭐⭐"></a>八、std::flat_map / std::flat_set ⭐⭐⭐⭐</h2><p><strong>使用频率：中高</strong> | <strong>实用性：强</strong></p><h3 id="8-1-基于排序数组的容器"><a href="#8-1-基于排序数组的容器" class="headerlink" title="8.1 基于排序数组的容器"></a>8.1 基于排序数组的容器</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;flat_map&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::flat_map&lt;std::string, <span class="type">int</span>&gt; scores;</span><br><span class="line">scores[<span class="string">&quot;Alice&quot;</span>] = <span class="number">90</span>;</span><br><span class="line">scores[<span class="string">&quot;Bob&quot;</span>] = <span class="number">85</span>;</span><br></pre></td></tr></table></figure><h3 id="8-2-与-std-map-对比"><a href="#8-2-与-std-map-对比" class="headerlink" title="8.2 与 std::map 对比"></a>8.2 与 std::map 对比</h3><div class="table-container"><table><thead><tr><th>特性</th><th><code>std::map</code></th><th><code>std::flat_map</code></th></tr></thead><tbody><tr><td>底层</td><td>红黑树</td><td>排序 vector</td></tr><tr><td>内存局部性</td><td>差</td><td>优秀</td></tr><tr><td>查找</td><td>O(log N)</td><td>O(log N)</td></tr><tr><td>插入</td><td>O(log N)</td><td>O(N)</td></tr><tr><td>迭代</td><td>差</td><td>优秀</td></tr></tbody></table></div><h3 id="8-3-适用场景"><a href="#8-3-适用场景" class="headerlink" title="8.3 适用场景"></a>8.3 适用场景</h3><p>✅ 读多写少<br>✅ 元素数量小（&lt; 1000）<br>✅ 需要快速迭代<br>❌ 频繁插入删除</p><hr><h2 id="九、import-std-⭐⭐⭐⭐"><a href="#九、import-std-⭐⭐⭐⭐" class="headerlink" title="九、import std; ⭐⭐⭐⭐"></a>九、import std; ⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：强</strong></p><h3 id="9-1-一行导入整个标准库"><a href="#9-1-一行导入整个标准库" class="headerlink" title="9.1 一行导入整个标准库"></a>9.1 一行导入整个标准库</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::<span class="built_in">println</span>(<span class="string">&quot;Hello!&quot;</span>);</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    std::ranges::<span class="built_in">sort</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-2-优势"><a href="#9-2-优势" class="headerlink" title="9.2 优势"></a>9.2 优势</h3><ul><li><strong>编译速度</strong>：标准库只编译一次</li><li><strong>无宏污染</strong>：模块隔离</li><li><strong>简洁</strong>：不用记住该 include 什么</li></ul><hr><h2 id="十、其他实用特性"><a href="#十、其他实用特性" class="headerlink" title="十、其他实用特性"></a>十、其他实用特性</h2><h3 id="10-1-ranges-to"><a href="#10-1-ranges-to" class="headerlink" title="10.1 ranges::to"></a>10.1 ranges::to</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> vec = someRange | std::ranges::<span class="built_in">to</span>&lt;std::vector&gt;();</span><br><span class="line"><span class="keyword">auto</span> set = someRange | std::ranges::<span class="built_in">to</span>&lt;std::set&gt;();</span><br></pre></td></tr></table></figure><h3 id="10-2-views-enumerate"><a href="#10-2-views-enumerate" class="headerlink" title="10.2 views::enumerate"></a>10.2 views::enumerate</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;std::string&gt; names = &#123;<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> [idx, name] : names | std::views::enumerate) &#123;</span><br><span class="line">    std::<span class="built_in">println</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, idx, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-3-views-zip"><a href="#10-3-views-zip" class="headerlink" title="10.3 views::zip"></a>10.3 views::zip</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">int</span>&gt; ids = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">std::vector&lt;std::string&gt; names = &#123;<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> [id, name] : std::views::<span class="built_in">zip</span>(ids, names)) &#123;</span><br><span class="line">    std::<span class="built_in">println</span>(<span class="string">&quot;&#123;&#125;: &#123;&#125;&quot;</span>, id, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-4-std-to-underlying"><a href="#10-4-std-to-underlying" class="headerlink" title="10.4 std::to_underlying"></a>10.4 std::to_underlying</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum class</span> <span class="title class_">Color</span> &#123; Red = <span class="number">1</span>, Green = <span class="number">2</span> &#125;;</span><br><span class="line"><span class="keyword">auto</span> value = std::<span class="built_in">to_underlying</span>(Color::Green);  <span class="comment">// 2</span></span><br></pre></td></tr></table></figure><h3 id="10-5-std-unreachable"><a href="#10-5-std-unreachable" class="headerlink" title="10.5 std::unreachable"></a>10.5 std::unreachable</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (x) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    std::<span class="built_in">unreachable</span>();  <span class="comment">// 告诉编译器这里不可达</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-6-assume"><a href="#10-6-assume" class="headerlink" title="10.6 [[assume]]"></a>10.6 [[assume]]</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    [[<span class="built_in">assume</span>(b != <span class="number">0</span>)]];  <span class="comment">// 允许编译器优化</span></span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="10-7-size-t-字面量"><a href="#10-7-size-t-字面量" class="headerlink" title="10.7 size_t 字面量"></a>10.7 size_t 字面量</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> index = <span class="number">42uz</span>;   <span class="comment">// std::size_t</span></span><br><span class="line"><span class="keyword">auto</span> offset = <span class="number">42</span>z;   <span class="comment">// std::ptrdiff_t</span></span><br></pre></td></tr></table></figure><h3 id="10-8-std-move-only-function"><a href="#10-8-std-move-only-function" class="headerlink" title="10.8 std::move_only_function"></a>10.8 std::move_only_function</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可持有只移动类型</span></span><br><span class="line">std::move_only_function&lt;<span class="built_in">void</span>()&gt; fn = </span><br><span class="line">    [p = std::<span class="built_in">make_unique</span>&lt;<span class="type">int</span>&gt;(<span class="number">42</span>)] &#123;</span><br><span class="line">        std::<span class="built_in">println</span>(<span class="string">&quot;&#123;&#125;&quot;</span>, *p);</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure><h3 id="10-9-std-stacktrace"><a href="#10-9-std-stacktrace" class="headerlink" title="10.9 std::stacktrace"></a>10.9 std::stacktrace</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">logWithTrace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> trace = std::stacktrace::<span class="built_in">current</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; entry : trace) &#123;</span><br><span class="line">        std::<span class="built_in">println</span>(<span class="string">&quot;  at &#123;&#125;&quot;</span>, entry.<span class="built_in">description</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><div class="table-container"><table><thead><tr><th>特性</th><th>使用频率</th><th>核心价值</th></tr></thead><tbody><tr><td>std::expected</td><td>⭐⭐⭐⭐⭐</td><td>标准化错误处理</td></tr><tr><td>std::print</td><td>⭐⭐⭐⭐⭐</td><td>现代化输出</td></tr><tr><td>推导 this</td><td>⭐⭐⭐⭐⭐</td><td>消除重载冗余</td></tr><tr><td>多维下标</td><td>⭐⭐⭐⭐</td><td>自然的矩阵语法</td></tr><tr><td>std::generator</td><td>⭐⭐⭐⭐</td><td>标准生成器</td></tr><tr><td>if consteval</td><td>⭐⭐⭐⭐</td><td>编译时/运行时分离</td></tr><tr><td>std::mdspan</td><td>⭐⭐⭐⭐</td><td>多维数组视图</td></tr><tr><td>flat_map/set</td><td>⭐⭐⭐⭐</td><td>缓存友好容器</td></tr><tr><td>import std</td><td>⭐⭐⭐⭐</td><td>一行导入标准库</td></tr></tbody></table></div><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://en.cppreference.com/w/cpp/23">cppreference.com - C++23</a></li><li><a href="https://github.com/AnthonyCalandra/modern-cpp-features">C++23 Feature Overview</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> C++标准演进 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 现代C++ </tag>
            
            <tag> 编译器 </tag>
            
            <tag> C++23 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++20 新特性完全指南：从语法到实践</title>
      <link href="/2026/02/05/Cpp20%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2026/02/05/Cpp20%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="C-20-新特性完全指南：从语法到实践"><a href="#C-20-新特性完全指南：从语法到实践" class="headerlink" title="C++20 新特性完全指南：从语法到实践"></a>C++20 新特性完全指南：从语法到实践</h1><p>C++20 是自 C++11 以来最大的语言更新，引入了四大核心特性：<strong>概念（Concepts）</strong>、<strong>范围（Ranges）</strong>、<strong>协程（Coroutines）</strong>、<strong>模块（Modules）</strong>。本文按使用频率和实用性排序，结合实际场景深入分析。</p><hr><h2 id="一、概念（Concepts）⭐⭐⭐⭐⭐"><a href="#一、概念（Concepts）⭐⭐⭐⭐⭐" class="headerlink" title="一、概念（Concepts）⭐⭐⭐⭐⭐"></a>一、概念（Concepts）⭐⭐⭐⭐⭐</h2><p><strong>使用频率：极高</strong> | <strong>实用性：极强</strong></p><h3 id="1-1-模板约束的革命"><a href="#1-1-模板约束的革命" class="headerlink" title="1.1 模板约束的革命"></a>1.1 模板约束的革命</h3><p>Concepts 替代了晦涩的 SFINAE，让模板约束清晰可读：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;concepts&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">concept</span> Numeric = std::integral&lt;T&gt; || std::floating_point&lt;T&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;Numeric T&gt;</span></span><br><span class="line"><span class="function">T <span class="title">add</span><span class="params">(T a, T b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">add</span>(<span class="number">1</span>, <span class="number">2</span>);       <span class="comment">// ✅ OK</span></span><br><span class="line"><span class="built_in">add</span>(<span class="number">1.0</span>, <span class="number">2.0</span>);   <span class="comment">// ✅ OK</span></span><br><span class="line"><span class="built_in">add</span>(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>);   <span class="comment">// ❌ 错误信息清晰：不满足 Numeric</span></span><br></pre></td></tr></table></figure><h3 id="1-2-四种语法形式"><a href="#1-2-四种语法形式" class="headerlink" title="1.2 四种语法形式"></a>1.2 四种语法形式</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 形式 1：概念作为模板参数约束</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;std::integral T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f1</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形式 2：requires 子句</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">requires</span> std::integral&lt;T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f2</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形式 3：尾置 requires</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f3</span><span class="params">(T t)</span> <span class="keyword">requires</span> std::integral&lt;T&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 形式 4：简写语法</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f4</span><span class="params">(std::integral <span class="keyword">auto</span> t)</span></span>;</span><br></pre></td></tr></table></figure><h3 id="1-3-定义自定义概念"><a href="#1-3-定义自定义概念" class="headerlink" title="1.3 定义自定义概念"></a>1.3 定义自定义概念</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">concept</span> Hashable = <span class="built_in">requires</span>(T t) &#123;</span><br><span class="line">    &#123; std::hash&lt;T&gt;&#123;&#125;(t) &#125; -&gt; std::convertible_to&lt;std::<span class="type">size_t</span>&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">concept</span> Container = <span class="built_in">requires</span>(T c) &#123;</span><br><span class="line">    c.<span class="built_in">begin</span>();</span><br><span class="line">    c.<span class="built_in">end</span>();</span><br><span class="line">    c.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">typename</span> T::value_type;</span><br><span class="line">    &#123; c.<span class="built_in">size</span>() &#125; -&gt; std::convertible_to&lt;std::<span class="type">size_t</span>&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="1-4-requires-表达式详解"><a href="#1-4-requires-表达式详解" class="headerlink" title="1.4 requires 表达式详解"></a>1.4 requires 表达式详解</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">concept</span> Sortable = <span class="built_in">requires</span>(T&amp; container) &#123;</span><br><span class="line">    <span class="comment">// 简单要求：表达式合法</span></span><br><span class="line">    container.<span class="built_in">begin</span>();</span><br><span class="line">    container.<span class="built_in">end</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 类型要求：嵌套类型存在</span></span><br><span class="line">    <span class="keyword">typename</span> T::value_type;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 复合要求：表达式合法 + 返回类型约束</span></span><br><span class="line">    &#123; container.<span class="built_in">size</span>() &#125; -&gt; std::convertible_to&lt;std::<span class="type">size_t</span>&gt;;</span><br><span class="line">    &#123; *container.<span class="built_in">begin</span>() &#125; -&gt; std::same_as&lt;<span class="keyword">typename</span> T::value_type&amp;&gt;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 嵌套要求：额外约束</span></span><br><span class="line">    <span class="keyword">requires</span> std::default_initializable&lt;<span class="keyword">typename</span> T::value_type&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="1-5-与-SFINAE-对比"><a href="#1-5-与-SFINAE-对比" class="headerlink" title="1.5 与 SFINAE 对比"></a>1.5 与 SFINAE 对比</h3><p><strong>错误信息对比</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SFINAE 错误（难以理解）</span></span><br><span class="line">error: no matching function <span class="keyword">for</span> call to <span class="string">&#x27;process&#x27;</span></span><br><span class="line">note: candidate <span class="keyword">template</span> ignored: substitution failure</span><br><span class="line"></span><br><span class="line"><span class="comment">// Concepts 错误（清晰明了）</span></span><br><span class="line">error: constraints <span class="keyword">not</span> satisfied</span><br><span class="line">note: because <span class="string">&#x27;double&#x27;</span> does <span class="keyword">not</span> satisfy <span class="string">&#x27;integral&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="1-6-标准库预定义概念"><a href="#1-6-标准库预定义概念" class="headerlink" title="1.6 标准库预定义概念"></a>1.6 标准库预定义概念</h3><div class="table-container"><table><thead><tr><th>概念</th><th>含义</th></tr></thead><tbody><tr><td><code>std::same_as&lt;T, U&gt;</code></td><td>类型相同</td></tr><tr><td><code>std::derived_from&lt;D, B&gt;</code></td><td>D 派生自 B</td></tr><tr><td><code>std::convertible_to&lt;From, To&gt;</code></td><td>可隐式转换</td></tr><tr><td><code>std::integral&lt;T&gt;</code></td><td>整数类型</td></tr><tr><td><code>std::floating_point&lt;T&gt;</code></td><td>浮点类型</td></tr><tr><td><code>std::copyable&lt;T&gt;</code> / <code>std::movable&lt;T&gt;</code></td><td>可拷贝/移动</td></tr><tr><td><code>std::invocable&lt;F, Args...&gt;</code></td><td>可调用</td></tr></tbody></table></div><hr><h2 id="二、范围库（Ranges）⭐⭐⭐⭐⭐"><a href="#二、范围库（Ranges）⭐⭐⭐⭐⭐" class="headerlink" title="二、范围库（Ranges）⭐⭐⭐⭐⭐"></a>二、范围库（Ranges）⭐⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：极强</strong></p><h3 id="2-1-惰性求值的链式操作"><a href="#2-1-惰性求值的链式操作" class="headerlink" title="2.1 惰性求值的链式操作"></a>2.1 惰性求值的链式操作</h3><p>Ranges 让数据处理代码像写 SQL 一样直观：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ranges&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传统方式：临时容器、多次遍历</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; temp;</span><br><span class="line">std::<span class="built_in">copy_if</span>(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), std::<span class="built_in">back_inserter</span>(temp),</span><br><span class="line">             [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x % <span class="number">2</span> == <span class="number">0</span>; &#125;);</span><br><span class="line">std::<span class="built_in">transform</span>(temp.<span class="built_in">begin</span>(), temp.<span class="built_in">end</span>(), temp.<span class="built_in">begin</span>(),</span><br><span class="line">               [](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x * x; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ranges 方式：链式、惰性、无临时容器</span></span><br><span class="line"><span class="keyword">auto</span> result = v </span><br><span class="line">    | std::views::<span class="built_in">filter</span>([](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x % <span class="number">2</span> == <span class="number">0</span>; &#125;)</span><br><span class="line">    | std::views::<span class="built_in">transform</span>([](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x * x; &#125;);</span><br></pre></td></tr></table></figure><h3 id="2-2-惰性求值原理"><a href="#2-2-惰性求值原理" class="headerlink" title="2.2 惰性求值原理"></a>2.2 惰性求值原理</h3><p><strong>关键理解</strong>：Views 不会立即计算，只在迭代时按需求值：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> pipeline = hugeData</span><br><span class="line">    | views::<span class="built_in">filter</span>(pred)      <span class="comment">// 不执行任何过滤</span></span><br><span class="line">    | views::<span class="built_in">transform</span>(func);  <span class="comment">// 不执行任何转换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 遍历时才逐个计算</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> x : pipeline | views::<span class="built_in">take</span>(<span class="number">10</span>)) &#123;</span><br><span class="line">    <span class="comment">// 只处理前 10 个满足条件的元素</span></span><br><span class="line">    <span class="comment">// 不会遍历整个 hugeData</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3-常用视图适配器"><a href="#2-3-常用视图适配器" class="headerlink" title="2.3 常用视图适配器"></a>2.3 常用视图适配器</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> views = std::views;</span><br><span class="line"></span><br><span class="line">views::<span class="built_in">filter</span>(pred)        <span class="comment">// 过滤</span></span><br><span class="line">views::<span class="built_in">transform</span>(func)     <span class="comment">// 转换</span></span><br><span class="line">views::<span class="built_in">take</span>(n)             <span class="comment">// 取前 n 个</span></span><br><span class="line">views::<span class="built_in">drop</span>(n)             <span class="comment">// 跳过前 n 个</span></span><br><span class="line">views::reverse             <span class="comment">// 反转</span></span><br><span class="line">views::<span class="built_in">split</span>(delim)        <span class="comment">// 分割</span></span><br><span class="line">views::join                <span class="comment">// 扁平化</span></span><br><span class="line">views::<span class="built_in">iota</span>(start, end)    <span class="comment">// 生成范围 [start, end)</span></span><br><span class="line">views::<span class="built_in">iota</span>(start)         <span class="comment">// 无限范围 [start, ∞)</span></span><br></pre></td></tr></table></figure><h3 id="2-4-实用案例"><a href="#2-4-实用案例" class="headerlink" title="2.4 实用案例"></a>2.4 实用案例</h3><p><strong>案例 1：数据处理管道</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> topSalaries = employees</span><br><span class="line">    | views::<span class="built_in">filter</span>([](<span class="keyword">auto</span>&amp; e) &#123; <span class="keyword">return</span> e.age &gt; <span class="number">30</span>; &#125;)</span><br><span class="line">    | views::<span class="built_in">transform</span>([](<span class="keyword">auto</span>&amp; e) &#123; <span class="keyword">return</span> e.salary; &#125;)</span><br><span class="line">    | views::<span class="built_in">take</span>(<span class="number">5</span>);</span><br></pre></td></tr></table></figure></p><p><strong>案例 2：无限序列</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 斐波那契数列（无限）</span></span><br><span class="line"><span class="keyword">auto</span> fib = views::<span class="built_in">iota</span>(<span class="number">0</span>)</span><br><span class="line">    | views::<span class="built_in">transform</span>([a=<span class="number">0</span>, b=<span class="number">1</span>](<span class="type">int</span>) <span class="keyword">mutable</span> &#123;</span><br><span class="line">        <span class="type">int</span> result = a;</span><br><span class="line">        std::<span class="built_in">tie</span>(a, b) = std::<span class="built_in">make_tuple</span>(b, a + b);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取前 20 个</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : fib | views::<span class="built_in">take</span>(<span class="number">20</span>)) &#123;</span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="三、协程（Coroutines）⭐⭐⭐⭐"><a href="#三、协程（Coroutines）⭐⭐⭐⭐" class="headerlink" title="三、协程（Coroutines）⭐⭐⭐⭐"></a>三、协程（Coroutines）⭐⭐⭐⭐</h2><p><strong>使用频率：中高</strong> | <strong>实用性：强</strong></p><h3 id="3-1-可暂停的函数"><a href="#3-1-可暂停的函数" class="headerlink" title="3.1 可暂停的函数"></a>3.1 可暂停的函数</h3><p>协程可以暂停执行并稍后恢复：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">Generator&lt;<span class="type">int</span>&gt; <span class="title">range</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = start; i &lt; end; ++i) &#123;</span><br><span class="line">        <span class="keyword">co_yield</span> i;  <span class="comment">// 暂停，返回 i</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x : <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>)) &#123;</span><br><span class="line">    std::cout &lt;&lt; x &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-三个关键字"><a href="#3-2-三个关键字" class="headerlink" title="3.2 三个关键字"></a>3.2 三个关键字</h3><div class="table-container"><table><thead><tr><th>关键字</th><th>作用</th><th>场景</th></tr></thead><tbody><tr><td><code>co_yield</code></td><td>暂停并生成值</td><td>生成器</td></tr><tr><td><code>co_await</code></td><td>暂停并等待</td><td>异步操作</td></tr><tr><td><code>co_return</code></td><td>结束协程</td><td>返回最终值</td></tr></tbody></table></div><h3 id="3-3-协程帧（需要理解内存模型）"><a href="#3-3-协程帧（需要理解内存模型）" class="headerlink" title="3.3 协程帧（需要理解内存模型）"></a>3.3 协程帧（需要理解内存模型）</h3><p>编译器为协程分配一个<strong>帧</strong>来保存状态，这对性能分析很重要：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Generator&lt;<span class="type">int</span>&gt; <span class="title">count</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">co_yield</span> i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译器生成的帧（概念性）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────┐</span><br><span class="line">│          Coroutine Frame            │</span><br><span class="line">├───────────────┬─────────────────────┤</span><br><span class="line">│  Resume Ptr   │  Destroy Ptr        │  ← 恢复/销毁函数指针</span><br><span class="line">├───────────────┴─────────────────────┤</span><br><span class="line">│            Promise Object           │  ← 协程状态</span><br><span class="line">├─────────────────────────────────────┤</span><br><span class="line">│         Local Variables (i)         │  ← 跨暂停点保存</span><br><span class="line">└─────────────────────────────────────┘</span><br></pre></td></tr></table></figure><p><strong>关键点</strong>：</p><ul><li>协程帧通常在<strong>堆上分配</strong>（编译器可能优化到栈）</li><li>局部变量保存在帧中，跨 <code>co_yield</code>/<code>co_await</code> 存活</li><li>帧包含恢复点信息，支持从暂停处继续</li></ul><h3 id="3-4-实用案例"><a href="#3-4-实用案例" class="headerlink" title="3.4 实用案例"></a>3.4 实用案例</h3><p><strong>案例 1：懒加载生成器</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Generator&lt;std::string&gt; <span class="title">readLines</span><span class="params">(std::ifstream&amp; file)</span> </span>&#123;</span><br><span class="line">    std::string line;</span><br><span class="line">    <span class="keyword">while</span> (std::<span class="built_in">getline</span>(file, line)) &#123;</span><br><span class="line">        <span class="keyword">co_yield</span> line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>案例 2：异步任务</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Task&lt;std::string&gt; <span class="title">fetchData</span><span class="params">(std::string url)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> response = <span class="keyword">co_await</span> <span class="built_in">asyncHttpGet</span>(url);</span><br><span class="line">    <span class="function"><span class="keyword">co_return</span> <span class="title">parseJson</span><span class="params">(response)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="四、模块（Modules）⭐⭐⭐⭐"><a href="#四、模块（Modules）⭐⭐⭐⭐" class="headerlink" title="四、模块（Modules）⭐⭐⭐⭐"></a>四、模块（Modules）⭐⭐⭐⭐</h2><p><strong>使用频率：中</strong> | <strong>实用性：强</strong></p><h3 id="4-1-替代头文件"><a href="#4-1-替代头文件" class="headerlink" title="4.1 替代头文件"></a>4.1 替代头文件</h3><p>模块解决了头文件的诸多问题：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// math.ixx（模块接口）</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">module</span> math;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">export</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123; <span class="keyword">return</span> a + b; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">namespace</span> geometry &#123;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">area</span><span class="params">(<span class="type">double</span> r)</span> </span>&#123; <span class="keyword">return</span> <span class="number">3.14159</span> * r * r; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="keyword">import</span> math;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="built_in">add</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; geometry::<span class="built_in">area</span>(<span class="number">5</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-与头文件对比"><a href="#4-2-与头文件对比" class="headerlink" title="4.2 与头文件对比"></a>4.2 与头文件对比</h3><div class="table-container"><table><thead><tr><th>问题</th><th>头文件</th><th>模块</th></tr></thead><tbody><tr><td>编译速度</td><td>每个翻译单元重新解析</td><td>只编译一次</td></tr><tr><td>宏污染</td><td>宏相互影响</td><td>完全隔离</td></tr><tr><td>符号可见性</td><td>全部暴露</td><td>显式 export</td></tr><tr><td>include 顺序</td><td>可能导致问题</td><td>无顺序问题</td></tr></tbody></table></div><h3 id="4-3-实用案例"><a href="#4-3-实用案例" class="headerlink" title="4.3 实用案例"></a>4.3 实用案例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mylib.ixx</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">module</span> mylib;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">import</span> :core;    <span class="comment">// 导出子模块</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">import</span> :utils;</span><br></pre></td></tr></table></figure><hr><h2 id="五、三向比较运算符（-lt-gt-）⭐⭐⭐⭐"><a href="#五、三向比较运算符（-lt-gt-）⭐⭐⭐⭐" class="headerlink" title="五、三向比较运算符（&lt;=&gt;）⭐⭐⭐⭐"></a>五、三向比较运算符（&lt;=&gt;）⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：强</strong></p><h3 id="5-1-一行生成所有比较运算符"><a href="#5-1-一行生成所有比较运算符" class="headerlink" title="5.1 一行生成所有比较运算符"></a>5.1 一行生成所有比较运算符</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;compare&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="type">int</span> x, y;</span><br><span class="line">    <span class="keyword">auto</span> <span class="built_in">operator</span>&lt;=&gt;(<span class="type">const</span> Point&amp;) <span class="type">const</span> = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Point a&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, b&#123;<span class="number">1</span>, <span class="number">3</span>&#125;;</span><br><span class="line">a &lt; b;   <span class="comment">// ✅ 自动生成</span></span><br><span class="line">a == b;  <span class="comment">// ✅ 自动生成</span></span><br><span class="line">a &gt;= b;  <span class="comment">// ✅ 自动生成</span></span><br></pre></td></tr></table></figure><h3 id="5-2-比较类别"><a href="#5-2-比较类别" class="headerlink" title="5.2 比较类别"></a>5.2 比较类别</h3><div class="table-container"><table><thead><tr><th>类型</th><th>含义</th><th>示例</th></tr></thead><tbody><tr><td><code>std::strong_ordering</code></td><td>全序，相等可替换</td><td>整数</td></tr><tr><td><code>std::weak_ordering</code></td><td>全序，相等不可替换</td><td>大小写不敏感字符串</td></tr><tr><td><code>std::partial_ordering</code></td><td>偏序，可能不可比</td><td>浮点数（NaN）</td></tr></tbody></table></div><h3 id="5-3-自定义比较逻辑"><a href="#5-3-自定义比较逻辑" class="headerlink" title="5.3 自定义比较逻辑"></a>5.3 自定义比较逻辑</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">CaseInsensitive</span> &#123;</span><br><span class="line">    std::string value;</span><br><span class="line">    </span><br><span class="line">    std::weak_ordering <span class="built_in">operator</span>&lt;=&gt;(<span class="type">const</span> CaseInsensitive&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">auto</span> lhs = <span class="built_in">toLower</span>(value);</span><br><span class="line">        <span class="keyword">auto</span> rhs = <span class="built_in">toLower</span>(other.value);</span><br><span class="line">        <span class="keyword">return</span> lhs &lt;=&gt; rhs;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">bool</span> <span class="keyword">operator</span>==(<span class="type">const</span> CaseInsensitive&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="built_in">return</span> (*<span class="keyword">this</span> &lt;=&gt; other) == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="六、constexpr-增强-⭐⭐⭐⭐"><a href="#六、constexpr-增强-⭐⭐⭐⭐" class="headerlink" title="六、constexpr 增强 ⭐⭐⭐⭐"></a>六、constexpr 增强 ⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：强</strong></p><h3 id="6-1-constexpr-动态内存"><a href="#6-1-constexpr-动态内存" class="headerlink" title="6.1 constexpr 动态内存"></a>6.1 constexpr 动态内存</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;  <span class="comment">// 编译时分配</span></span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> x : v) sum += x;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;  <span class="comment">// 编译时释放</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">static_assert</span>(<span class="built_in">compute</span>() == <span class="number">15</span>);</span><br></pre></td></tr></table></figure><h3 id="6-2-constexpr-虚函数"><a href="#6-2-constexpr-虚函数" class="headerlink" title="6.2 constexpr 虚函数"></a>6.2 constexpr 虚函数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="keyword">virtual</span> <span class="type">int</span> <span class="title">value</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Derived</span> : Base &#123;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">value</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Derived d;</span><br><span class="line">    <span class="type">const</span> Base* b = &amp;d;</span><br><span class="line">    <span class="keyword">return</span> b-&gt;<span class="built_in">value</span>();  <span class="comment">// 编译时多态！</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">static_assert</span>(<span class="built_in">test</span>() == <span class="number">2</span>);</span><br></pre></td></tr></table></figure><h3 id="6-3-consteval（立即函数）"><a href="#6-3-consteval（立即函数）" class="headerlink" title="6.3 consteval（立即函数）"></a>6.3 consteval（立即函数）</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">consteval</span> <span class="type">int</span> <span class="title">square</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> n * n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> a = <span class="built_in">square</span>(<span class="number">5</span>);   <span class="comment">// ✅ 必须编译时求值</span></span><br><span class="line"><span class="type">int</span> x = <span class="number">5</span>;</span><br><span class="line"><span class="type">int</span> b = <span class="built_in">square</span>(x);             <span class="comment">// ❌ 编译错误：x 不是常量</span></span><br></pre></td></tr></table></figure><h3 id="6-4-constinit"><a href="#6-4-constinit" class="headerlink" title="6.4 constinit"></a>6.4 constinit</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constinit</span> <span class="type">int</span> global = <span class="built_in">compute</span>();  <span class="comment">// 编译时初始化</span></span><br><span class="line"><span class="comment">// 避免 Static Initialization Order Fiasco</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">modify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    global = <span class="number">100</span>;  <span class="comment">// 运行时可修改</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="七、std-format-⭐⭐⭐⭐"><a href="#七、std-format-⭐⭐⭐⭐" class="headerlink" title="七、std::format ⭐⭐⭐⭐"></a>七、std::format ⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：强</strong></p><h3 id="7-1-类型安全的格式化"><a href="#7-1-类型安全的格式化" class="headerlink" title="7.1 类型安全的格式化"></a>7.1 类型安全的格式化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;format&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::string s = std::format(<span class="string">&quot;Hello, &#123;&#125;!&quot;</span>, <span class="string">&quot;World&quot;</span>);</span><br><span class="line">std::string s = std::format(<span class="string">&quot;&#123;0&#125; + &#123;1&#125; = &#123;2&#125;&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><h3 id="7-2-格式规范"><a href="#7-2-格式规范" class="headerlink" title="7.2 格式规范"></a>7.2 格式规范</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 宽度和对齐</span></span><br><span class="line">std::format(<span class="string">&quot;&#123;:10&#125;&quot;</span>, <span class="number">42</span>);    <span class="comment">// &quot;        42&quot;</span></span><br><span class="line">std::format(<span class="string">&quot;&#123;:&lt;10&#125;&quot;</span>, <span class="number">42</span>);   <span class="comment">// &quot;42        &quot;</span></span><br><span class="line">std::format(<span class="string">&quot;&#123;:^10&#125;&quot;</span>, <span class="number">42</span>);   <span class="comment">// &quot;    42    &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 进制</span></span><br><span class="line">std::format(<span class="string">&quot;&#123;:b&#125;&quot;</span>, <span class="number">42</span>);     <span class="comment">// &quot;101010&quot;</span></span><br><span class="line">std::format(<span class="string">&quot;&#123;:x&#125;&quot;</span>, <span class="number">42</span>);     <span class="comment">// &quot;2a&quot;</span></span><br><span class="line">std::format(<span class="string">&quot;&#123;:#x&#125;&quot;</span>, <span class="number">42</span>);    <span class="comment">// &quot;0x2a&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 精度</span></span><br><span class="line">std::format(<span class="string">&quot;&#123;:.2f&#125;&quot;</span>, <span class="number">3.14159</span>);  <span class="comment">// &quot;3.14&quot;</span></span><br></pre></td></tr></table></figure><h3 id="7-3-自定义类型"><a href="#7-3-自定义类型" class="headerlink" title="7.3 自定义类型"></a>7.3 自定义类型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123; <span class="type">int</span> x, y; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">std</span>::formatter&lt;Point&gt; &#123;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="title">parse</span><span class="params">(format_parse_context&amp; ctx)</span> </span>&#123; <span class="keyword">return</span> ctx.<span class="built_in">begin</span>(); &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">format</span><span class="params">(<span class="type">const</span> Point&amp; p, format_context&amp; ctx)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> std::format_to(ctx.<span class="built_in">out</span>(), <span class="string">&quot;(&#123;&#125;, &#123;&#125;)&quot;</span>, p.x, p.y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">std::format(<span class="string">&quot;Point: &#123;&#125;&quot;</span>, Point&#123;<span class="number">1</span>, <span class="number">2</span>&#125;);  <span class="comment">// &quot;Point: (1, 2)&quot;</span></span><br></pre></td></tr></table></figure><hr><h2 id="八、std-span-⭐⭐⭐⭐"><a href="#八、std-span-⭐⭐⭐⭐" class="headerlink" title="八、std::span ⭐⭐⭐⭐"></a>八、std::span ⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：强</strong></p><h3 id="8-1-连续内存的视图"><a href="#8-1-连续内存的视图" class="headerlink" title="8.1 连续内存的视图"></a>8.1 连续内存的视图</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;span&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">process</span><span class="params">(std::span&lt;<span class="type">int</span>&gt; data)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span>&amp; x : data) x *= <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; vec = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">process</span>(arr);         <span class="comment">// 数组</span></span><br><span class="line"><span class="built_in">process</span>(vec);         <span class="comment">// vector</span></span><br><span class="line"><span class="built_in">process</span>(&#123;arr, <span class="number">3</span>&#125;);    <span class="comment">// 部分数组</span></span><br></pre></td></tr></table></figure><h3 id="8-2-内存布局"><a href="#8-2-内存布局" class="headerlink" title="8.2 内存布局"></a>8.2 内存布局</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">span</span> &#123;</span><br><span class="line">    T* data_;           <span class="comment">// 8 bytes</span></span><br><span class="line">    std::<span class="type">size_t</span> size_;  <span class="comment">// 8 bytes</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// sizeof = 16 bytes，类似 string_view</span></span><br></pre></td></tr></table></figure><h3 id="8-3-静态-vs-动态大小"><a href="#8-3-静态-vs-动态大小" class="headerlink" title="8.3 静态 vs 动态大小"></a>8.3 静态 vs 动态大小</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::span&lt;<span class="type">int</span>&gt; <span class="title">dynamic</span><span class="params">(arr)</span></span>;       <span class="comment">// 运行时大小</span></span><br><span class="line"><span class="function">std::span&lt;<span class="type">int</span>, 5&gt; <span class="title">fixed</span><span class="params">(arr)</span></span>;      <span class="comment">// 编译时大小（更多优化机会）</span></span><br></pre></td></tr></table></figure><hr><h2 id="九、其他重要特性"><a href="#九、其他重要特性" class="headerlink" title="九、其他重要特性"></a>九、其他重要特性</h2><h3 id="9-1-指定初始化"><a href="#9-1-指定初始化" class="headerlink" title="9.1 指定初始化"></a>9.1 指定初始化</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="type">int</span> timeout = <span class="number">30</span>;</span><br><span class="line">    std::string host = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="type">int</span> port = <span class="number">8080</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Config cfg&#123;</span><br><span class="line">    .timeout = <span class="number">60</span>,</span><br><span class="line">    .port = <span class="number">9000</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="9-2-likely-unlikely"><a href="#9-2-likely-unlikely" class="headerlink" title="9.2 [[likely]] / [[unlikely]]"></a>9.2 [[likely]] / [[unlikely]]</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (condition) [[likely]] &#123;</span><br><span class="line">    <span class="comment">// 热路径</span></span><br><span class="line">&#125; <span class="keyword">else</span> [[unlikely]] &#123;</span><br><span class="line">    <span class="comment">// 冷路径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-3-std-source-location"><a href="#9-3-std-source-location" class="headerlink" title="9.3 std::source_location"></a>9.3 std::source_location</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(std::string_view msg,</span></span></span><br><span class="line"><span class="params"><span class="function">         std::source_location loc = std::source_location::current())</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; loc.<span class="built_in">file_name</span>() &lt;&lt; <span class="string">&quot;:&quot;</span> &lt;&lt; loc.<span class="built_in">line</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; msg &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-4-std-jthread"><a href="#9-4-std-jthread" class="headerlink" title="9.4 std::jthread"></a>9.4 std::jthread</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::jthread <span class="title">t</span><span class="params">([](std::stop_token st) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="keyword">while</span> (!st.stop_requested()) &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="comment">// 工作...</span></span></span></span><br><span class="line"><span class="params"><span class="function">    &#125;</span></span></span><br><span class="line"><span class="params"><span class="function">&#125;)</span></span>;</span><br><span class="line"><span class="comment">// 析构时自动 join + 请求停止</span></span><br></pre></td></tr></table></figure><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><div class="table-container"><table><thead><tr><th>特性</th><th>使用频率</th><th>核心价值</th></tr></thead><tbody><tr><td>Concepts</td><td>⭐⭐⭐⭐⭐</td><td>清晰的模板约束</td></tr><tr><td>Ranges</td><td>⭐⭐⭐⭐⭐</td><td>惰性链式数据处理</td></tr><tr><td>Coroutines</td><td>⭐⭐⭐⭐</td><td>异步/生成器编程</td></tr><tr><td>Modules</td><td>⭐⭐⭐⭐</td><td>替代头文件，加速编译</td></tr><tr><td>&lt;=&gt;</td><td>⭐⭐⭐⭐</td><td>一行生成比较运算符</td></tr><tr><td>constexpr 增强</td><td>⭐⭐⭐⭐</td><td>更多编译时计算</td></tr><tr><td>std::format</td><td>⭐⭐⭐⭐</td><td>类型安全格式化</td></tr><tr><td>std::span</td><td>⭐⭐⭐⭐</td><td>连续内存视图</td></tr></tbody></table></div><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://en.cppreference.com/w/cpp/20">cppreference.com - C++20</a></li><li><a href="https://leanpub.com/cpp20">C++20 - The Complete Guide (Nicolai Josuttis)</a></li><li><a href="https://www.stroustrup.com/tour3.html">A Tour of C++ (Bjarne Stroustrup)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> C++标准演进 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 现代C++ </tag>
            
            <tag> 编译器 </tag>
            
            <tag> C++20 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++17 新特性完全指南：从语法到实践</title>
      <link href="/2026/02/05/Cpp17%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2026/02/05/Cpp17%E6%96%B0%E7%89%B9%E6%80%A7%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="C-17-新特性完全指南：从语法到实践"><a href="#C-17-新特性完全指南：从语法到实践" class="headerlink" title="C++17 新特性完全指南：从语法到实践"></a>C++17 新特性完全指南：从语法到实践</h1><p>C++17 是现代 C++ 发展的重要里程碑，引入了大量实用特性。本文按<strong>使用频率和实用性</strong>排序，结合实际应用场景深入分析。</p><hr><h2 id="一、结构化绑定（Structured-Bindings）⭐⭐⭐⭐⭐"><a href="#一、结构化绑定（Structured-Bindings）⭐⭐⭐⭐⭐" class="headerlink" title="一、结构化绑定（Structured Bindings）⭐⭐⭐⭐⭐"></a>一、结构化绑定（Structured Bindings）⭐⭐⭐⭐⭐</h2><p><strong>使用频率：极高</strong> | <strong>实用性：极强</strong></p><h3 id="1-1-基本语法"><a href="#1-1-基本语法" class="headerlink" title="1.1 基本语法"></a>1.1 基本语法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 绑定 pair</span></span><br><span class="line"><span class="function">std::pair&lt;<span class="type">int</span>, std::string&gt; <span class="title">getPerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="number">25</span>, <span class="string">&quot;Alice&quot;</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">auto</span> [age, name] = <span class="built_in">getPerson</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定 tuple</span></span><br><span class="line"><span class="keyword">auto</span> [x, y, z] = std::<span class="built_in">make_tuple</span>(<span class="number">1</span>, <span class="number">2.0</span>, <span class="string">&quot;three&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定数组</span></span><br><span class="line"><span class="type">int</span> arr[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> [a, b, c] = arr;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绑定结构体（所有成员必须 public）</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123; <span class="type">int</span> x, y; &#125;;</span><br><span class="line">Point p&#123;<span class="number">10</span>, <span class="number">20</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> [px, py] = p;</span><br></pre></td></tr></table></figure><h3 id="1-2-编译器如何处理"><a href="#1-2-编译器如何处理" class="headerlink" title="1.2 编译器如何处理"></a>1.2 编译器如何处理</h3><p>编译器将结构化绑定转换为对隐藏变量的引用：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> [age, name] = <span class="built_in">getPerson</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 等价于：</span></span><br><span class="line"><span class="keyword">auto</span> __temp = <span class="built_in">getPerson</span>();</span><br><span class="line"><span class="keyword">auto</span>&amp; age = std::<span class="built_in">get</span>&lt;<span class="number">0</span>&gt;(__temp);</span><br><span class="line"><span class="keyword">auto</span>&amp; name = std::<span class="built_in">get</span>&lt;<span class="number">1</span>&gt;(__temp);</span><br></pre></td></tr></table></figure><p><strong>绑定优先级</strong>：</p><ol><li>数组 → 按索引绑定</li><li>tuple-like 类型 → 通过 <code>std::tuple_size</code> + <code>std::get&lt;N&gt;</code></li><li>聚合类型 → 按成员声明顺序</li></ol><h3 id="1-3-引用语义与常见陷阱"><a href="#1-3-引用语义与常见陷阱" class="headerlink" title="1.3 引用语义与常见陷阱"></a>1.3 引用语义与常见陷阱</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">std::map&lt;<span class="type">int</span>, std::string&gt; m&#123;&#123;<span class="number">1</span>, <span class="string">&quot;one&quot;</span>&#125;, &#123;<span class="number">2</span>, <span class="string">&quot;two&quot;</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 值拷贝：每次迭代都拷贝 pair</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> [key, value] : m) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 常量引用：只读，无拷贝</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [key, value] : m) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 可变引用：可修改原始值</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; [key, value] : m) &#123;</span><br><span class="line">    value += <span class="string">&quot;_modified&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-实用案例"><a href="#1-4-实用案例" class="headerlink" title="1.4 实用案例"></a>1.4 实用案例</h3><p><strong>案例 1：map 遍历</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [name, score] : scores) &#123;</span><br><span class="line">    std::cout &lt;&lt; name &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; score &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>案例 2：多返回值</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> [quotient, remainder] = std::<span class="built_in">div</span>(<span class="number">17</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure></p><p><strong>案例 3：与 std::tie 对比</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++11：需要预声明变量</span></span><br><span class="line"><span class="type">int</span> q, r;</span><br><span class="line">std::<span class="built_in">tie</span>(q, r) = <span class="built_in">divmod</span>(<span class="number">17</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17：一行搞定</span></span><br><span class="line"><span class="keyword">auto</span> [q, r] = <span class="built_in">divmod</span>(<span class="number">17</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure></p><hr><h2 id="二、std-optional-⭐⭐⭐⭐⭐"><a href="#二、std-optional-⭐⭐⭐⭐⭐" class="headerlink" title="二、std::optional ⭐⭐⭐⭐⭐"></a>二、std::optional ⭐⭐⭐⭐⭐</h2><p><strong>使用频率：极高</strong> | <strong>实用性：极强</strong></p><h3 id="2-1-为什么需要-optional"><a href="#2-1-为什么需要-optional" class="headerlink" title="2.1 为什么需要 optional"></a>2.1 为什么需要 optional</h3><p>传统表示”可能没有值”的方式都有缺陷：</p><div class="table-container"><table><thead><tr><th>方式</th><th>问题</th></tr></thead><tbody><tr><td>返回 -1 或 nullptr</td><td>无法区分”无值”和”有效的负数/空指针”</td></tr><tr><td>输出参数 + 返回 bool</td><td>API 丑陋</td></tr><tr><td>抛异常</td><td>性能开销，控制流不明显</td></tr></tbody></table></div><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::optional&lt;<span class="type">int</span>&gt; <span class="title">parseInt</span><span class="params">(std::string_view s)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">stoi</span>(std::<span class="built_in">string</span>(s));</span><br><span class="line">    &#125; <span class="built_in">catch</span> (...) &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-内存布局"><a href="#2-2-内存布局" class="headerlink" title="2.2 内存布局"></a>2.2 内存布局</h3><p><code>std::optional&lt;T&gt;</code> 需要理解其内存结构，因为这影响性能决策：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">optional</span> &#123;</span><br><span class="line">    <span class="built_in">alignas</span>(T) <span class="type">unsigned</span> <span class="type">char</span> storage_[<span class="built_in">sizeof</span>(T)];  <span class="comment">// 原地存储，无堆分配</span></span><br><span class="line">    <span class="type">bool</span> has_value_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">┌──────────────────────────────────┬─────────┐</span><br><span class="line">│         storage_ (T 的大小)       │has_value│</span><br><span class="line">└──────────────────────────────────┴─────────┘</span><br><span class="line">sizeof(optional&lt;T&gt;) ≈ sizeof(T) + 1 + padding</span><br></pre></td></tr></table></figure><p><strong>关键点</strong>：</p><ul><li><strong>无堆分配</strong>：值直接存储在对象内部</li><li><strong>Placement new</strong>：有值时原地构造</li><li><strong>空间开销</strong>：约 1 字节 + 对齐填充</li></ul><h3 id="2-3-核心-API"><a href="#2-3-核心-API" class="headerlink" title="2.3 核心 API"></a>2.3 核心 API</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">std::optional&lt;<span class="type">int</span>&gt; opt = <span class="number">42</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 检查</span></span><br><span class="line"><span class="keyword">if</span> (opt.<span class="built_in">has_value</span>()) &#123; &#125;</span><br><span class="line"><span class="keyword">if</span> (opt) &#123; &#125;  <span class="comment">// bool 转换</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取值</span></span><br><span class="line"><span class="type">int</span> v1 = opt.<span class="built_in">value</span>();       <span class="comment">// 无值时抛 bad_optional_access</span></span><br><span class="line"><span class="type">int</span> v2 = *opt;              <span class="comment">// 无值时 UB（更快）</span></span><br><span class="line"><span class="type">int</span> v3 = opt.<span class="built_in">value_or</span>(<span class="number">-1</span>);  <span class="comment">// 无值时返回默认值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改</span></span><br><span class="line">opt = <span class="number">100</span>;</span><br><span class="line">opt.<span class="built_in">reset</span>();          <span class="comment">// 清空</span></span><br><span class="line">opt.<span class="built_in">emplace</span>(<span class="number">200</span>);     <span class="comment">// 原地构造（避免移动）</span></span><br></pre></td></tr></table></figure><h3 id="2-4-常见陷阱"><a href="#2-4-常见陷阱" class="headerlink" title="2.4 常见陷阱"></a>2.4 常见陷阱</h3><p><strong>陷阱 1：optional<T&> 不存在</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 编译错误</span></span><br><span class="line">std::optional&lt;<span class="type">int</span>&amp;&gt; ref;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 替代方案</span></span><br><span class="line">std::optional&lt;std::reference_wrapper&lt;<span class="type">int</span>&gt;&gt; ref;</span><br></pre></td></tr></table></figure></p><p><strong>陷阱 2：不要用 optional<bool></strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">std::optional&lt;<span class="type">bool</span>&gt; flag;</span><br><span class="line"><span class="keyword">if</span> (flag) &#123;  <span class="comment">// 检查的是&quot;有值&quot;，不是&quot;值为 true&quot;！</span></span><br><span class="line">    <span class="comment">// flag 可能是 false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 明确语义</span></span><br><span class="line"><span class="keyword">if</span> (flag.<span class="built_in">has_value</span>() &amp;&amp; *flag) &#123; &#125;</span><br></pre></td></tr></table></figure></p><h3 id="2-5-实用案例"><a href="#2-5-实用案例" class="headerlink" title="2.5 实用案例"></a>2.5 实用案例</h3><p><strong>案例 1：安全查找</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::optional&lt;User&gt; <span class="title">findUser</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> it = users_.<span class="built_in">find</span>(id);</span><br><span class="line">    <span class="keyword">if</span> (it != users_.<span class="built_in">end</span>()) <span class="keyword">return</span> it-&gt;second;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>案例 2：延迟初始化</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">mutable</span> std::optional&lt;std::string&gt; cached_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">getValue</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!cached_) &#123;</span><br><span class="line">            cached_ = <span class="built_in">expensiveLoad</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *cached_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><hr><h2 id="三、std-variant-⭐⭐⭐⭐⭐"><a href="#三、std-variant-⭐⭐⭐⭐⭐" class="headerlink" title="三、std::variant ⭐⭐⭐⭐⭐"></a>三、std::variant ⭐⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：极强</strong></p><h3 id="3-1-类型安全的联合体"><a href="#3-1-类型安全的联合体" class="headerlink" title="3.1 类型安全的联合体"></a>3.1 类型安全的联合体</h3><p><code>std::variant</code> 是 <code>union</code> 的现代替代品，提供类型安全：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">std::variant&lt;<span class="type">int</span>, <span class="type">double</span>, std::string&gt; v;</span><br><span class="line">v = <span class="number">42</span>;</span><br><span class="line">v = <span class="number">3.14</span>;</span><br><span class="line">v = <span class="string">&quot;hello&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="3-2-内存布局"><a href="#3-2-内存布局" class="headerlink" title="3.2 内存布局"></a>3.2 内存布局</h3><p>理解 variant 的内存布局对性能分析很重要：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Ts&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">variant</span> &#123;</span><br><span class="line">    std::<span class="type">aligned_union_t</span>&lt;<span class="number">0</span>, Ts...&gt; storage_;  <span class="comment">// 能容纳最大类型</span></span><br><span class="line">    std::<span class="type">size_t</span> index_;                        <span class="comment">// 当前活跃类型索引</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌───────────────────────────────────┬────────┐</span><br><span class="line">│    storage_ (max(sizeof(Ts)...))  │ index_ │</span><br><span class="line">└───────────────────────────────────┴────────┘</span><br></pre></td></tr></table></figure><p><strong>关键点</strong>：</p><ul><li>大小 = 最大成员大小 + size_t</li><li>同一时刻只有一种类型有效</li><li>切换类型时自动调用析构/构造</li></ul><h3 id="3-3-访问方式"><a href="#3-3-访问方式" class="headerlink" title="3.3 访问方式"></a>3.3 访问方式</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">std::variant&lt;<span class="type">int</span>, std::string&gt; v = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式 1：std::get（类型不匹配抛异常）</span></span><br><span class="line">std::string&amp; s = std::<span class="built_in">get</span>&lt;std::string&gt;(v);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式 2：std::get_if（返回指针，不匹配返回 nullptr）</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">auto</span>* p = std::<span class="built_in">get_if</span>&lt;<span class="type">int</span>&gt;(&amp;v)) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;int: &quot;</span> &lt;&lt; *p &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方式 3：std::visit（推荐）</span></span><br><span class="line">std::<span class="built_in">visit</span>([](<span class="keyword">auto</span>&amp;&amp; arg) &#123;</span><br><span class="line">    std::cout &lt;&lt; arg &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;, v);</span><br></pre></td></tr></table></figure><h3 id="3-4-std-visit-与重载技巧"><a href="#3-4-std-visit-与重载技巧" class="headerlink" title="3.4 std::visit 与重载技巧"></a>3.4 std::visit 与重载技巧</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++17 重载技巧</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span>... Ts&gt; <span class="keyword">struct</span> <span class="title class_">overloaded</span> : Ts... &#123; <span class="function"><span class="keyword">using</span> <span class="title">Ts::operator</span><span class="params">()</span>...</span>; &#125;;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span>... Ts&gt; <span class="title">overloaded</span><span class="params">(Ts...)</span> -&gt; overloaded&lt;Ts...&gt;</span>;</span><br><span class="line"></span><br><span class="line">std::<span class="built_in">visit</span>(overloaded&#123;</span><br><span class="line">    [](<span class="type">int</span> i)    &#123; std::cout &lt;&lt; <span class="string">&quot;int: &quot;</span> &lt;&lt; i; &#125;,</span><br><span class="line">    [](<span class="type">double</span> d) &#123; std::cout &lt;&lt; <span class="string">&quot;double: &quot;</span> &lt;&lt; d; &#125;,</span><br><span class="line">    [](<span class="type">const</span> std::string&amp; s) &#123; std::cout &lt;&lt; <span class="string">&quot;string: &quot;</span> &lt;&lt; s; &#125;</span><br><span class="line">&#125;, v);</span><br></pre></td></tr></table></figure><h3 id="3-5-实用案例"><a href="#3-5-实用案例" class="headerlink" title="3.5 实用案例"></a>3.5 实用案例</h3><p><strong>案例 1：JSON 值</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">JsonNull</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">using</span> JsonValue = std::variant&lt;</span><br><span class="line">    JsonNull, <span class="type">bool</span>, <span class="type">int64_t</span>, <span class="type">double</span>, std::string,</span><br><span class="line">    std::vector&lt;JsonValue&gt;,</span><br><span class="line">    std::map&lt;std::string, JsonValue&gt;</span><br><span class="line">&gt;;</span><br></pre></td></tr></table></figure></p><p><strong>案例 2：状态机</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Idle</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Running</span> &#123; <span class="type">int</span> progress; &#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Done</span> &#123; std::string result; &#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Failed</span> &#123; std::string error; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> State = std::variant&lt;Idle, Running, Done, Failed&gt;;</span><br></pre></td></tr></table></figure></p><p><strong>案例 3：命令模式</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Move</span> &#123; <span class="type">int</span> x, y; &#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Rotate</span> &#123; <span class="type">double</span> angle; &#125;;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Fire</span> &#123; <span class="type">int</span> power; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Command = std::variant&lt;Move, Rotate, Fire&gt;;</span><br></pre></td></tr></table></figure></p><hr><h2 id="四、if-constexpr-⭐⭐⭐⭐⭐"><a href="#四、if-constexpr-⭐⭐⭐⭐⭐" class="headerlink" title="四、if constexpr ⭐⭐⭐⭐⭐"></a>四、if constexpr ⭐⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：极强</strong></p><h3 id="4-1-编译时分支"><a href="#4-1-编译时分支" class="headerlink" title="4.1 编译时分支"></a>4.1 编译时分支</h3><p><code>if constexpr</code> 在编译时求值，未选中的分支<strong>不会被编译</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">process</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_integral_v&lt;T&gt;)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value * <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_floating_point_v&lt;T&gt;) &#123;</span><br><span class="line">        <span class="keyword">return</span> value * <span class="number">2.5</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-与普通-if-的关键区别"><a href="#4-2-与普通-if-的关键区别" class="headerlink" title="4.2 与普通 if 的关键区别"></a>4.2 与普通 if 的关键区别</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">example</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ❌ 普通 if：所有分支都必须能编译</span></span><br><span class="line">    <span class="keyword">if</span> (std::is_integral_v&lt;T&gt;) &#123;</span><br><span class="line">        std::cout &lt;&lt; t % <span class="number">2</span>;  <span class="comment">// T=double 时编译错误！</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ✅ if constexpr：未选中分支被丢弃</span></span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_integral_v&lt;T&gt;)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; t % <span class="number">2</span>;  <span class="comment">// T=double 时此分支不存在</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-替代-SFINAE"><a href="#4-3-替代-SFINAE" class="headerlink" title="4.3 替代 SFINAE"></a>4.3 替代 SFINAE</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++14 SFINAE（晦涩难懂）</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, std::<span class="type">enable_if_t</span>&lt;std::is_integral_v&lt;T&gt;, <span class="type">int</span>&gt; = <span class="number">0</span>&gt;</span><br><span class="line"><span class="type">void</span> <span class="built_in">process</span>(T t) &#123; <span class="comment">/* 整数版本 */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, std::<span class="type">enable_if_t</span>&lt;std::is_floating_point_v&lt;T&gt;, <span class="type">int</span>&gt; = <span class="number">0</span>&gt;</span><br><span class="line"><span class="type">void</span> <span class="built_in">process</span>(T t) &#123; <span class="comment">/* 浮点版本 */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17 if constexpr（清晰易读）</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="type">void</span> <span class="built_in">process</span>(T t) &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_integral_v&lt;T&gt;) &#123;</span><br><span class="line">        <span class="comment">/* 整数版本 */</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_floating_point_v&lt;T&gt;) &#123;</span><br><span class="line">        <span class="comment">/* 浮点版本 */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-实用案例"><a href="#4-4-实用案例" class="headerlink" title="4.4 实用案例"></a>4.4 实用案例</h3><p><strong>案例 1：递归模板终止</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T first, Args... rest)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; first;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(<span class="keyword">sizeof</span>...(rest) &gt; <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;, &quot;</span>;</span><br><span class="line">        <span class="built_in">print</span>(rest...);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>案例 2：类型特化</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">std::string <span class="title">toString</span><span class="params">(<span class="type">const</span> T&amp; value)</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_same_v&lt;T, std::string&gt;)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_arithmetic_v&lt;T&gt;) &#123;</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">to_string</span>(value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">static_assert</span>(always_false&lt;T&gt;, <span class="string">&quot;Unsupported type&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><hr><h2 id="五、std-string-view-⭐⭐⭐⭐⭐"><a href="#五、std-string-view-⭐⭐⭐⭐⭐" class="headerlink" title="五、std::string_view ⭐⭐⭐⭐⭐"></a>五、std::string_view ⭐⭐⭐⭐⭐</h2><p><strong>使用频率：极高</strong> | <strong>实用性：极强</strong></p><h3 id="5-1-非拥有字符串视图"><a href="#5-1-非拥有字符串视图" class="headerlink" title="5.1 非拥有字符串视图"></a>5.1 非拥有字符串视图</h3><p><code>string_view</code> 是指向现有字符串的轻量级视图：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">process</span><span class="params">(std::string_view sv)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; sv &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::string s = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="built_in">process</span>(s);         <span class="comment">// 无拷贝</span></span><br><span class="line"><span class="built_in">process</span>(<span class="string">&quot;world&quot;</span>);   <span class="comment">// 无拷贝</span></span><br><span class="line"><span class="built_in">process</span>(s.<span class="built_in">c_str</span>()); <span class="comment">// 无拷贝</span></span><br></pre></td></tr></table></figure><h3 id="5-2-内存布局"><a href="#5-2-内存布局" class="headerlink" title="5.2 内存布局"></a>5.2 内存布局</h3><p>理解 <code>string_view</code> 的轻量级本质：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">string_view</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">char</span>* data_;   <span class="comment">// 8 bytes</span></span><br><span class="line">    std::<span class="type">size_t</span> size_;   <span class="comment">// 8 bytes</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// sizeof = 16 bytes，无堆分配</span></span><br></pre></td></tr></table></figure><p><strong>对比 <code>std::string</code></strong>：</p><ul><li><code>std::string</code>：24+ bytes + 堆分配的字符数据</li><li><code>std::string_view</code>：固定 16 bytes，零分配</li></ul><h3 id="5-3-性能优势"><a href="#5-3-性能优势" class="headerlink" title="5.3 性能优势"></a>5.3 性能优势</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子串操作对比</span></span><br><span class="line">std::string input = <span class="string">&quot;key1=value1;key2=value2&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// std::string::substr：每次分配</span></span><br><span class="line"><span class="keyword">auto</span> sub = input.<span class="built_in">substr</span>(<span class="number">5</span>, <span class="number">6</span>);  <span class="comment">// 堆分配</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// string_view::substr：零分配</span></span><br><span class="line">std::string_view sv = input;</span><br><span class="line"><span class="keyword">auto</span> sub = sv.<span class="built_in">substr</span>(<span class="number">5</span>, <span class="number">6</span>);     <span class="comment">// 只调整指针</span></span><br></pre></td></tr></table></figure><h3 id="5-4-生命周期陷阱"><a href="#5-4-生命周期陷阱" class="headerlink" title="5.4 生命周期陷阱"></a>5.4 生命周期陷阱</h3><p><strong>这是 string_view 最危险的地方</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 危险：返回指向局部变量的视图</span></span><br><span class="line"><span class="function">std::string_view <span class="title">bad</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::string local = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> local;  <span class="comment">// local 销毁，悬垂指针！</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 危险：临时对象</span></span><br><span class="line">std::string_view sv = std::<span class="built_in">string</span>(<span class="string">&quot;temp&quot;</span>);  <span class="comment">// 临时对象立即销毁！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 安全：确保原始数据存活</span></span><br><span class="line">std::string persistent = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">std::string_view sv = persistent;  <span class="comment">// OK</span></span><br></pre></td></tr></table></figure><h3 id="5-5-最佳实践"><a href="#5-5-最佳实践" class="headerlink" title="5.5 最佳实践"></a>5.5 最佳实践</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ✅ 函数参数：用 string_view 替代 const string&amp;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(std::string_view msg)</span></span>;  <span class="comment">// 接受任何字符串类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ❌ 返回值：除非确保生命周期，否则不要返回</span></span><br><span class="line"><span class="function">std::string_view <span class="title">getName</span><span class="params">()</span></span>;  <span class="comment">// 危险！</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 成员变量：慎用，除非生命周期明确</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parser</span> &#123;</span><br><span class="line">    std::string source_;        <span class="comment">// 拥有数据</span></span><br><span class="line">    std::string_view current_;  <span class="comment">// 指向 source_ 的视图</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="六、折叠表达式（Fold-Expressions）⭐⭐⭐⭐"><a href="#六、折叠表达式（Fold-Expressions）⭐⭐⭐⭐" class="headerlink" title="六、折叠表达式（Fold Expressions）⭐⭐⭐⭐"></a>六、折叠表达式（Fold Expressions）⭐⭐⭐⭐</h2><p><strong>使用频率：中高</strong> | <strong>实用性：强</strong></p><h3 id="6-1-基本语法"><a href="#6-1-基本语法" class="headerlink" title="6.1 基本语法"></a>6.1 基本语法</h3><p>折叠表达式简化参数包展开：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 求和</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">sum</span><span class="params">(Args... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (args + ...);  <span class="comment">// 右折叠</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sum</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);  <span class="comment">// 15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 带初始值（处理空包）</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">sum_safe</span><span class="params">(Args... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (args + ... + <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">sum_safe</span>();  <span class="comment">// 0</span></span><br></pre></td></tr></table></figure><h3 id="6-2-四种形式"><a href="#6-2-四种形式" class="headerlink" title="6.2 四种形式"></a>6.2 四种形式</h3><div class="table-container"><table><thead><tr><th>语法</th><th>名称</th><th>展开方式</th></tr></thead><tbody><tr><td><code>(E op ...)</code></td><td>一元右折叠</td><td><code>E1 op (E2 op (E3 op E4))</code></td></tr><tr><td><code>(... op E)</code></td><td>一元左折叠</td><td><code>((E1 op E2) op E3) op E4</code></td></tr><tr><td><code>(E op ... op I)</code></td><td>二元右折叠</td><td><code>E1 op (E2 op (E3 op I))</code></td></tr><tr><td><code>(I op ... op E)</code></td><td>二元左折叠</td><td><code>((I op E1) op E2) op E3</code></td></tr></tbody></table></div><h3 id="6-3-实用案例"><a href="#6-3-实用案例" class="headerlink" title="6.3 实用案例"></a>6.3 实用案例</h3><p><strong>案例 1：打印所有参数</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(Args... args)</span> </span>&#123;</span><br><span class="line">    (std::cout &lt;&lt; ... &lt;&lt; args) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>, <span class="string">&quot; + &quot;</span>, <span class="number">2</span>, <span class="string">&quot; = &quot;</span>, <span class="number">3</span>);  <span class="comment">// &quot;1 + 2 = 3&quot;</span></span><br></pre></td></tr></table></figure></p><p><strong>案例 2：所有条件为真</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Preds&gt;</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">all</span><span class="params">(Preds... preds)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (preds &amp;&amp; ...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">all</span>(x &gt; <span class="number">0</span>, y &gt; <span class="number">0</span>, z &gt; <span class="number">0</span>);</span><br></pre></td></tr></table></figure></p><p><strong>案例 3：逗号折叠调用多个函数</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>... Funcs&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">call_all</span><span class="params">(Funcs... funcs)</span> </span>&#123;</span><br><span class="line">    (<span class="built_in">funcs</span>(), ...);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">call_all</span>(init, setup, run);</span><br></pre></td></tr></table></figure></p><hr><h2 id="七、内联变量（Inline-Variables）⭐⭐⭐⭐"><a href="#七、内联变量（Inline-Variables）⭐⭐⭐⭐" class="headerlink" title="七、内联变量（Inline Variables）⭐⭐⭐⭐"></a>七、内联变量（Inline Variables）⭐⭐⭐⭐</h2><p><strong>使用频率：中高</strong> | <strong>实用性：强</strong></p><h3 id="7-1-解决的问题"><a href="#7-1-解决的问题" class="headerlink" title="7.1 解决的问题"></a>7.1 解决的问题</h3><p>C++17 之前，静态成员变量必须在 .cpp 中定义：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// header.h</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">const</span> std::string PATH;  <span class="comment">// 声明</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// config.cpp（必须有这个文件）</span></span><br><span class="line"><span class="type">const</span> std::string Config::PATH = <span class="string">&quot;/etc/config&quot;</span>;</span><br></pre></td></tr></table></figure><p>C++17 允许直接在头文件定义：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// header.h（只需这一个文件）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span> &#123;</span><br><span class="line">    <span class="keyword">inline</span> <span class="type">static</span> <span class="type">const</span> std::string PATH = <span class="string">&quot;/etc/config&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="7-2-工作原理"><a href="#7-2-工作原理" class="headerlink" title="7.2 工作原理"></a>7.2 工作原理</h3><p>编译器使用<strong>弱符号</strong>和 <strong>COMDAT 折叠</strong>确保整个程序只有一个实例：</p><ul><li>每个翻译单元生成一个副本</li><li>链接器合并为一个</li></ul><h3 id="7-3-constexpr-静态成员自动-inline"><a href="#7-3-constexpr-静态成员自动-inline" class="headerlink" title="7.3 constexpr 静态成员自动 inline"></a>7.3 constexpr 静态成员自动 inline</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Math</span> &#123;</span><br><span class="line">    <span class="comment">// C++17：constexpr 静态成员自动 inline</span></span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">double</span> PI = <span class="number">3.14159</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span>* p = &amp;Math::PI;  <span class="comment">// OK，无需额外定义</span></span><br></pre></td></tr></table></figure><hr><h2 id="八、std-filesystem-⭐⭐⭐⭐"><a href="#八、std-filesystem-⭐⭐⭐⭐" class="headerlink" title="八、std::filesystem ⭐⭐⭐⭐"></a>八、std::filesystem ⭐⭐⭐⭐</h2><p><strong>使用频率：高</strong> | <strong>实用性：强</strong></p><h3 id="8-1-路径操作"><a href="#8-1-路径操作" class="headerlink" title="8.1 路径操作"></a>8.1 路径操作</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;filesystem&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> fs = std::filesystem;</span><br><span class="line"></span><br><span class="line">fs::path p = <span class="string">&quot;/home/user/file.txt&quot;</span>;</span><br><span class="line">p.<span class="built_in">filename</span>();     <span class="comment">// &quot;file.txt&quot;</span></span><br><span class="line">p.<span class="built_in">extension</span>();    <span class="comment">// &quot;.txt&quot;</span></span><br><span class="line">p.<span class="built_in">parent_path</span>();  <span class="comment">// &quot;/home/user&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 路径拼接</span></span><br><span class="line">fs::path full = <span class="string">&quot;/home&quot;</span> / <span class="string">&quot;user&quot;</span> / <span class="string">&quot;file.txt&quot;</span>;</span><br></pre></td></tr></table></figure><h3 id="8-2-常用操作"><a href="#8-2-常用操作" class="headerlink" title="8.2 常用操作"></a>8.2 常用操作</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs::<span class="built_in">exists</span>(p);              <span class="comment">// 是否存在</span></span><br><span class="line">fs::<span class="built_in">file_size</span>(p);           <span class="comment">// 文件大小</span></span><br><span class="line">fs::<span class="built_in">is_regular_file</span>(p);     <span class="comment">// 是否普通文件</span></span><br><span class="line">fs::<span class="built_in">is_directory</span>(p);        <span class="comment">// 是否目录</span></span><br><span class="line">fs::<span class="built_in">create_directories</span>(p);  <span class="comment">// 递归创建目录</span></span><br><span class="line">fs::<span class="built_in">remove</span>(p);              <span class="comment">// 删除</span></span><br><span class="line">fs::<span class="built_in">copy</span>(src, dst);         <span class="comment">// 拷贝</span></span><br></pre></td></tr></table></figure><h3 id="8-3-目录遍历"><a href="#8-3-目录遍历" class="headerlink" title="8.3 目录遍历"></a>8.3 目录遍历</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非递归</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; entry : fs::<span class="built_in">directory_iterator</span>(<span class="string">&quot;/home&quot;</span>)) &#123;</span><br><span class="line">    std::cout &lt;&lt; entry.<span class="built_in">path</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; entry : fs::<span class="built_in">recursive_directory_iterator</span>(<span class="string">&quot;/home&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (entry.<span class="built_in">is_regular_file</span>() &amp;&amp; entry.<span class="built_in">path</span>().<span class="built_in">extension</span>() == <span class="string">&quot;.cpp&quot;</span>) &#123;</span><br><span class="line">        std::cout &lt;&lt; entry.<span class="built_in">path</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="九、其他实用特性"><a href="#九、其他实用特性" class="headerlink" title="九、其他实用特性"></a>九、其他实用特性</h2><h3 id="9-1-nodiscard-属性"><a href="#9-1-nodiscard-属性" class="headerlink" title="9.1 [[nodiscard]] 属性"></a>9.1 [[nodiscard]] 属性</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[[nodiscard]] <span class="function">ErrorCode <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">init</span>();  <span class="comment">// 警告：忽略返回值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// C++17 也可用于类</span></span><br><span class="line"><span class="keyword">class</span> [[nodiscard]] Result &#123; &#125;;</span><br></pre></td></tr></table></figure><h3 id="9-2-maybe-unused-属性"><a href="#9-2-maybe-unused-属性" class="headerlink" title="9.2 [[maybe_unused]] 属性"></a>9.2 [[maybe_unused]] 属性</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">debug</span><span class="params">([[maybe_unused]] <span class="type">int</span> verbosity)</span> </span>&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    <span class="built_in">log</span>(verbosity);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="9-3-std-any"><a href="#9-3-std-any" class="headerlink" title="9.3 std::any"></a>9.3 std::any</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::any a = <span class="number">42</span>;</span><br><span class="line">a = std::<span class="built_in">string</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">a = <span class="number">3.14</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> val = std::<span class="built_in">any_cast</span>&lt;<span class="type">double</span>&gt;(a);  <span class="comment">// 类型不匹配抛异常</span></span><br></pre></td></tr></table></figure><h3 id="9-4-并行算法"><a href="#9-4-并行算法" class="headerlink" title="9.4 并行算法"></a>9.4 并行算法</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;execution&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; v = &#123; <span class="comment">/* ... */</span> &#125;;</span><br><span class="line">std::<span class="built_in">sort</span>(std::execution::par, v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>());</span><br></pre></td></tr></table></figure><h3 id="9-5-类模板参数推导（CTAD）"><a href="#9-5-类模板参数推导（CTAD）" class="headerlink" title="9.5 类模板参数推导（CTAD）"></a>9.5 类模板参数推导（CTAD）</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::pair <span class="title">p</span><span class="params">(<span class="number">1</span>, <span class="number">2.0</span>)</span></span>;      <span class="comment">// pair&lt;int, double&gt;</span></span><br><span class="line">std::vector v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;   <span class="comment">// vector&lt;int&gt;</span></span><br><span class="line"><span class="function">std::lock_guard <span class="title">lock</span><span class="params">(m)</span></span>;  <span class="comment">// lock_guard&lt;std::mutex&gt;</span></span><br></pre></td></tr></table></figure><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><div class="table-container"><table><thead><tr><th>特性</th><th>使用频率</th><th>核心价值</th></tr></thead><tbody><tr><td>结构化绑定</td><td>⭐⭐⭐⭐⭐</td><td>简化多值解包</td></tr><tr><td>std::optional</td><td>⭐⭐⭐⭐⭐</td><td>安全表示可空值</td></tr><tr><td>std::variant</td><td>⭐⭐⭐⭐⭐</td><td>类型安全的联合体</td></tr><tr><td>if constexpr</td><td>⭐⭐⭐⭐⭐</td><td>清晰的编译时分支</td></tr><tr><td>std::string_view</td><td>⭐⭐⭐⭐⭐</td><td>零拷贝字符串传递</td></tr><tr><td>折叠表达式</td><td>⭐⭐⭐⭐</td><td>简化参数包操作</td></tr><tr><td>内联变量</td><td>⭐⭐⭐⭐</td><td>头文件内定义变量</td></tr><tr><td>std::filesystem</td><td>⭐⭐⭐⭐</td><td>跨平台文件操作</td></tr></tbody></table></div><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://en.cppreference.com/w/cpp/17">cppreference.com - C++17</a></li><li><a href="https://leanpub.com/cpp17">C++17 - The Complete Guide (Nicolai Josuttis)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> C++标准演进 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> C++17 </tag>
            
            <tag> 现代C++ </tag>
            
            <tag> 编译器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++17 Result 类型设计：构造函数优化与值语义</title>
      <link href="/2026/02/05/Cpp17-Result%E7%B1%BB%E5%9E%8B%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%BC%98%E5%8C%96/"/>
      <url>/2026/02/05/Cpp17-Result%E7%B1%BB%E5%9E%8B%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h1 id="C-17-Result-类型设计：构造函数优化与值语义"><a href="#C-17-Result-类型设计：构造函数优化与值语义" class="headerlink" title="C++17 Result 类型设计：构造函数优化与值语义"></a>C++17 Result 类型设计：构造函数优化与值语义</h1><p>在现代 C++ 开发中，<code>Result&lt;T, E&gt;</code> 类型（也称 Expected）是替代异常和错误码的优雅方案。本文将深入分析 Result 类型的构造函数设计，探讨如何利用 C++17 特性优化值传递与移动语义。</p><hr><h2 id="一、问题背景"><a href="#一、问题背景" class="headerlink" title="一、问题背景"></a>一、问题背景</h2><h3 id="1-1-传统错误处理的局限"><a href="#1-1-传统错误处理的局限" class="headerlink" title="1.1 传统错误处理的局限"></a>1.1 传统错误处理的局限</h3><p><strong>方式 1：异常</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>优点：调用侧代码简洁</li><li>缺点：性能开销、流程控制隐式、不适合嵌入式</li></ul><p><strong>方式 2：错误码</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">Divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span>* result)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    *result = a / b;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>优点：性能好</li><li>缺点：API 丑陋、容易忘记检查</li></ul><h3 id="1-2-Result-类型"><a href="#1-2-Result-类型" class="headerlink" title="1.2 Result 类型"></a>1.2 Result 类型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    std::optional&lt;T&gt; value;</span><br><span class="line">    std::string error;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">ok</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value.<span class="built_in">has_value</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Result&lt;<span class="type">int</span>&gt; <span class="title">Divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">return</span> Result&lt;<span class="type">int</span>&gt;&#123;&#123;&#125;, <span class="string">&quot;Division by zero&quot;</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> Result&lt;<span class="type">int</span>&gt;&#123;a / b, <span class="string">&quot;&quot;</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>优点：</p><ul><li>强制调用者处理错误（类型系统保证）</li><li>零运行时开销（无异常机制）</li><li>API 表达力强</li></ul><hr><h2 id="二、基础实现"><a href="#二、基础实现" class="headerlink" title="二、基础实现"></a>二、基础实现</h2><h3 id="2-1-初始版本"><a href="#2-1-初始版本" class="headerlink" title="2.1 初始版本"></a>2.1 初始版本</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Error</span> &#123;</span><br><span class="line">    std::string msg;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    std::optional&lt;T&gt; data = std::<span class="literal">nullopt</span>;</span><br><span class="line">    std::string message;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Result</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成功路径：拷贝</span></span><br><span class="line">    <span class="built_in">Result</span>(<span class="type">const</span> T&amp; value, std::string msg = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        : <span class="built_in">data</span>(value), <span class="built_in">message</span>(std::<span class="built_in">move</span>(msg)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成功路径：移动</span></span><br><span class="line">    <span class="built_in">Result</span>(T&amp;&amp; value, std::string msg = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        : <span class="built_in">data</span>(std::<span class="built_in">move</span>(value)), <span class="built_in">message</span>(std::<span class="built_in">move</span>(msg)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 失败路径：拷贝</span></span><br><span class="line">    <span class="built_in">Result</span>(<span class="type">const</span> Error&amp; error) : <span class="built_in">message</span>(error.msg) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 失败路径：移动</span></span><br><span class="line">    <span class="built_in">Result</span>(Error&amp;&amp; error) : <span class="built_in">message</span>(std::<span class="built_in">move</span>(error.msg)) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">ok</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> data.<span class="built_in">has_value</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">value</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> *data; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="2-2-问题分析"><a href="#2-2-问题分析" class="headerlink" title="2.2 问题分析"></a>2.2 问题分析</h3><p><strong>问题 1：构造函数过多</strong></p><p>为了同时支持左值和右值，需要成对编写构造函数：</p><ul><li><code>Result(const Error&amp;)</code> + <code>Result(Error&amp;&amp;)</code></li><li><code>Result(const T&amp;, ...)</code> + <code>Result(T&amp;&amp;, ...)</code></li></ul><p>代码冗余，维护成本高。</p><p><strong>问题 2：const 左值只能拷贝</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> Error err&#123;<span class="string">&quot;Something went wrong&quot;</span>&#125;;</span><br><span class="line"><span class="function">Result&lt;<span class="type">int</span>&gt; <span class="title">r</span><span class="params">(err)</span></span>;  <span class="comment">// 调用 Result(const Error&amp;)，必须拷贝</span></span><br></pre></td></tr></table></figure><p>这里拷贝是不可避免的——不能从 <code>const</code> 对象移动。</p><hr><h2 id="三、C-17-优化：Sink-Pattern"><a href="#三、C-17-优化：Sink-Pattern" class="headerlink" title="三、C++17 优化：Sink Pattern"></a>三、C++17 优化：Sink Pattern</h2><h3 id="3-1-核心思想"><a href="#3-1-核心思想" class="headerlink" title="3.1 核心思想"></a>3.1 核心思想</h3><p><strong>传值 + 移动</strong>（Value + Move）是 C++ 社区推荐的惯用法：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 合并两个构造函数为一个</span></span><br><span class="line"><span class="built_in">Result</span>(Error error) : <span class="built_in">message</span>(std::<span class="built_in">move</span>(error.msg)) &#123;&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-原理分析"><a href="#3-2-原理分析" class="headerlink" title="3.2 原理分析"></a>3.2 原理分析</h3><p>当调用 <code>Result(Error error)</code> 时：</p><div class="table-container"><table><thead><tr><th>场景</th><th>参数构造方式</th><th>后续操作</th><th>总开销</th></tr></thead><tbody><tr><td>临时对象 <code>Result(Error&#123;&quot;...&quot;&#125;)</code></td><td>移动构造</td><td><code>std::move</code></td><td>1 次移动</td></tr><tr><td>具名左值 <code>Result(myError)</code></td><td>拷贝构造</td><td><code>std::move</code></td><td>1 次拷贝 + 1 次移动</td></tr><tr><td><code>std::move(myError)</code></td><td>移动构造</td><td><code>std::move</code></td><td>2 次移动</td></tr></tbody></table></div><p><strong>关键洞察</strong>：</p><p>对于 <code>std::string</code> 这类<strong>移动成本极低</strong>的类型（仅交换几个指针），额外的一次移动开销可以忽略。</p><h3 id="3-3-移动成本分析"><a href="#3-3-移动成本分析" class="headerlink" title="3.3 移动成本分析"></a>3.3 移动成本分析</h3><div class="table-container"><table><thead><tr><th>类型</th><th>移动操作</th><th>成本</th></tr></thead><tbody><tr><td><code>std::string</code></td><td>3 个指针交换</td><td>~3 条指令</td></tr><tr><td><code>std::vector</code></td><td>3 个指针交换</td><td>~3 条指令</td></tr><tr><td><code>std::unique_ptr</code></td><td>1 个指针交换</td><td>~1 条指令</td></tr><tr><td><code>std::array&lt;int, 1000&gt;</code></td><td>元素逐个拷贝</td><td>~1000 条指令</td></tr></tbody></table></div><p><strong>结论</strong>：对于”移动 cheap”的类型，Sink Pattern 是最佳选择；对于”移动 expensive”的类型，仍需考虑引用重载。</p><hr><h2 id="四、优化后的完整实现"><a href="#四、优化后的完整实现" class="headerlink" title="四、优化后的完整实现"></a>四、优化后的完整实现</h2><h3 id="4-1-最终代码"><a href="#4-1-最终代码" class="headerlink" title="4.1 最终代码"></a>4.1 最终代码</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Error</span> &#123;</span><br><span class="line">    std::string msg;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 支持字面量构造</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Error</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* m)</span> : msg(m) &#123;</span>&#125;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Error</span><span class="params">(std::string m)</span> : msg(std::move(m)) &#123;</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 默认构造：无效状态</span></span><br><span class="line">    <span class="built_in">Result</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 成功路径：值语义</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> U = T,</span><br><span class="line">             <span class="keyword">typename</span> = std::<span class="type">enable_if_t</span>&lt;std::is_convertible_v&lt;U, T&gt;&gt;&gt;</span><br><span class="line">    <span class="built_in">Result</span>(U&amp;&amp; value, std::string msg = <span class="string">&quot;&quot;</span>)</span><br><span class="line">        : <span class="built_in">data_</span>(std::forward&lt;U&gt;(value))</span><br><span class="line">        , <span class="built_in">message_</span>(std::<span class="built_in">move</span>(msg)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 失败路径：Sink Pattern</span></span><br><span class="line">    <span class="built_in">Result</span>(Error error)</span><br><span class="line">        : <span class="built_in">message_</span>(std::<span class="built_in">move</span>(error.msg)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 状态查询</span></span><br><span class="line">    <span class="type">bool</span> <span class="built_in">ok</span>() <span class="type">const</span> <span class="keyword">noexcept</span> &#123; <span class="keyword">return</span> data_.<span class="built_in">has_value</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="keyword">operator</span> <span class="title">bool</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">ok</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 值访问（安全版本）</span></span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">value</span><span class="params">()</span> <span class="type">const</span>&amp; </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">ok</span>()) <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(message_);</span><br><span class="line">        <span class="keyword">return</span> *data_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">T&amp;&amp; <span class="title">value</span><span class="params">()</span> &amp;&amp; </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">ok</span>()) <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(message_);</span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">move</span>(*data_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 值访问（不抛异常）</span></span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">value_or</span><span class="params">(<span class="type">const</span> T&amp; default_val)</span> <span class="type">const</span>&amp; <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ok</span>() ? *data_ : default_val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 错误信息</span></span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">error</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> message_; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::optional&lt;T&gt; data_ = std::<span class="literal">nullopt</span>;</span><br><span class="line">    std::string message_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="4-2-使用示例"><a href="#4-2-使用示例" class="headerlink" title="4.2 使用示例"></a>4.2 使用示例</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Result&lt;<span class="type">int</span>&gt; <span class="title">Divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Error&#123;<span class="string">&quot;Division by zero&quot;</span>&#125;;  <span class="comment">// 隐式转换</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b;  <span class="comment">// 隐式转换</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Example</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> result = <span class="built_in">Divide</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 方式 1：显式检查</span></span><br><span class="line">    <span class="keyword">if</span> (result.<span class="built_in">ok</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Result: &quot;</span> &lt;&lt; result.<span class="built_in">value</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Error: &quot;</span> &lt;&lt; result.<span class="built_in">error</span>() &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 方式 2：value_or</span></span><br><span class="line">    <span class="type">int</span> val = result.<span class="built_in">value_or</span>(<span class="number">-1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 方式 3：bool 转换</span></span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="五、进阶优化"><a href="#五、进阶优化" class="headerlink" title="五、进阶优化"></a>五、进阶优化</h2><h3 id="5-1-std-string-view-优化"><a href="#5-1-std-string-view-优化" class="headerlink" title="5.1 std::string_view 优化"></a>5.1 std::string_view 优化</h3><p>对于频繁构造错误的场景，可以使用 <code>string_view</code> 避免堆分配：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line">    std::variant&lt;T, std::string&gt; storage_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Result</span>(Error error) : <span class="built_in">storage_</span>(std::<span class="built_in">move</span>(error.msg)) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 静态错误消息优化</span></span><br><span class="line">    <span class="function"><span class="type">static</span> Result <span class="title">Fail</span><span class="params">(std::string_view msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Result</span>(Error&#123;std::<span class="built_in">string</span>(msg)&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-2-nodiscard-属性"><a href="#5-2-nodiscard-属性" class="headerlink" title="5.2 [[nodiscard]] 属性"></a>5.2 [[nodiscard]] 属性</h3><p>防止忽略返回值：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> [[nodiscard]] Result &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">[[nodiscard]] <span class="function">Result&lt;<span class="type">int</span>&gt; <span class="title">Divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Divide</span>(<span class="number">10</span>, <span class="number">0</span>);  <span class="comment">// 编译警告：ignoring return value</span></span><br></pre></td></tr></table></figure><h3 id="5-3-单子操作（Monadic-Operations）"><a href="#5-3-单子操作（Monadic-Operations）" class="headerlink" title="5.3 单子操作（Monadic Operations）"></a>5.3 单子操作（Monadic Operations）</h3><p>C++23 引入 <code>std::expected</code>，支持链式调用：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// C++23 风格</span></span><br><span class="line">std::expected&lt;<span class="type">int</span>, std::string&gt; result = <span class="built_in">Divide</span>(<span class="number">10</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">final</span> = result</span><br><span class="line">    .<span class="built_in">transform</span>([](<span class="type">int</span> x) &#123; <span class="keyword">return</span> x * <span class="number">2</span>; &#125;)         <span class="comment">// 成功时转换</span></span><br><span class="line">    .<span class="built_in">or_else</span>([](<span class="keyword">auto</span>&amp; e) &#123; <span class="built_in">log</span>(e); <span class="keyword">return</span> <span class="number">0</span>; &#125;);    <span class="comment">// 失败时处理</span></span><br></pre></td></tr></table></figure><p>C++17 可以手动实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Result</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> F&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">auto</span> <span class="title">map</span><span class="params">(F&amp;&amp; f)</span> -&gt; Result&lt;<span class="title">decltype</span><span class="params">(f(std::declval&lt;T&gt;()))</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">using</span> U = <span class="keyword">decltype</span>(<span class="built_in">f</span>(std::<span class="built_in">declval</span>&lt;T&gt;()));</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">ok</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> Result&lt;U&gt;&#123;<span class="built_in">f</span>(*data_)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result&lt;U&gt;&#123;Error&#123;message_&#125;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> F&gt;</span></span><br><span class="line"><span class="function">    Result&lt;T&gt; <span class="title">or_else</span><span class="params">(F&amp;&amp; f)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">ok</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">f</span>(message_);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="六、与标准库对比"><a href="#六、与标准库对比" class="headerlink" title="六、与标准库对比"></a>六、与标准库对比</h2><h3 id="6-1-std-optional-vs-Result"><a href="#6-1-std-optional-vs-Result" class="headerlink" title="6.1 std::optional vs Result"></a>6.1 std::optional vs Result</h3><div class="table-container"><table><thead><tr><th>特性</th><th><code>std::optional&lt;T&gt;</code></th><th><code>Result&lt;T&gt;</code></th></tr></thead><tbody><tr><td>语义</td><td>可能有值</td><td>成功或失败</td></tr><tr><td>错误信息</td><td>无</td><td>有</td></tr><tr><td>标准化</td><td>C++17</td><td>C++23 (<code>std::expected</code>)</td></tr></tbody></table></div><h3 id="6-2-std-expected-C-23"><a href="#6-2-std-expected-C-23" class="headerlink" title="6.2 std::expected (C++23)"></a>6.2 std::expected (C++23)</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;expected&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">std::expected&lt;<span class="type">int</span>, std::string&gt; <span class="title">Divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) <span class="keyword">return</span> std::<span class="built_in">unexpected</span>(<span class="string">&quot;Division by zero&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>优势</strong>：</p><ul><li>标准化，跨库兼容</li><li>支持 monadic operations</li><li>更好的编译器优化</li></ul><hr><h2 id="七、性能基准测试"><a href="#七、性能基准测试" class="headerlink" title="七、性能基准测试"></a>七、性能基准测试</h2><p>测试环境：GCC 12, -O2, x86-64</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 测试 1：创建 100 万个成功 Result</span></span><br><span class="line"><span class="function">Result&lt;std::string&gt; <span class="title">CreateSuccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">string</span>(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试 2：创建 100 万个失败 Result  </span></span><br><span class="line"><span class="function">Result&lt;std::string&gt; <span class="title">CreateError</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Error&#123;<span class="string">&quot;Something went wrong&quot;</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>场景</th><th>两个构造函数版本</th><th>Sink Pattern 版本</th></tr></thead><tbody><tr><td>成功路径</td><td>42ms</td><td>43ms</td></tr><tr><td>失败路径</td><td>38ms</td><td>39ms</td></tr><tr><td>差异</td><td>-</td><td>~2%</td></tr></tbody></table></div><p><strong>结论</strong>：Sink Pattern 的性能开销可以忽略不计，但代码简洁性大幅提升。</p><hr><h2 id="八、最佳实践总结"><a href="#八、最佳实践总结" class="headerlink" title="八、最佳实践总结"></a>八、最佳实践总结</h2><div class="table-container"><table><thead><tr><th>实践</th><th>建议</th></tr></thead><tbody><tr><td>小型可移动类型</td><td>使用 Sink Pattern（传值 + 移动）</td></tr><tr><td>大型或不可移动类型</td><td>保留引用重载</td></tr><tr><td>API 设计</td><td>使用 <code>[[nodiscard]]</code> 防止忽略</td></tr><tr><td>错误信息</td><td>优先使用 <code>std::string_view</code> 或静态字符串</td></tr><tr><td>C++23</td><td>迁移到 <code>std::expected</code></td></tr></tbody></table></div><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rf-consume">C++ Core Guidelines: F.15</a></li><li><a href="https://en.cppreference.com/w/cpp/utility/expected">std::expected (C++23)</a></li><li><a href="https://www.youtube.com/watch?v=kaI4R0Ng4E8">Andrei Alexandrescu: Systematic Error Handling in C++</a></li><li><a href="https://herbsutter.com/">Herb Sutter: De-fragmenting C++</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术深度 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> C++17 </tag>
            
            <tag> 类型设计 </tag>
            
            <tag> 性能优化 </tag>
            
            <tag> 错误处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ 宏元编程：自动生成属性访问器的设计模式</title>
      <link href="/2026/02/05/Cpp%E5%AE%8F%E5%AE%9A%E4%B9%89%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90GetterSetter/"/>
      <url>/2026/02/05/Cpp%E5%AE%8F%E5%AE%9A%E4%B9%89%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90GetterSetter/</url>
      
        <content type="html"><![CDATA[<h1 id="C-宏元编程：自动生成属性访问器的设计模式"><a href="#C-宏元编程：自动生成属性访问器的设计模式" class="headerlink" title="C++ 宏元编程：自动生成属性访问器的设计模式"></a>C++ 宏元编程：自动生成属性访问器的设计模式</h1><p>在大型 C++ 项目中，类的属性访问器（Getter/Setter）是最常见的样板代码。本文将深入分析使用预处理器宏自动生成访问器的设计模式，探讨其实现原理、类型萃取技术以及最佳实践。</p><hr><h2 id="一、问题背景"><a href="#一、问题背景" class="headerlink" title="一、问题背景"></a>一、问题背景</h2><h3 id="1-1-样板代码之痛"><a href="#1-1-样板代码之痛" class="headerlink" title="1.1 样板代码之痛"></a>1.1 样板代码之痛</h3><p>一个典型的数据类可能包含数十个成员变量，每个都需要访问器：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VehicleState</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> speed_;</span><br><span class="line">    <span class="type">double</span> acceleration_;</span><br><span class="line">    <span class="type">double</span> heading_;</span><br><span class="line">    Pose position_;</span><br><span class="line">    <span class="comment">// ... 20+ 成员变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 手写访问器：重复、易错、难维护</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_speed</span><span class="params">(<span class="type">double</span> val)</span> </span>&#123; speed_ = val; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">speed</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> speed_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_acceleration</span><span class="params">(<span class="type">double</span> val)</span> </span>&#123; acceleration_ = val; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">acceleration</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> acceleration_; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... 40+ 函数</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>问题</strong>：</p><ul><li>代码冗余，违反 DRY 原则</li><li>新增成员时容易遗漏访问器</li><li>风格不一致（<code>get_xxx</code> vs <code>xxx</code>）</li></ul><h3 id="1-2-解决方案概览"><a href="#1-2-解决方案概览" class="headerlink" title="1.2 解决方案概览"></a>1.2 解决方案概览</h3><div class="table-container"><table><thead><tr><th>方案</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>手写</td><td>完全控制</td><td>繁琐、易错</td></tr><tr><td>宏生成</td><td>简洁、一致</td><td>调试困难</td></tr><tr><td>代码生成器</td><td>灵活</td><td>构建复杂</td></tr><tr><td>C++20 Reflection（提案）</td><td>语言级支持</td><td>尚未标准化</td></tr></tbody></table></div><p>本文聚焦于<strong>宏生成</strong>方案，这是目前大型 C++ 项目（如 Google、百度）广泛采用的实践。</p><hr><h2 id="二、基础宏设计"><a href="#二、基础宏设计" class="headerlink" title="二、基础宏设计"></a>二、基础宏设计</h2><h3 id="2-1-PROPERTY-INIT：Getter-Setter"><a href="#2-1-PROPERTY-INIT：Getter-Setter" class="headerlink" title="2.1 PROPERTY_INIT：Getter + Setter"></a>2.1 PROPERTY_INIT：Getter + Setter</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_INIT(Type, SetterName, GetterName, MemberVar) \</span></span><br><span class="line"><span class="meta">    void Set##SetterName(Type val) &#123; MemberVar = val; &#125;        \</span></span><br><span class="line"><span class="meta">    const std::decay_t<span class="string">&lt;Type&gt;</span>&amp; GetterName() const &#123; return MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><p><strong>参数说明</strong>：</p><div class="table-container"><table><thead><tr><th>参数</th><th>描述</th><th>示例</th></tr></thead><tbody><tr><td><code>Type</code></td><td>成员变量类型</td><td><code>double</code>, <code>std::string</code></td></tr><tr><td><code>SetterName</code></td><td>Setter 后缀</td><td><code>Speed</code> → <code>SetSpeed</code></td></tr><tr><td><code>GetterName</code></td><td>Getter 名称</td><td><code>speed</code></td></tr><tr><td><code>MemberVar</code></td><td>实际成员变量</td><td><code>speed_</code></td></tr></tbody></table></div><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> speed_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PROPERTY_INIT</span>(<span class="type">double</span>, Speed, speed, speed_)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 展开后等价于：</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SetSpeed</span><span class="params">(<span class="type">double</span> val)</span> </span>&#123; speed_ = val; &#125;</span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">double</span>&amp; <span class="title">speed</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> speed_; &#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-Token-Pasting（-）"><a href="#2-2-Token-Pasting（-）" class="headerlink" title="2.2 Token Pasting（##）"></a>2.2 Token Pasting（##）</h3><p><code>##</code> 是预处理器的<strong>标记粘贴</strong>运算符，将两个标记连接成一个：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> CONCAT(a, b) a##b</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CONCAT</span>(Set, Speed)   <span class="comment">// 展开为 SetSpeed</span></span><br><span class="line"><span class="built_in">CONCAT</span>(my_, var)     <span class="comment">// 展开为 my_var</span></span><br></pre></td></tr></table></figure><p><strong>注意事项</strong>：</p><ul><li><code>##</code> 两侧必须是有效的预处理标记</li><li>不能生成无效标识符（如 <code>1var</code>）</li></ul><h3 id="2-3-std-decay-t-的作用"><a href="#2-3-std-decay-t-的作用" class="headerlink" title="2.3 std::decay_t 的作用"></a>2.3 std::decay_t 的作用</h3><p><code>std::decay_t&lt;T&gt;</code> 是 C++14 引入的类型萃取工具，执行以下转换：</p><div class="table-container"><table><thead><tr><th>输入类型</th><th>输出类型</th></tr></thead><tbody><tr><td><code>const int&amp;</code></td><td><code>int</code></td></tr><tr><td><code>int&amp;&amp;</code></td><td><code>int</code></td></tr><tr><td><code>int[5]</code></td><td><code>int*</code></td></tr><tr><td><code>int(double)</code></td><td><code>int(*)(double)</code></td></tr></tbody></table></div><p><strong>为什么需要它？</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果用户传入 const double&amp; 作为 Type：</span></span><br><span class="line"><span class="built_in">PROPERTY_INIT</span>(<span class="type">const</span> <span class="type">double</span>&amp;, Speed, speed, speed_)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 不使用 decay：返回类型变成 const (const double&amp;)&amp; </span></span><br><span class="line"><span class="comment">// 可能导致引用折叠问题</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 decay：返回类型规范为 const double&amp;</span></span><br><span class="line"><span class="type">const</span> std::<span class="type">decay_t</span>&lt;<span class="type">const</span> <span class="type">double</span>&amp;&gt;&amp; = <span class="type">const</span> <span class="type">double</span>&amp;</span><br></pre></td></tr></table></figure><hr><h2 id="三、进阶设计模式"><a href="#三、进阶设计模式" class="headerlink" title="三、进阶设计模式"></a>三、进阶设计模式</h2><h3 id="3-1-只读属性（PROPERTY-GETTER）"><a href="#3-1-只读属性（PROPERTY-GETTER）" class="headerlink" title="3.1 只读属性（PROPERTY_GETTER）"></a>3.1 只读属性（PROPERTY_GETTER）</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_GETTER(Type, Name, MemberVar) \</span></span><br><span class="line"><span class="meta">    const std::decay_t<span class="string">&lt;Type&gt;</span>&amp; Name() const &#123; return MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><p>用于不允许外部修改的成员：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Entity</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">const</span> <span class="type">uint64_t</span> id_;  <span class="comment">// 创建后不可变</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PROPERTY_GETTER</span>(<span class="type">uint64_t</span>, id, id_)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="3-2-指针访问器（PROPERTY-ACCESSORS）"><a href="#3-2-指针访问器（PROPERTY-ACCESSORS）" class="headerlink" title="3.2 指针访问器（PROPERTY_ACCESSORS）"></a>3.2 指针访问器（PROPERTY_ACCESSORS）</h3><p>用于嵌套对象，提供只读和可变访问：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_ACCESSORS(Type, Name, MemberVar)            \</span></span><br><span class="line"><span class="meta">    const Type* Name() const &#123; return &amp;MemberVar; &#125;          \</span></span><br><span class="line"><span class="meta">    Type* Mutable##Name() &#123; return &amp;MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><p><strong>使用示例</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Config config_;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PROPERTY_ACCESSORS</span>(Config, config, config_)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用：</span></span><br><span class="line"><span class="type">const</span> Config* cfg = request.<span class="built_in">config</span>();    <span class="comment">// 只读</span></span><br><span class="line">Config* mut_cfg = request.<span class="built_in">Mutableconfig</span>();  <span class="comment">// 可写</span></span><br><span class="line">mut_cfg-&gt;<span class="built_in">set_timeout</span>(<span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p><strong>命名约定</strong>：</p><p><code>Mutable</code> 前缀源自 Protocol Buffers 的 API 设计，语义清晰：</p><ul><li><code>xxx()</code> 返回 <code>const T*</code>，保证不修改</li><li><code>Mutablexxx()</code> 返回 <code>T*</code>，允许修改</li></ul><h3 id="3-3-值语义访问器（PROPERTY-VALUE）"><a href="#3-3-值语义访问器（PROPERTY-VALUE）" class="headerlink" title="3.3 值语义访问器（PROPERTY_VALUE）"></a>3.3 值语义访问器（PROPERTY_VALUE）</h3><p>返回值拷贝，适用于小型类型或需要值语义的场景：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_VALUE(Type, SetterName, GetterName, MemberVar) \</span></span><br><span class="line"><span class="meta">    void Set##SetterName(Type val) &#123; MemberVar = std::move(val); &#125; \</span></span><br><span class="line"><span class="meta">    Type GetterName() const &#123; return MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-4-完美转发-Setter"><a href="#3-4-完美转发-Setter" class="headerlink" title="3.4 完美转发 Setter"></a>3.4 完美转发 Setter</h3><p>使用通用引用实现高效的 Setter：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_FORWARD(Type, SetterName, GetterName, MemberVar)    \</span></span><br><span class="line"><span class="meta">    template<span class="string">&lt;typename T&gt;</span>                                              \</span></span><br><span class="line"><span class="meta">    void Set##SetterName(T&amp;&amp; val) &#123; MemberVar = std::forward<span class="string">&lt;T&gt;</span>(val); &#125; \</span></span><br><span class="line"><span class="meta">    const Type&amp; GetterName() const &#123; return MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><p><strong>优势</strong>：</p><ul><li>左值：拷贝</li><li>右值：移动</li><li>避免不必要的临时对象</li></ul><hr><h2 id="四、类型安全增强"><a href="#四、类型安全增强" class="headerlink" title="四、类型安全增强"></a>四、类型安全增强</h2><h3 id="4-1-静态断言"><a href="#4-1-静态断言" class="headerlink" title="4.1 静态断言"></a>4.1 静态断言</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_NUMERIC(Type, SetterName, GetterName, MemberVar) \</span></span><br><span class="line"><span class="meta">    static_assert(std::is_arithmetic_v<span class="string">&lt;Type&gt;</span>,                      \</span></span><br><span class="line"><span class="meta">                  #Type <span class="string">&quot; must be numeric&quot;</span>);                       \</span></span><br><span class="line"><span class="meta">    void Set##SetterName(Type val) &#123; MemberVar = val; &#125;           \</span></span><br><span class="line"><span class="meta">    Type GetterName() const &#123; return MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-2-边界检查"><a href="#4-2-边界检查" class="headerlink" title="4.2 边界检查"></a>4.2 边界检查</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_BOUNDED(Type, SetterName, GetterName, MemberVar, Min, Max) \</span></span><br><span class="line"><span class="meta">    void Set##SetterName(Type val) &#123;                                        \</span></span><br><span class="line"><span class="meta">        assert(val &gt;= Min &amp;&amp; val &lt;= Max);                                   \</span></span><br><span class="line"><span class="meta">        MemberVar = val;                                                    \</span></span><br><span class="line"><span class="meta">    &#125;                                                                       \</span></span><br><span class="line"><span class="meta">    Type GetterName() const &#123; return MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><p><strong>使用</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Motor</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">double</span> duty_cycle_;  <span class="comment">// 0.0 ~ 1.0</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">PROPERTY_BOUNDED</span>(<span class="type">double</span>, DutyCycle, duty_cycle, duty_cycle_, <span class="number">0.0</span>, <span class="number">1.0</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><hr><h2 id="五、调试与可维护性"><a href="#五、调试与可维护性" class="headerlink" title="五、调试与可维护性"></a>五、调试与可维护性</h2><h3 id="5-1-宏展开调试"><a href="#5-1-宏展开调试" class="headerlink" title="5.1 宏展开调试"></a>5.1 宏展开调试</h3><p>使用 <code>-E</code> 选项查看预处理结果：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -E -P myfile.cpp | grep -A5 <span class="string">&quot;class Vehicle&quot;</span></span><br></pre></td></tr></table></figure><p>或在 IDE 中使用”展开宏”功能。</p><h3 id="5-2-错误信息改进"><a href="#5-2-错误信息改进" class="headerlink" title="5.2 错误信息改进"></a>5.2 错误信息改进</h3><p>使用 <code>#</code> 运算符进行字符串化，提供更好的错误信息：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_INIT(Type, SetterName, GetterName, MemberVar)       \</span></span><br><span class="line"><span class="meta">    void Set##SetterName(Type val) &#123;                                 \</span></span><br><span class="line"><span class="meta">        LOG_DEBUG(<span class="string">&quot;Setting &quot;</span> #MemberVar <span class="string">&quot; to &quot;</span>, val);                \</span></span><br><span class="line"><span class="meta">        MemberVar = val;                                             \</span></span><br><span class="line"><span class="meta">    &#125;                                                                \</span></span><br><span class="line"><span class="meta">    const std::decay_t<span class="string">&lt;Type&gt;</span>&amp; GetterName() const &#123; return MemberVar; &#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-3-文档生成兼容"><a href="#5-3-文档生成兼容" class="headerlink" title="5.3 文档生成兼容"></a>5.3 文档生成兼容</h3><p>添加 Doxygen 兼容的注释：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_DOC(Type, SetterName, GetterName, MemberVar, Doc)   \</span></span><br><span class="line"><span class="meta">    <span class="comment">/** @brief Sets Doc */</span> \</span></span><br><span class="line"><span class="meta">    void Set##SetterName(Type val) &#123; MemberVar = val; &#125;              \</span></span><br><span class="line"><span class="meta">    <span class="comment">/** @brief Gets Doc */</span> \</span></span><br><span class="line"><span class="meta">    const std::decay_t<span class="string">&lt;Type&gt;</span>&amp; GetterName() const &#123; return MemberVar; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用：</span></span><br><span class="line"><span class="built_in">PROPERTY_DOC</span>(<span class="type">double</span>, Speed, speed, speed_, <span class="string">&quot;the current speed in m/s&quot;</span>)</span><br></pre></td></tr></table></figure><hr><h2 id="六、替代方案对比"><a href="#六、替代方案对比" class="headerlink" title="六、替代方案对比"></a>六、替代方案对比</h2><h3 id="6-1-C-20-no-unique-address-模板"><a href="#6-1-C-20-no-unique-address-模板" class="headerlink" title="6.1 C++20 [[no_unique_address]] + 模板"></a>6.1 C++20 [[no_unique_address]] + 模板</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">auto</span> Name&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Property</span> &#123;</span><br><span class="line">    T value_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(T val)</span> </span>&#123; value_ = std::<span class="built_in">move</span>(val); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> T&amp; <span class="title">get</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> value_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Property&lt;<span class="type">double</span>, <span class="string">&quot;speed&quot;</span>&gt; speed;</span><br><span class="line">    Property&lt;<span class="type">double</span>, <span class="string">&quot;heading&quot;</span>&gt; heading;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><strong>缺点</strong>：访问语法改变（<code>v.speed.get()</code> vs <code>v.speed()</code>）</p><h3 id="6-2-代码生成器"><a href="#6-2-代码生成器" class="headerlink" title="6.2 代码生成器"></a>6.2 代码生成器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gen_properties.py</span></span><br><span class="line">properties = [</span><br><span class="line">    (<span class="string">&quot;double&quot;</span>, <span class="string">&quot;speed&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;double&quot;</span>, <span class="string">&quot;heading&quot;</span>),</span><br><span class="line">    (<span class="string">&quot;Pose&quot;</span>, <span class="string">&quot;position&quot;</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> typ, name <span class="keyword">in</span> properties:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;void Set<span class="subst">&#123;name.title()&#125;</span>(<span class="subst">&#123;typ&#125;</span> val) &#123;&#123; <span class="subst">&#123;name&#125;</span>_ = val; &#125;&#125;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;const <span class="subst">&#123;typ&#125;</span>&amp; <span class="subst">&#123;name&#125;</span>() const &#123;&#123; return <span class="subst">&#123;name&#125;</span>_; &#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p><strong>适用场景</strong>：属性定义来自外部配置（如 YAML、数据库 Schema）</p><h3 id="6-3-未来：C-静态反射"><a href="#6-3-未来：C-静态反射" class="headerlink" title="6.3 未来：C++ 静态反射"></a>6.3 未来：C++ 静态反射</h3><p>C++26 可能引入静态反射，届时可以：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假想语法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    [[property]] <span class="type">double</span> speed_;</span><br><span class="line">    [[property]] <span class="type">double</span> heading_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 编译器自动生成访问器</span></span><br></pre></td></tr></table></figure><hr><h2 id="七、最佳实践总结"><a href="#七、最佳实践总结" class="headerlink" title="七、最佳实践总结"></a>七、最佳实践总结</h2><div class="table-container"><table><thead><tr><th>实践</th><th>建议</th></tr></thead><tbody><tr><td>命名约定</td><td><code>SetXxx</code> / <code>xxx()</code> 或 <code>Mutablexxx()</code></td></tr><tr><td>返回类型</td><td>基本类型返回值，复杂类型返回 <code>const T&amp;</code></td></tr><tr><td>类型安全</td><td>使用 <code>std::decay_t</code> 规范化类型</td></tr><tr><td>调试</td><td>使用 <code>-E</code> 检查宏展开</td></tr><tr><td>文档</td><td>添加 Doxygen 兼容注释</td></tr><tr><td>边界</td><td>必要时添加断言或验证</td></tr></tbody></table></div><hr><h2 id="八、完整示例"><a href="#八、完整示例" class="headerlink" title="八、完整示例"></a>八、完整示例</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> PROPERTY_MACROS_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_MACROS_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 标准 Getter + Setter</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY(Type, Name, Member) \</span></span><br><span class="line"><span class="meta">    void Set##Name(Type val) &#123; Member = std::move(val); &#125; \</span></span><br><span class="line"><span class="meta">    const std::decay_t<span class="string">&lt;Type&gt;</span>&amp; Name() const &#123; return Member; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 只读 Getter</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_RO(Type, Name, Member) \</span></span><br><span class="line"><span class="meta">    const std::decay_t<span class="string">&lt;Type&gt;</span>&amp; Name() const &#123; return Member; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 指针访问（只读 + 可变）</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_PTR(Type, Name, Member) \</span></span><br><span class="line"><span class="meta">    const Type* Name() const &#123; return &amp;Member; &#125; \</span></span><br><span class="line"><span class="meta">    Type* Mutable##Name() &#123; return &amp;Member; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 带边界检查</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PROPERTY_CHECKED(Type, Name, Member, Validator) \</span></span><br><span class="line"><span class="meta">    void Set##Name(Type val) &#123; \</span></span><br><span class="line"><span class="meta">        <span class="keyword">if</span> (!(Validator)) throw std::invalid_argument(#Name <span class="string">&quot; validation failed&quot;</span>); \</span></span><br><span class="line"><span class="meta">        Member = std::move(val); \</span></span><br><span class="line"><span class="meta">    &#125; \</span></span><br><span class="line"><span class="meta">    const std::decay_t<span class="string">&lt;Type&gt;</span>&amp; Name() const &#123; return Member; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// PROPERTY_MACROS_H</span></span></span><br></pre></td></tr></table></figure><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://en.cppreference.com/w/cpp/preprocessor">C++ Preprocessor Reference</a></li><li><a href="https://en.cppreference.com/w/cpp/types/decay">std::decay</a></li><li><a href="https://google.github.io/styleguide/cppguide.html">Google C++ Style Guide - Accessors</a></li><li><a href="https://protobuf.dev/reference/cpp/cpp-generated/">Protocol Buffers C++ Generated Code</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术深度 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 宏 </tag>
            
            <tag> 元编程 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入理解 Protocol Buffers Repeated 字段与编码原理</title>
      <link href="/2026/02/05/Protobuf-Repeated%E5%AD%97%E6%AE%B5%E4%B8%8ERecord%E7%B4%A2%E5%BC%95%E6%9C%BA%E5%88%B6/"/>
      <url>/2026/02/05/Protobuf-Repeated%E5%AD%97%E6%AE%B5%E4%B8%8ERecord%E7%B4%A2%E5%BC%95%E6%9C%BA%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="深入理解-Protocol-Buffers-Repeated-字段与编码原理"><a href="#深入理解-Protocol-Buffers-Repeated-字段与编码原理" class="headerlink" title="深入理解 Protocol Buffers Repeated 字段与编码原理"></a>深入理解 Protocol Buffers Repeated 字段与编码原理</h1><p>Protocol Buffers 是 Google 开发的高效数据序列化框架，在分布式系统、RPC 通信、数据存储等场景广泛应用。本文将深入分析 <code>repeated</code> 字段的实现原理、编码方式及性能优化策略。</p><hr><h2 id="一、Repeated-字段基础"><a href="#一、Repeated-字段基础" class="headerlink" title="一、Repeated 字段基础"></a>一、Repeated 字段基础</h2><h3 id="1-1-语义定义"><a href="#1-1-语义定义" class="headerlink" title="1.1 语义定义"></a>1.1 语义定义</h3><p><code>repeated</code> 修饰符用于定义可变长度的有序序列，等价于其他语言中的 <code>List</code> 或 <code>Array</code>：</p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SearchRequest</span> &#123;</span><br><span class="line">    <span class="type">string</span> query = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">repeated</span> <span class="type">string</span> keywords = <span class="number">2</span>;      <span class="comment">// 字符串列表</span></span><br><span class="line">    <span class="keyword">repeated</span> <span class="type">int32</span> page_numbers = <span class="number">3</span>;   <span class="comment">// 整数列表</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">message </span><span class="title class_">Filter</span> &#123;</span><br><span class="line">        <span class="type">string</span> field = <span class="number">1</span>;</span><br><span class="line">        <span class="type">string</span> value = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">repeated</span> Filter filters = <span class="number">4</span>;       <span class="comment">// 嵌套消息列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-核心特性"><a href="#1-2-核心特性" class="headerlink" title="1.2 核心特性"></a>1.2 核心特性</h3><div class="table-container"><table><thead><tr><th>特性</th><th>描述</th></tr></thead><tbody><tr><td><strong>有序性</strong></td><td>元素按插入顺序存储，序列化后顺序保持不变</td></tr><tr><td><strong>可重复</strong></td><td>允许相同值多次出现（与 <code>set</code> 语义不同）</td></tr><tr><td><strong>动态大小</strong></td><td>运行时自动扩容，无需预分配容量</td></tr><tr><td><strong>默认值</strong></td><td>空列表（<code>size() == 0</code>），不占用序列化空间</td></tr></tbody></table></div><hr><h2 id="二、Wire-Format-编码原理"><a href="#二、Wire-Format-编码原理" class="headerlink" title="二、Wire Format 编码原理"></a>二、Wire Format 编码原理</h2><p>理解 <code>repeated</code> 字段的性能特性，需要深入其二进制编码方式。</p><h3 id="2-1-Protobuf-编码基础"><a href="#2-1-Protobuf-编码基础" class="headerlink" title="2.1 Protobuf 编码基础"></a>2.1 Protobuf 编码基础</h3><p>每个字段编码为 <code>Tag + Value</code> 结构：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tag = (field_number &lt;&lt; 3) | wire_type</span><br></pre></td></tr></table></figure><p>Wire Type 定义：</p><div class="table-container"><table><thead><tr><th>Wire Type</th><th>值</th><th>用途</th></tr></thead><tbody><tr><td>VARINT</td><td>0</td><td>int32, int64, uint32, uint64, sint32, sint64, bool, enum</td></tr><tr><td>I64</td><td>1</td><td>fixed64, sfixed64, double</td></tr><tr><td>LEN</td><td>2</td><td>string, bytes, embedded messages, packed repeated</td></tr><tr><td>I32</td><td>5</td><td>fixed32, sfixed32, float</td></tr></tbody></table></div><h3 id="2-2-非-Packed-编码"><a href="#2-2-非-Packed-编码" class="headerlink" title="2.2 非 Packed 编码"></a>2.2 非 Packed 编码</h3><p>在 Proto2 中或对于消息/字符串类型，每个元素独立编码：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repeated int32 values = 1;  // 存储 [150, 1]</span><br></pre></td></tr></table></figure><p>编码结果：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">08 96 01    // Tag=1, WireType=0, Value=150 (Varint编码)</span><br><span class="line">08 01       // Tag=1, WireType=0, Value=1</span><br></pre></td></tr></table></figure></p><p><strong>问题</strong>：Tag 重复出现，空间浪费。</p><h3 id="2-3-Packed-编码（Proto3-默认）"><a href="#2-3-Packed-编码（Proto3-默认）" class="headerlink" title="2.3 Packed 编码（Proto3 默认）"></a>2.3 Packed 编码（Proto3 默认）</h3><p>数值类型默认启用 Packed 编码，所有元素打包在一个 Length-Delimited 结构中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repeated int32 values = 1 [packed=true];  // 存储 [150, 1]</span><br></pre></td></tr></table></figure><p>编码结果：<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0A 03 96 01 01</span><br><span class="line">│  │  └─────┴── Values: 150, 1</span><br><span class="line">│  └──────────── Length: 3 bytes</span><br><span class="line">└─────────────── Tag: field=1, wiretype=2(LEN)</span><br></pre></td></tr></table></figure></p><h3 id="2-4-空间效率对比"><a href="#2-4-空间效率对比" class="headerlink" title="2.4 空间效率对比"></a>2.4 空间效率对比</h3><p>存储 1000 个 int32 值（假设平均每个值占用 2 字节 Varint）：</p><div class="table-container"><table><thead><tr><th>编码方式</th><th>Tag 开销</th><th>数据开销</th><th>总计</th></tr></thead><tbody><tr><td>非 Packed</td><td>1000 × 1 = 1000B</td><td>1000 × 2 = 2000B</td><td>~3000B</td></tr><tr><td>Packed</td><td>1 + 2 = 3B</td><td>1000 × 2 = 2000B</td><td>~2003B</td></tr><tr><td><strong>节省</strong></td><td>-</td><td>-</td><td><strong>~33%</strong></td></tr></tbody></table></div><hr><h2 id="三、C-生成代码分析"><a href="#三、C-生成代码分析" class="headerlink" title="三、C++ 生成代码分析"></a>三、C++ 生成代码分析</h2><h3 id="3-1-两种容器类型"><a href="#3-1-两种容器类型" class="headerlink" title="3.1 两种容器类型"></a>3.1 两种容器类型</h3><p><code>protoc</code> 根据元素类型生成不同的容器：</p><h4 id="RepeatedField-（基本类型）"><a href="#RepeatedField-（基本类型）" class="headerlink" title="RepeatedField\（基本类型）"></a>RepeatedField\<T\>（基本类型）</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于 int32, int64, float, double, bool, enum</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RepeatedField</span>&lt;<span class="type">int32_t</span>&gt; &#123;</span><br><span class="line">    <span class="type">int32_t</span>* elements_;   <span class="comment">// 连续内存</span></span><br><span class="line">    <span class="type">int</span> size_;</span><br><span class="line">    <span class="type">int</span> capacity_;</span><br><span class="line">    Arena* arena_;        <span class="comment">// 可选的 Arena 分配器</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>特点：</p><ul><li>连续内存布局，缓存友好</li><li>支持 <code>Reserve()</code> 预分配</li><li>移动语义优化</li></ul><h4 id="RepeatedPtrField-（消息-字符串）"><a href="#RepeatedPtrField-（消息-字符串）" class="headerlink" title="RepeatedPtrField\（消息/字符串）"></a>RepeatedPtrField\<T\>（消息/字符串）</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于 message, string, bytes</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RepeatedPtrField</span>&lt;Message&gt; &#123;</span><br><span class="line">    <span class="type">void</span>** elements_;     <span class="comment">// 指针数组</span></span><br><span class="line">    <span class="type">int</span> size_;</span><br><span class="line">    <span class="type">int</span> capacity_;</span><br><span class="line">    Arena* arena_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>特点：</p><ul><li>元素在堆上独立分配</li><li>支持对象复用（<code>ReleaseLast()</code> + <code>AddAllocated()</code>）</li><li>析构时自动释放所有元素</li></ul><h3 id="3-2-常用-API"><a href="#3-2-常用-API" class="headerlink" title="3.2 常用 API"></a>3.2 常用 API</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加元素</span></span><br><span class="line">msg.<span class="built_in">add_values</span>(<span class="number">42</span>);                        <span class="comment">// 基本类型</span></span><br><span class="line"><span class="keyword">auto</span>* filter = msg.<span class="built_in">add_filters</span>();          <span class="comment">// 返回新建消息的指针</span></span><br><span class="line">filter-&gt;<span class="built_in">set_field</span>(<span class="string">&quot;category&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问元素</span></span><br><span class="line"><span class="type">int</span> size = msg.<span class="built_in">values_size</span>();</span><br><span class="line"><span class="type">int</span> val = msg.<span class="built_in">values</span>(<span class="number">0</span>);                   <span class="comment">// 索引访问</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; v : msg.<span class="built_in">values</span>()) &#123; &#125;     <span class="comment">// Range-based for</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改</span></span><br><span class="line">msg.<span class="built_in">set_values</span>(<span class="number">0</span>, <span class="number">100</span>);                    <span class="comment">// 修改指定位置</span></span><br><span class="line">msg.<span class="built_in">mutable_values</span>()-&gt;<span class="built_in">Clear</span>();             <span class="comment">// 清空</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 高级操作</span></span><br><span class="line">msg.<span class="built_in">mutable_values</span>()-&gt;<span class="built_in">Reserve</span>(<span class="number">1000</span>);       <span class="comment">// 预分配</span></span><br><span class="line">msg.<span class="built_in">mutable_values</span>()-&gt;<span class="built_in">Swap</span>(other.<span class="built_in">mutable_values</span>());  <span class="comment">// 交换</span></span><br></pre></td></tr></table></figure><hr><h2 id="四、性能优化策略"><a href="#四、性能优化策略" class="headerlink" title="四、性能优化策略"></a>四、性能优化策略</h2><h3 id="4-1-预分配内存"><a href="#4-1-预分配内存" class="headerlink" title="4.1 预分配内存"></a>4.1 预分配内存</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 未优化：多次扩容</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; ++i) &#123;</span><br><span class="line">    msg.<span class="built_in">add_values</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 优化：预分配</span></span><br><span class="line">msg.<span class="built_in">mutable_values</span>()-&gt;<span class="built_in">Reserve</span>(<span class="number">10000</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; ++i) &#123;</span><br><span class="line">    msg.<span class="built_in">add_values</span>(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-Arena-分配"><a href="#4-2-Arena-分配" class="headerlink" title="4.2 Arena 分配"></a>4.2 Arena 分配</h3><p>Arena 适用于批量创建、统一销毁的场景：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;google/protobuf/arena.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">google::protobuf::Arena arena;</span><br><span class="line"><span class="keyword">auto</span>* msg = Arena::<span class="built_in">CreateMessage</span>&lt;SearchRequest&gt;(&amp;arena);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有子消息自动使用同一 Arena</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) &#123;</span><br><span class="line">    <span class="keyword">auto</span>* filter = msg-&gt;<span class="built_in">add_filters</span>();</span><br><span class="line">    filter-&gt;<span class="built_in">set_field</span>(<span class="string">&quot;key_&quot;</span> + std::<span class="built_in">to_string</span>(i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Arena 析构时统一释放，无碎片</span></span><br></pre></td></tr></table></figure><p><strong>性能对比</strong>（创建 10000 个嵌套消息）：</p><div class="table-container"><table><thead><tr><th>分配方式</th><th>耗时</th><th>内存碎片</th></tr></thead><tbody><tr><td>默认堆分配</td><td>15ms</td><td>高</td></tr><tr><td>Arena</td><td>3ms</td><td>无</td></tr></tbody></table></div><h3 id="4-3-移动语义"><a href="#4-3-移动语义" class="headerlink" title="4.3 移动语义"></a>4.3 移动语义</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外部数据移入 Protobuf</span></span><br><span class="line">std::vector&lt;<span class="type">int32_t</span>&gt; external_data = <span class="built_in">ComputeData</span>();</span><br><span class="line">*msg.<span class="built_in">mutable_values</span>() = &#123;</span><br><span class="line">    std::<span class="built_in">make_move_iterator</span>(external_data.<span class="built_in">begin</span>()),</span><br><span class="line">    std::<span class="built_in">make_move_iterator</span>(external_data.<span class="built_in">end</span>())</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Protobuf 数据移出</span></span><br><span class="line">std::vector&lt;<span class="type">int32_t</span>&gt; output;</span><br><span class="line">output.<span class="built_in">reserve</span>(msg.<span class="built_in">values_size</span>());</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; v : *msg.<span class="built_in">mutable_values</span>()) &#123;</span><br><span class="line">    output.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-避免不必要的拷贝"><a href="#4-4-避免不必要的拷贝" class="headerlink" title="4.4 避免不必要的拷贝"></a>4.4 避免不必要的拷贝</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 拷贝</span></span><br><span class="line"><span class="function">std::string <span class="title">SerializeToString</span><span class="params">(<span class="type">const</span> Message&amp; msg)</span> </span>&#123;</span><br><span class="line">    std::string output;</span><br><span class="line">    msg.<span class="built_in">SerializeToString</span>(&amp;output);</span><br><span class="line">    <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 直接序列化到目标缓冲区</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">SerializeTo</span><span class="params">(<span class="type">const</span> Message&amp; msg, std::string* output)</span> </span>&#123;</span><br><span class="line">    msg.<span class="built_in">SerializeToString</span>(output);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 使用 Cord（大数据场景）</span></span><br><span class="line"><span class="function">absl::Cord <span class="title">SerializeToCord</span><span class="params">(<span class="type">const</span> Message&amp; msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> msg.<span class="built_in">SerializeAsCord</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="五、常见陷阱与解决方案"><a href="#五、常见陷阱与解决方案" class="headerlink" title="五、常见陷阱与解决方案"></a>五、常见陷阱与解决方案</h2><h3 id="5-1-生命周期管理"><a href="#5-1-生命周期管理" class="headerlink" title="5.1 生命周期管理"></a>5.1 生命周期管理</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 错误：手动 delete RepeatedPtrField 元素</span></span><br><span class="line"><span class="keyword">auto</span>* filter = msg.<span class="built_in">add_filters</span>();</span><br><span class="line"><span class="keyword">delete</span> filter;  <span class="comment">// Double-free!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：使用 ReleaseLast() 转移所有权</span></span><br><span class="line"><span class="keyword">auto</span>* filter = msg.<span class="built_in">mutable_filters</span>()-&gt;<span class="built_in">ReleaseLast</span>();</span><br><span class="line"><span class="comment">// 现在 filter 由调用者管理</span></span><br><span class="line"><span class="keyword">delete</span> filter;  <span class="comment">// OK</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 或者使用 ExtractSubrange()</span></span><br><span class="line">std::vector&lt;Filter*&gt; extracted;</span><br><span class="line">msg.<span class="built_in">mutable_filters</span>()-&gt;<span class="built_in">ExtractSubrange</span>(<span class="number">0</span>, <span class="number">10</span>, &amp;extracted);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>* f : extracted) &#123;</span><br><span class="line">    <span class="keyword">delete</span> f;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-迭代时修改"><a href="#5-2-迭代时修改" class="headerlink" title="5.2 迭代时修改"></a>5.2 迭代时修改</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ❌ 危险：迭代时删除导致迭代器失效</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = msg.<span class="built_in">filters</span>().<span class="built_in">begin</span>(); it != msg.<span class="built_in">filters</span>().<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">ShouldRemove</span>(*it)) &#123;</span><br><span class="line">        msg.<span class="built_in">mutable_filters</span>()-&gt;<span class="built_in">erase</span>(it);  <span class="comment">// UB!</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ✅ 正确：使用 DeleteSubrange 或先收集索引</span></span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; to_remove;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; msg.<span class="built_in">filters_size</span>(); ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">ShouldRemove</span>(msg.<span class="built_in">filters</span>(i))) &#123;</span><br><span class="line">        to_remove.<span class="built_in">push_back</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 从后向前删除，避免索引偏移</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = to_remove.<span class="built_in">rbegin</span>(); it != to_remove.<span class="built_in">rend</span>(); ++it) &#123;</span><br><span class="line">    msg.<span class="built_in">mutable_filters</span>()-&gt;<span class="built_in">DeleteSubrange</span>(*it, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-Proto2-与-Proto3-差异"><a href="#5-3-Proto2-与-Proto3-差异" class="headerlink" title="5.3 Proto2 与 Proto3 差异"></a>5.3 Proto2 与 Proto3 差异</h3><div class="table-container"><table><thead><tr><th>特性</th><th>Proto2</th><th>Proto3</th></tr></thead><tbody><tr><td>Packed 默认值</td><td><code>false</code></td><td><code>true</code>（数值类型）</td></tr><tr><td>空列表序列化</td><td>不输出</td><td>不输出</td></tr><tr><td>未知字段</td><td>保留</td><td>默认丢弃（可配置保留）</td></tr></tbody></table></div><hr><h2 id="六、总结"><a href="#六、总结" class="headerlink" title="六、总结"></a>六、总结</h2><ol><li><p><strong>编码层面</strong>：Packed 编码显著减少空间开销，Proto3 默认启用。</p></li><li><p><strong>内存管理</strong>：<code>RepeatedField</code> 用于基本类型，<code>RepeatedPtrField</code> 用于消息类型，生命周期由父消息管理。</p></li><li><p><strong>性能优化</strong>：预分配、Arena 分配、移动语义是三大优化手段。</p></li><li><p><strong>最佳实践</strong>：避免手动 <code>delete</code>、迭代时修改、注意 Proto2/Proto3 差异。</p></li></ol><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://protobuf.dev/programming-guides/encoding/">Protocol Buffers Encoding</a></li><li><a href="https://protobuf.dev/reference/cpp/arenas/">C++ Arena Allocation</a></li><li><a href="https://protobuf.dev/reference/cpp/api-docs/">Protocol Buffers C++ API Reference</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 技术深度 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 性能优化 </tag>
            
            <tag> Protobuf </tag>
            
            <tag> 序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>anzhiyu主题魔改</title>
      <link href="/2025/10/17/anzhiyu%E4%B8%BB%E9%A2%98%E9%AD%94%E6%94%B9/"/>
      <url>/2025/10/17/anzhiyu%E4%B8%BB%E9%A2%98%E9%AD%94%E6%94%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="主题改动记录"><a href="#主题改动记录" class="headerlink" title="主题改动记录"></a>主题改动记录</h1><h2 id="关于页面-map-background-首跳不加载或加载后小时"><a href="#关于页面-map-background-首跳不加载或加载后小时" class="headerlink" title="关于页面 map.background 首跳不加载或加载后小时"></a>关于页面 map.background 首跳不加载或加载后小时</h2><p>首次打开<code>about</code>页面，about.yml中map.background和map.backgroundDark不加载</p><ul><li><strong>文件路径</strong>：<code>themes/anzhiyu/layout/includes/page/about.pug</code></li><li><strong>变更摘要</strong>：通过 <code>data-pjax</code> 让脚本在 PJAX 完成后重执行；<details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- a/themes/anzhiyu/layout/includes/page/about.pug</span></span><br><span class="line"><span class="comment">+++ b/themes/anzhiyu/layout/includes/page/about.pug</span></span><br><span class="line"><span class="meta">@@ -286,10 +286,30 @@</span> if site.data.about</span><br><span class="line">                   | 人</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="deletion">-    script(src=url_for(theme.asset.countup_js))</span></span><br><span class="line"><span class="addition">+    script(data-pjax src=url_for(theme.asset.countup_js))</span></span><br><span class="line">     - const ck = theme.LA.ck</span><br><span class="line"><span class="deletion">-    script(defer).</span></span><br><span class="line"><span class="addition">+    script(defer data-pjax).</span></span><br><span class="line">       function initAboutPage() &#123;</span><br><span class="line"><span class="addition">+        // Ensure map background is applied on first PJAX load without breaking hover zoom</span></span><br><span class="line"><span class="addition">+        try &#123;</span></span><br><span class="line"><span class="addition">+          var mapEl = document.querySelector(&#x27;.author-content-item.map.single&#x27;);</span></span><br><span class="line"><span class="addition">+          if (mapEl) &#123;</span></span><br><span class="line"><span class="addition">+            var isDark = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;dark&#x27;;</span></span><br><span class="line"><span class="addition">+            var mapBgLight = !&#123;JSON.stringify(item.map &amp;&amp; item.map.background ? item.map.background : &#x27;&#x27;)&#125;;</span></span><br><span class="line"><span class="addition">+            var mapBgDark = !&#123;JSON.stringify(item.map &amp;&amp; item.map.backgroundDark ? item.map.backgroundDark : &#x27;&#x27;)&#125;;</span></span><br><span class="line"><span class="addition">+            var mapBg = isDark ? mapBgDark : mapBgLight;</span></span><br><span class="line"><span class="addition">+            if (mapBg) &#123;</span></span><br><span class="line"><span class="addition">+              mapEl.style.backgroundImage = &#x27;url(&#x27; + mapBg + &#x27;)&#x27;;</span></span><br><span class="line"><span class="addition">+            &#125;</span></span><br><span class="line"><span class="addition">+            window.globalFn = window.globalFn || &#123;&#125;;</span></span><br><span class="line"><span class="addition">+            window.globalFn.themeChange = window.globalFn.themeChange || &#123;&#125;;</span></span><br><span class="line"><span class="addition">+            window.globalFn.themeChange.aboutMapBg = function(mode)&#123;</span></span><br><span class="line"><span class="addition">+              var dark = mode ? (mode === &#x27;dark&#x27;) : (document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;dark&#x27;);</span></span><br><span class="line"><span class="addition">+              var newBg = dark ? mapBgDark : mapBgLight;</span></span><br><span class="line"><span class="addition">+              if (newBg) mapEl.style.backgroundImage = &#x27;url(&#x27; + newBg + &#x27;)&#x27;;</span></span><br><span class="line"><span class="addition">+            &#125;;</span></span><br><span class="line"><span class="addition">+          &#125;</span></span><br><span class="line"><span class="addition">+        &#125; catch (e) &#123;&#125;</span></span><br><span class="line">         fetch(&quot;https://v6-widget.51.la/v6/#&#123;ck&#125;/quote.js&quot;)</span><br><span class="line">           .then(res =&gt; res.text())</span><br><span class="line">           .then(data =&gt; &#123;</span><br></pre></td></tr></table></figure>              </div>            </details></li></ul><h2 id="相册页面主副标题修改"><a href="#相册页面主副标题修改" class="headerlink" title="相册页面主副标题修改"></a>相册页面主副标题修改</h2><ul><li><strong>文件路径</strong>：<code>themes/anzhiyu/layout/includes/page/album.pug</code></li><li><strong>变更摘要</strong>：更换相册主副标题、文案。<details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--- a/themes/anzhiyu/layout/includes/page/album.pug</span></span><br><span class="line"><span class="comment">+++ b/themes/anzhiyu/layout/includes/page/album.pug</span></span><br><span class="line"><span class="meta">@@ -2,10 +2,10 @@</span></span><br><span class="line">   - let album_background = page.top_background</span><br><span class="line">   .author-content.author-content-item.album.single(style=`$&#123;album_background ? `background: url($&#123;album_background&#125;) top / cover no-repeat;` : &quot;&quot;&#125;`)</span><br><span class="line">     .card-content</span><br><span class="line"><span class="deletion">-      .author-content-item-tips 相册集</span></span><br><span class="line"><span class="deletion">-      span.author-content-item-title 这里是我的相册集哦😯</span></span><br><span class="line"><span class="addition">+      .author-content-item-tips 摄影集</span></span><br><span class="line"><span class="addition">+      span.author-content-item-title 以天地为卷，以镜头为笔</span></span><br><span class="line">       .content-bottom</span><br><span class="line"><span class="deletion">-        .tips 每一张照片都是一次美好的记忆。</span></span><br><span class="line"><span class="addition">+        .tips 定格时间本是神的能力，摄影却让人人都能触及这项神技</span></span><br><span class="line">       .banner-button-group</span><br><span class="line">         a.banner-button(onclick=&#x27;pjax.loadUrl(&quot;/about/&quot;)&#x27;)</span><br><span class="line">           i.anzhiyufont.anzhiyu-icon-arrow-circle-right(style=&#x27;font-size: 1.5rem&#x27;)</span><br></pre></td></tr></table></figure>              </div>            </details></li></ul>]]></content>
      
      
      <categories>
          
          <category> 大冒险 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 魔改 </tag>
            
            <tag> 笔记 </tag>
            
            <tag> 插件 </tag>
            
            <tag> 博客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>butterfly主题魔改</title>
      <link href="/2025/09/19/butterfly%E4%B8%BB%E9%A2%98%E9%AD%94%E6%94%B9/"/>
      <url>/2025/09/19/butterfly%E4%B8%BB%E9%A2%98%E9%AD%94%E6%94%B9/</url>
      
        <content type="html"><![CDATA[<div class="note warning 注意 flat"><p>本站已更换anzhiyu主题，但本文中魔改教程依然可做参考。</p></div><a class="btn-anzhiyu " href="/2025/10/17/anzhiyu%E4%B8%BB%E9%A2%98%E9%AD%94%E6%94%B9/"   title="anzhiyu主题魔改"><i class="outline primary"></i><span>anzhiyu主题魔改</span></a><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本站的搭建是完全基于开源项目<a href="https://github.com/fomalhaut1998/hexo-theme-Fomalhaut">hexo-theme-Fomalhaut</a>，以及配套文字教程<a href="https://www.fomal.cc/posts/e593433d.html">Hexo博客搭建基础教程(一) | Fomalhaut🥝</a><br>同时在大佬的轮子上根据个人理解和喜好，进行了一些取舍和修改，如有侵权请联系删除。<br>写下这篇文章是为了记录博客魔改的过程，方便以后对本站进行升级，所以所有魔改操作被分成了两大类，一类只需修改配置文件，另一类则涉及主题源码的修改。</p><h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><ol><li><p><strong>版本控制</strong>：在每一步魔改操作前，建议将代码推送至GitHub仓库，确保有回滚能力。</p><p>（因为设计主题源码的修改，所以需要将<code>[BlogRoot]/node_modules/hexo-theme-butterfly</code>复制到<code>[BlogRoot]/themes/</code>中，避免被<code>.gitignore</code>忽略）</p></li><li><p><strong>路径约定</strong>：本文中所有路径均采用以下约定：</p><ul><li>博客根目录：统一以<code>[BlogRoot]</code>指代</li><li>主题目录：统一以<code>[ThemeRoot]</code>指代，即<code>[BlogRoot]/themes/hexo-theme-butterfly/</code></li></ul></li><li><p><strong>代码标识规范</strong>：涉及修改主题源码的内容，会使用<strong>diff代码块</strong>标识，请先了解相关语法。</p></li><li><p><strong>资源管理</strong>：魔改过程经常需要引入<strong>自定义</strong>的css与js文件，文件位置可以根据个人习惯选择，博主统一放在了<code>[BlogRoot]/source/static/</code>下，只需在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中正确引入即可。</p></li></ol><h1 id="hexo与butterfly"><a href="#hexo与butterfly" class="headerlink" title="hexo与butterfly"></a>hexo与butterfly</h1><p>待续未完</p><h1 id="插件实现"><a href="#插件实现" class="headerlink" title="插件实现"></a>插件实现</h1><p>该部分基本只通过<code>安装模块</code>或<code>引入css、js文件</code>等手段丰富博客，方便后续框架、主题升级</p><h2 id="自动压缩文件"><a href="#自动压缩文件" class="headerlink" title="自动压缩文件"></a>自动压缩文件</h2><p>生成静态文件时自动压缩css、js、图片等文件，例如移除空格、注释、换行<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-minify --save</span><br></pre></td></tr></table></figure></li><li><p>修改配置：修改<code>_config.butterfly.yml</code>中的<code>wordcount</code>。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo-minify</span></span><br><span class="line"><span class="comment">## https://github.com/lete114/hexo-minify</span></span><br><span class="line"><span class="comment">## 部署自动压缩文件</span></span><br><span class="line"><span class="attr">minify:</span></span><br><span class="line">  <span class="attr">preview:</span> <span class="literal">true</span> <span class="comment"># 本地预览时是否压缩，建议打开能随时纠错，部分图片压缩后会出问题</span></span><br><span class="line">  <span class="attr">exclude:</span> [<span class="string">&#x27;*.min.*&#x27;</span>]</span><br><span class="line">  <span class="attr">js:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sourceMap:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">false</span> <span class="comment"># 生成 sourceMap</span></span><br><span class="line">      <span class="comment"># 将 sourceMappingURL 插入压缩后的 js 文件，如果为 false 则需要在浏览器开发者工具中手动添加 sourceMap</span></span><br><span class="line">      <span class="attr">sourceMappingURL:</span> <span class="literal">false</span> <span class="comment">## //# sourceMappingURL=xxx.js.map</span></span><br><span class="line">    <span class="comment"># 详细配置: https://github.com/terser/terser#minify-options</span></span><br><span class="line">    <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">css:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 详细配置: https://github.com/clean-css/clean-css#compatibility-modes</span></span><br><span class="line">    <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">html:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># 详细配置: https://github.com/kangax/html-minifier#options-quick-reference</span></span><br><span class="line">    <span class="attr">options:</span></span><br><span class="line">      <span class="attr">minifyJS:</span> <span class="literal">true</span> <span class="comment"># Compressed JavaScript</span></span><br><span class="line">      <span class="attr">minifyCSS:</span> <span class="literal">true</span> <span class="comment"># CSS Compressed</span></span><br><span class="line">      <span class="attr">removeComments:</span> <span class="literal">true</span> <span class="comment"># Remove the comments</span></span><br><span class="line">      <span class="attr">collapseWhitespace:</span> <span class="literal">true</span> <span class="comment"># Delete any extra space</span></span><br><span class="line">      <span class="attr">removeAttributeQuotes:</span> <span class="literal">true</span> <span class="comment"># Delete attribute quotes</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">svg:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 详细配置: https://github.com/imagemin/imagemin-svgo#imageminsvgooptionsbuffer</span></span><br><span class="line">      <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">jpg:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 详细配置: https://github.com/imagemin/imagemin-jpegtran#options</span></span><br><span class="line">      <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">png:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 详细配置: https://github.com/imagemin/imagemin-pngquant#options</span></span><br><span class="line">      <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">gif:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 详细配置: https://www.npmjs.com/package/imagemin-gifsicle#options</span></span><br><span class="line">      <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">    <span class="attr">webp:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="comment"># 详细配置: https://github.com/imagemin/imagemin-webp#options</span></span><br><span class="line">      <span class="attr">options:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">font:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="comment"># 详细配置: https://github.com/Lete114/fontmin-spider#api</span></span><br><span class="line">    <span class="attr">options:</span> &#123;&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="字数统计"><a href="#字数统计" class="headerlink" title="字数统计"></a>字数统计</h2><p>文章页面头部、侧边栏统计字数<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-wordcount --save</span><br></pre></td></tr></table></figure></li><li><p>修改配置：修改<code>_config.butterfly.yml</code>中的<code>wordcount</code>。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-wordcount</span></span><br><span class="line"><span class="attr">wordcount:</span></span><br><span class="line"> <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"> <span class="comment"># 文章页面头部显示总字数</span></span><br><span class="line"> <span class="attr">post_wordcount:</span> <span class="literal">true</span></span><br><span class="line"> <span class="comment"># 文章页面头部显示阅读时长</span></span><br><span class="line"> <span class="attr">min2read:</span> <span class="literal">true</span></span><br><span class="line"> <span class="comment"># 侧边栏显示网站总字数</span></span><br><span class="line"> <span class="attr">total_wordcount:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="文章搜索功能"><a href="#文章搜索功能" class="headerlink" title="文章搜索功能"></a>文章搜索功能</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装依赖</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 本地搜索系统</span></span><br><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">content:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><p>修改配置：修改<code>_config.butterfly.yml</code>中的<code>local_search</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Local Search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 预加载搜索数据</span></span><br><span class="line">  <span class="attr">preload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># n/-1，显示前n个搜索结果/显示所有结果</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">1</span></span><br><span class="line">  <span class="comment"># Unescape html strings to the readable one.</span></span><br><span class="line">  <span class="attr">unescape:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">CDN:</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><h2 id="Live2D"><a href="#Live2D" class="headerlink" title="Live2D"></a>Live2D</h2><p>参考：<a href="https://akilar.top/posts/5b8f515f/">Live2d Widget</a><br>博客同款live2d只有眼神跟踪鼠标功能，且项目21年已停止维护<br>该项目作者推荐其他类似项目 <a href="https://github.com/stevenjoezhang/live2d-widget">stevenjoezhang/live2d-widget</a></p><details class="folding-tag" gray><summary> 仍食用同款 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-helper-live2d</span></span><br><span class="line"><span class="comment">## 看板娘</span></span><br><span class="line"><span class="comment">## https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#开关插件版看板娘</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">static/live2dw/</span> <span class="comment"># 自定义插件储存路径（hexo g后public/下）</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span> <span class="comment"># 自定义脚本储存路径（pluginRootPath下子路径）</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span> <span class="comment"># 自定义模型储存路径（pluginRootPath下子路径）</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span> <span class="comment"># 标签模式, 是否仅替换 live2d tag标签而非插入到所有页面中</span></span><br><span class="line">  <span class="attr">debug:</span> <span class="literal">false</span> <span class="comment"># 调试, 是否在控制台输出日志</span></span><br><span class="line">  <span class="attr">model:</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">https://npm.elemecdn.com/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># use: live2d-widget-model-wanko # npm install live2d-widget-model-wanko</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># use: wanko # 若模型储存在[BlogRoot]/live2d_models下的模型目录名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># use: ./wanko # 相对于[BlogRoot]的路径（不建议储存在source下，hexo g后会出现两份）</span></span><br><span class="line">  <span class="comment">#看板娘位置、大小</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">right</span> </span><br><span class="line">    <span class="attr">width:</span> <span class="number">200</span> </span><br><span class="line">    <span class="attr">height:</span> <span class="number">400</span> </span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">false</span> <span class="comment"># 手机是否展示</span></span><br></pre></td></tr></table></figure></li><li><p>使用现成模型</p><p>一些现成的模型<a href="https://github.com/xiazeyu/live2d-widget-models"> xiazeyu/live2d-widget-models</a></p><p>安装后修改配置文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">model:</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">live2d-widget-model-wanko</span> <span class="comment"># npm install live2d-widget-model-wanko</span></span><br></pre></td></tr></table></figure></li><li><p>自行下载模型</p><p>该插件只支持Live2D Cubism 2的旧版模型</p><p>即<code>.moc + .model.json</code>的文件格式，不支持 Cubism 3/4/5 的 <code>.moc3 + \*model3.json</code></p><p>本站的淮名真白在该库下载<a href="https://github.com/Eikanya/Live2d-model/tree/master">Eikanya/Live2d-model: Live2d model collection</a></p><ol><li><p>下载模型，将模型放在 <code>[BlogRoot]/live2d_models/</code> 下，示例：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[BlogRoot]</span><br><span class="line">└─live2d_models</span><br><span class="line">    └─mashiro</span><br><span class="line">        ├─seifuku.<span class="number">1024</span></span><br><span class="line">            └─*.png</span><br><span class="line">        ├─seifuku.motions</span><br><span class="line">            └─*.mtn</span><br><span class="line">        ├─seifuku.model.json</span><br><span class="line">        ├─seifuku.moc</span><br><span class="line">        ├─seifuku.pose.json</span><br><span class="line">        └─physics.json</span><br></pre></td></tr></table></figure></li><li><p>修改配置</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">model:</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">mashiro</span> <span class="comment"># 若模型储存在[BlogRoot]/live2d_models下时，填入模型目录名</span></span><br></pre></td></tr></table></figure></li></ol></li></ol>              </div>            </details><h2 id="violet留言板"><a href="#violet留言板" class="headerlink" title="violet留言板"></a>violet留言板</h2><p>参考：<a href="https://akilar.top/posts/e2d3c450/">信笺样式留言板</a><br>页面/comments/的信封留言板<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-envelope --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>或<code>_config.butterfly.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-butterfly-envelope</span></span><br><span class="line"><span class="comment">## 留言板</span></span><br><span class="line"><span class="comment">## see https://akilar.top/posts/e2d3c450/</span></span><br><span class="line"><span class="attr">envelope_comment:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment">#控制开关</span></span><br><span class="line">  <span class="attr">custom_pic:</span>      </span><br><span class="line">    <span class="attr">cover:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-envelope/lib/violet.jpg</span> <span class="comment">#信笺头部图片</span></span><br><span class="line">    <span class="attr">line:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-envelope/lib/line.png</span> <span class="comment">#信笺底部图片</span></span><br><span class="line">    <span class="attr">beforeimg:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-envelope/lib/before.png</span> <span class="comment"># 信封前半部分</span></span><br><span class="line">    <span class="attr">afterimg:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-envelope/lib/after.png</span> <span class="comment"># 信封后半部分</span></span><br><span class="line">  <span class="attr">message:</span> <span class="comment">#信笺正文，多行文本，写法如下</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">有什么想问的？</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">有什么想说的？</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">有什么想吐槽的？</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">哪怕是有什么想吃的，都可以告诉我哦~</span></span><br><span class="line">  <span class="attr">bottom:</span> <span class="string">自动书记人偶竭诚为您服务！</span> <span class="comment">#仅支持单行文本</span></span><br><span class="line">  <span class="attr">height:</span> <span class="comment">#1050px，信封划出的高度</span></span><br><span class="line">  <span class="attr">path:</span> <span class="comment">#【可选】comments 的路径名称。默认为 comments，生成的页面为 comments/index.html</span></span><br><span class="line">  <span class="attr">front_matter:</span> <span class="comment">#【可选】comments页面的 front_matter 配置</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">留言板</span></span><br><span class="line">    <span class="attr">comments:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="统一首页背景"><a href="#统一首页背景" class="headerlink" title="统一首页背景"></a>统一首页背景</h2><p>背景统一为一张图<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>在<code>[BlogRoot]/static/css</code>下新建<code>custom.css</code>，添加以下代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   页脚与头图透明效果，为统一显示背景图</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="comment">/* 添加一个黑遮罩，避免看不清文字 */</span></span><br><span class="line"><span class="selector-id">#footer</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.45</span>) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 元素透明 */</span></span><br><span class="line"><span class="selector-id">#footer</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-id">#page-header</span>,</span><br><span class="line"><span class="selector-id">#page-header</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#footer</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#page-header</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: transparent <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>引入css</p><p>在主题配置文件<code>_config.butterfly.yml</code>中的<code>inject</code>配置项的<code>head</code>子项引入<code>custom.css</code>文件，注意此处以source为根目录</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/static/css/custom.css&quot;&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>修改配置</p><p>设置背景图，同样是该文件中的<code>background</code>配置项设置背景图</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Website Background</span></span><br><span class="line"><span class="comment"># Can set it to color or image url</span></span><br><span class="line"><span class="comment">## url(https://xxx/home.webp) 或 相对路径</span></span><br><span class="line"><span class="attr">background:</span> <span class="string">/static/img/default_cover_1.webp</span> <span class="comment">#改成你自己的路径</span></span><br></pre></td></tr></table></figure><p>并将<code>_config.butterfly.yml</code>中的<code>index_img</code>和<code>footer_bg</code>配置项取消，避免冗余加载</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The banner image of home page</span></span><br><span class="line"><span class="attr">index_img:</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># Footer Background</span></span><br><span class="line"><span class="attr">footer_bg:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="页脚美化"><a href="#页脚美化" class="headerlink" title="页脚美化"></a>页脚美化</h2><p>参考：<a href="https://akilar.top/posts/e87ad7f8/">Add Github Badge</a><br>页脚添加徽标和计时器<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-footer-beautify --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>或<code>_config.butterfly.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-butterfly-footer-beautify</span></span><br><span class="line"><span class="comment">## 页脚美化</span></span><br><span class="line"><span class="comment">## 页脚计时器：[Native JS Timer](https://akilar.top/posts/b941af/)</span></span><br><span class="line"><span class="comment">## 页脚徽标：[Add Github Badge](https://akilar.top/posts/e87ad7f8/)</span></span><br><span class="line"><span class="attr">footer_beautify:</span></span><br><span class="line">  <span class="attr">enable:</span></span><br><span class="line">    <span class="attr">timer:</span> <span class="literal">true</span> <span class="comment"># 计时器开关</span></span><br><span class="line">    <span class="attr">bdage:</span> <span class="literal">true</span> <span class="comment"># 徽标开关</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">10</span> <span class="comment"># 过滤器优先权</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">all</span> <span class="comment"># 应用页面</span></span><br><span class="line">  <span class="attr">exclude:</span> <span class="comment"># 屏蔽页面</span></span><br><span class="line">    <span class="comment"># - /posts/</span></span><br><span class="line">    <span class="comment"># - /about/</span></span><br><span class="line">  <span class="attr">layout:</span> <span class="comment"># 挂载容器类型</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">class</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">footer-other</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="comment"># 计时器部分配置项</span></span><br><span class="line">  <span class="attr">runtime_js:</span> </span><br><span class="line">  <span class="attr">runtime_css:</span> </span><br><span class="line">  <span class="comment"># 徽标部分配置项</span></span><br><span class="line">  <span class="attr">swiperpara:</span> <span class="number">0</span> <span class="comment">#若非0，则开启轮播功能，每行徽标个数</span></span><br><span class="line">  <span class="attr">bdageitem:</span></span><br><span class="line">    <span class="comment"># 制作徽标访问https://shields.io/badges/static-badge</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://hexo.io/</span> <span class="comment"># 徽标指向网站链接</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo</span> <span class="comment"># 徽标API</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">博客框架为Hexo_v6.2.0</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://butterfly.js.org/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">主题版本Butterfly_v4.3.1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://vercel.com/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">本站线路托管于Vercel</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://hyperos.mi.com/font/zh/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Font-Misans-EC6617?style=flat&amp;logo=xiaomi&amp;</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">本站使用</span> <span class="string">MiSans</span> <span class="string">字体</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">https://github.com/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">本站项目由Github托管</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">link:</span> <span class="string">http://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br><span class="line">      <span class="attr">shields:</span> <span class="string">https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris</span></span><br><span class="line">      <span class="attr">message:</span> <span class="string">本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可</span></span><br><span class="line">  <span class="attr">swiper_css:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css</span></span><br><span class="line">  <span class="attr">swiper_js:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js</span></span><br><span class="line">  <span class="attr">swiperbdage_init_js:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-footer-beautify/lib/swiperbdage_init.min.js</span></span><br></pre></td></tr></table></figure></li><li><p>新建<code>[BlogRoot]/static/js/footer-runtime.js</code>，添加以下代码（可以自行diy，修改建站时间）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="keyword">var</span> startDate = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;05/17/2025 12:00:00&quot;</span>); # 建站时间</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createtime</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 更新时间</span></span><br><span class="line">    now.<span class="title function_">setTime</span>(now.<span class="title function_">getTime</span>() + <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算时间差</span></span><br><span class="line">    <span class="keyword">var</span> totalMinutes = <span class="title class_">Math</span>.<span class="title function_">floor</span>((now - startDate) / <span class="number">60000</span>);</span><br><span class="line">    <span class="keyword">var</span> r = <span class="title class_">Math</span>.<span class="title function_">floor</span>(totalMinutes / <span class="number">1440</span>);        <span class="comment">// 天数</span></span><br><span class="line">    <span class="keyword">var</span> s = <span class="title class_">Math</span>.<span class="title function_">floor</span>((totalMinutes % <span class="number">1440</span>) / <span class="number">60</span>);  <span class="comment">// 小时数</span></span><br><span class="line">    <span class="keyword">var</span> l = <span class="title class_">Math</span>.<span class="title function_">floor</span>(totalMinutes % <span class="number">60</span>);          <span class="comment">// 分钟数</span></span><br><span class="line">    <span class="keyword">var</span> b = <span class="title class_">Math</span>.<span class="title function_">round</span>((now - startDate) / <span class="number">1000</span>) % <span class="number">60</span>; <span class="comment">// 秒数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 格式化时间</span></span><br><span class="line">    s = <span class="title class_">String</span>(s).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">    l = <span class="title class_">String</span>(l).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">    b = <span class="title class_">String</span>(b).<span class="title function_">padStart</span>(<span class="number">2</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动态生成页面内容</span></span><br><span class="line">    <span class="keyword">let</span> content = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div style=&quot;font-size:13px;font-weight:bold&quot;&gt;</span></span><br><span class="line"><span class="string">            本站居然运行了 <span class="subst">$&#123;r&#125;</span> 天 <span class="subst">$&#123;s&#125;</span> 小时 <span class="subst">$&#123;l&#125;</span> 分 <span class="subst">$&#123;b&#125;</span> 秒 </span></span><br><span class="line"><span class="string">            &lt;i id=&quot;heartbeat&quot; class=&#x27;fas fa-heartbeat&#x27;&gt;&lt;/i&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;`</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新页面上的元素</span></span><br><span class="line">    <span class="keyword">var</span> workboardElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;workboard&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (workboardElement) &#123;</span><br><span class="line">        workboardElement.<span class="property">innerHTML</span> = content;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每秒更新一次</span></span><br><span class="line"><span class="built_in">setInterval</span>(createtime, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure></li><li><p>新建<code>[BlogRoot]/static/css/footer-runtime.css</code>，添加以下代码：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#workboard</span>&#123;<span class="attribute">font-size</span>:<span class="number">13px</span>;<span class="attribute">font-weight</span>:<span class="number">700</span>&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改第2步添加的配置文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 计时器部分配置项 </span></span><br><span class="line"><span class="attr">runtime_js:</span> <span class="string">static/js/footer-runtime.js</span> <span class="comment"># 填你自己的相对地址（source为根目录）</span></span><br><span class="line"><span class="attr">runtime_css:</span> <span class="string">static/css/footer-runtime.css</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="文章分类磁贴"><a href="#文章分类磁贴" class="headerlink" title="文章分类磁贴"></a>文章分类磁贴</h2><p>参考：<a href="https://zfe.space/post/hexo-magnet.html">hexo-magnet 插件 1.0</a><br>文章分类美化组件<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-magnet --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>中添加：</p><p>分类名字<code>name</code>必须和文章的类名/标签一一对应</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">magnet:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">enable_page:</span> <span class="string">/</span> <span class="comment"># 挂载的页面</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">categories</span> <span class="comment"># 通过分类/标签筛选，categories/tags</span></span><br><span class="line">  <span class="attr">devide:</span> <span class="number">2</span> <span class="comment"># 列数</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">教程</span></span><br><span class="line">      <span class="attr">display_name:</span> <span class="string">小冰の魔改教程</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">📚</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">游戏评测</span></span><br><span class="line">      <span class="attr">display_name:</span> <span class="string">小冰の游戏评测</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">🎮</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">生活趣闻</span></span><br><span class="line">      <span class="attr">display_name:</span> <span class="string">小冰の生活趣闻</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">🐱‍👓</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">vue</span></span><br><span class="line">      <span class="attr">display_name:</span> <span class="string">小冰の编程学习</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">👩‍💻</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">学习</span></span><br><span class="line">      <span class="attr">display_name:</span> <span class="string">小冰の读书笔记</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">📒</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">随想</span></span><br><span class="line">      <span class="attr">display_name:</span> <span class="string">小冰の胡思乱想</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">💡</span></span><br><span class="line">  <span class="attr">color_setting:</span></span><br><span class="line">    <span class="attr">text_color:</span> <span class="string">black</span> <span class="comment"># 文字默认颜色</span></span><br><span class="line">    <span class="attr">text_hover_color:</span> <span class="string">white</span> <span class="comment"># 文字鼠标悬浮颜色</span></span><br><span class="line">    <span class="attr">background_color:</span> <span class="string">&quot;#f2f2f2&quot;</span> <span class="comment"># 背景默认颜色</span></span><br><span class="line">    <span class="attr">background_hover_color:</span> <span class="string">&quot;#b30070&quot;</span> <span class="comment"># 背景悬浮颜色</span></span><br><span class="line">  <span class="attr">layout:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">id</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">recent-posts</span></span><br><span class="line">    <span class="attr">index:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">temple_html:</span> <span class="string">&#x27;&lt;div class=&quot;recent-post-item&quot; style=&quot;width:100%;height: auto&quot;&gt;&lt;div id=&quot;catalog_magnet&quot;&gt;$&#123;temple_html_item&#125;&lt;/div&gt;&lt;/div&gt;&#x27;</span></span><br><span class="line">  <span class="attr">plus_style:</span> <span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>黑夜模式适配</p><p>在<code>[BlogRoot]/static/css/custom.css</code>文件中添加以下代码(具体颜色可以自己调节)：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/* ===========================================</span><br><span class="line">   hexo-magnet 插件夜间模式适配</span><br><span class="line">   =========================================== */</span><br><span class="line">[data-theme=&quot;dark&quot;] .magnet_link_context &#123;</span><br><span class="line">  background-color: #1e1e1e;</span><br><span class="line">  color: antiquewhite;</span><br><span class="line">  /* 恢复圆角 */</span><br><span class="line">  border-radius: var(--magnet-border-radius, 6px);</span><br><span class="line">  /* 平滑过渡效果 */</span><br><span class="line">  transition: all 0.3s ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/* 颜色适配 */</span><br><span class="line">[data-theme=&quot;dark&quot;] .magnet_link_context:hover &#123;</span><br><span class="line">  background-color: #3ecdf1;</span><br><span class="line">  color: #f2f2f2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="文章轮播"><a href="#文章轮播" class="headerlink" title="文章轮播"></a>文章轮播</h2><p>参考：<a href="https://akilar.top/posts/8e1264d1/">Swiper Bar</a><br>置顶文章轮播组件<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块,在博客根目录<code>[BlogRoot]</code>下打开终端，运行以下指令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-swiper --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>或<code>_config.butterfly.yml</code>中添加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># hexo-butterfly-swiper</span><br><span class="line"># see https://akilar.top/posts/8e1264d1/</span><br><span class="line">swiper:</span><br><span class="line">  enable: true </span><br><span class="line">  priority: 5 </span><br><span class="line">  enable_page: / # 应用页面</span><br><span class="line">  timemode: date #date/updated</span><br><span class="line">  layout:</span><br><span class="line">    type: id</span><br><span class="line">    name: recent-posts</span><br><span class="line">    index: 0</span><br><span class="line">  default_descr: 再怎么看我也不知道怎么描述它的啦！ # 默认文章描述</span><br><span class="line">  swiper_css: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css #swiper css依赖</span><br><span class="line">  swiper_js: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js #swiper js依赖</span><br><span class="line">  custom_css: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css # 适配主题样式补丁</span><br><span class="line">  custom_js: https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js # swiper初始化方法</span><br></pre></td></tr></table></figure></li><li><p>文章置顶</p><p>在文章的<code>front_matter</code>中添加<code>swiper_index</code>和<code>description</code>，示例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 文章标题</span><br><span class="line">date: 创建日期</span><br><span class="line">updated: 更新日期</span><br><span class="line">cover: 文章封面</span><br><span class="line">description: 文章描述 #文章轮播插件中的描述</span><br><span class="line">swiper_index: 1 #置顶轮播图顺序，大数靠前</span><br><span class="line">---</span><br></pre></td></tr></table></figure></li><li><p>禁用滚轮切换文章功能（自选）</p><p>组件范围较大，在滚轮滑动页面过程中，鼠标容易进入组件区域，此时滚轮变成切换文章，个人觉得影响体验。禁用方法：</p><p>将配置项中<code>custom_js</code>下载到本地，并注释掉其中<code>mousewheel: true</code>，然后修改配置<code>custom_js</code>指向本地js：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">custom_js:</span> <span class="string">/static/js/custom-swiper-init.js</span> <span class="comment">#禁用滚轮切换文章</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="导入外部字体"><a href="#导入外部字体" class="headerlink" title="导入外部字体"></a>导入外部字体</h2><p><strong>声明：非商免字体未经授权仅限个人使用，不得用于商业用途！</strong><br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>准备字体，放在<code>source/</code>下</p><p>支持<em>.eot(老版本IE)，</em>.otf，<em>.ttf，</em>.woff，*.woff2等格式，推荐woff2，压缩率最高</p></li><li><p>在<code>[BlogRoot]/static/css/custom.css</code>头部添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   自定义字体 - 优先加载</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="keyword">@font-face</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">&#x27;MiSans-Regular&#x27;</span>; # 自定义字体名</span><br><span class="line">  <span class="attribute">src</span>: <span class="built_in">url</span>(<span class="string">/static/font/MiSans-Regular.woff2</span>) <span class="built_in">format</span>(<span class="string">&#x27;woff2&#x27;</span>); # 字体文件路径</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* 优化字体加载 */</span></span><br><span class="line">  <span class="attribute">font-display</span>: swap; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改配置：修改<code>_config.butterfly.yml</code>中的<code>font</code>项以及<code>blog_title_font</code>项</p><p>填入<code>@font-face</code>中自定义的名字：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Global font settings</span></span><br><span class="line"><span class="comment"># Don&#x27;t modify the following settings unless you know how they work</span></span><br><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="attr">global_font_size:</span> </span><br><span class="line">  <span class="attr">code_font_size:</span> </span><br><span class="line">  <span class="attr">font_family:</span> <span class="string">MiSans-Regular,</span> <span class="string">sans-serif</span></span><br><span class="line">  <span class="attr">code_font_family:</span> <span class="string">Consolas,</span> <span class="string">sans-serif</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Font settings for the site title and site subtitle</span></span><br><span class="line"><span class="attr">blog_title_font:</span></span><br><span class="line">  <span class="attr">font_link:</span></span><br><span class="line">  <span class="attr">font_family:</span> <span class="string">MiSans-Regular,</span> <span class="string">sans-serif</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="元素动画"><a href="#元素动画" class="headerlink" title="元素动画"></a>元素动画</h2><p>参考：<a href="https://akilar.top/posts/abab51cf/">Add Blog Animation – Wowjs</a><br>为网页中的元素添加入场/出场动画<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-wowjs --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>或<code>_config.butterfly.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-butterfly-wowjs</span></span><br><span class="line"><span class="comment">## 自定义动画</span></span><br><span class="line"><span class="comment">## https://github.com/Akilarlxh/hexo-butterfly-wowjs</span></span><br><span class="line"><span class="comment">## https://animate.style/</span></span><br><span class="line"><span class="attr">wowjs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment">#移动端是否启用</span></span><br><span class="line">  <span class="attr">animateitem:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">recent-post-item</span> <span class="comment"># 添加动画的元素的class/id</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__fadeIn</span> <span class="comment"># 动画效果</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">class:</span> <span class="string">card-widget</span></span><br><span class="line">      <span class="attr">style:</span> <span class="string">animate__fadeIn</span></span><br><span class="line">  <span class="attr">animate_css:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css</span></span><br><span class="line">  <span class="attr">wow_js:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js</span></span><br><span class="line">  <span class="attr">wow_init_js:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>animateitem</code>详解</p><p><code>animateitem.class</code>：打开博客网页，<code>ctrl+shift+C</code>进入调试界面，选中希望添加的元素，读取元素id或class</p><p><code>animateitem.style</code>：打开<a href="https://animate.style/，复制动画id">https://animate.style/，复制动画id</a></p></li></ol>              </div>            </details></p><h2 id="导航栏魔改"><a href="#导航栏魔改" class="headerlink" title="导航栏魔改"></a>导航栏魔改</h2><p>导航栏居中、子菜单横向显示<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>在<code>[BlogRoot]/static/css/custom.css</code>中添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   导航栏布局</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="comment">/* 一级菜单居中 */</span></span><br><span class="line"><span class="selector-id">#nav</span> <span class="selector-class">.menus_items</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">width</span>: fit-content <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>) <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 防止菜单项收缩 */</span></span><br><span class="line"><span class="selector-id">#nav</span> <span class="selector-class">.menus_items</span> <span class="selector-class">.menus_item</span> &#123;</span><br><span class="line">  <span class="attribute">flex-shrink</span>: <span class="number">0</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 子菜单横向展示 */</span></span><br><span class="line"><span class="selector-id">#nav</span> <span class="selector-class">.menus_items</span> <span class="selector-class">.menus_item</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.menus_item_child</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导航栏子菜单居中对齐 */</span></span><br><span class="line"><span class="selector-class">.menus_items</span> <span class="selector-class">.menus_item</span> <span class="selector-class">.menus_item_child</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">100%</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">50%</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="built_in">calc</span>(-<span class="number">50%</span> + <span class="number">7px</span>)) <span class="meta">!important</span>; <span class="comment">/* 合并transform */</span></span><br><span class="line">  <span class="attribute">white-space</span>: nowrap <span class="meta">!important</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 性能优化 */</span></span><br><span class="line">  <span class="attribute">will-change</span>: transform;</span><br><span class="line">  <span class="attribute">backface-visibility</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="夜间模式标题霓虹灯"><a href="#夜间模式标题霓虹灯" class="headerlink" title="夜间模式标题霓虹灯"></a>夜间模式标题霓虹灯</h2><p>主题夜间模式下首页正副标题、导航栏添加霓虹灯效果<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>在<code>[BlogRoot]/static/css/custom.css</code>中添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   导航栏霓虹灯效果</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="comment">/* 性能优化：GPU加速 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#site-name</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#site-title</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#site-subtitle</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#post-info</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.author-info__name</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.author-info__description</span> &#123;</span><br><span class="line">  <span class="attribute">will-change</span>: text-shadow;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateZ</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 主标题 - 15px强度 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#site-name</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#site-title</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.author-info__name</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: hk-neon-<span class="number">15px</span> <span class="number">8s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 副标题 - 10px强度 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#site-subtitle</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.author-info__description</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: hk-neon-<span class="number">10px</span> <span class="number">8s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导航栏 - 5px强度 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#post-info</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: hk-neon-<span class="number">5px</span> <span class="number">8s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 15px（三层阴影） */</span></span><br><span class="line"><span class="keyword">@keyframes</span> hk-neon-<span class="number">15px</span> &#123;</span><br><span class="line">  <span class="number">0%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#FF1493</span>,                    <span class="comment">/* 内层锐利光晕 */</span></span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">20</span>, <span class="number">147</span>, <span class="number">0.8</span>),   <span class="comment">/* 中层光晕 */</span></span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">20</span>, <span class="number">147</span>, <span class="number">0.4</span>);   <span class="comment">/* 外层扩散光晕 */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">12.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#00BFFF</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">25%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#00FF7F</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">127</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">127</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">37.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#FFFF00</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#FF4500</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">69</span>, <span class="number">0</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">69</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">62.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#8A2BE2</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">138</span>, <span class="number">43</span>, <span class="number">226</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">138</span>, <span class="number">43</span>, <span class="number">226</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">75%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#00FFFF</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">87.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">#FF0040</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">12px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">30px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 10px强度（三层阴影） */</span></span><br><span class="line"><span class="keyword">@keyframes</span> hk-neon-<span class="number">10px</span> &#123;</span><br><span class="line">  <span class="number">0%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#FF1493</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">20</span>, <span class="number">147</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">20</span>, <span class="number">147</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">12.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#00BFFF</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">25%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#00FF7F</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">127</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">127</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">37.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#FFFF00</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#FF4500</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">69</span>, <span class="number">0</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">69</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">62.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#8A2BE2</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">138</span>, <span class="number">43</span>, <span class="number">226</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">138</span>, <span class="number">43</span>, <span class="number">226</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">75%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#00FFFF</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">87.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#FF0040</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 5px强度（三层阴影） */</span></span><br><span class="line"><span class="keyword">@keyframes</span> hk-neon-<span class="number">5px</span> &#123;</span><br><span class="line">  <span class="number">0%</span>, <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#FF1493</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">20</span>, <span class="number">147</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">20</span>, <span class="number">147</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">12.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#00BFFF</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">25%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#00FF7F</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">127</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">127</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">37.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#FFFF00</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#FF4500</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">69</span>, <span class="number">0</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">69</span>, <span class="number">0</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">62.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#8A2BE2</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">138</span>, <span class="number">43</span>, <span class="number">226</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">138</span>, <span class="number">43</span>, <span class="number">226</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">75%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#00FFFF</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">87.5%</span> &#123;</span><br><span class="line">    <span class="attribute">text-shadow</span>:</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> <span class="number">#FF0040</span>,</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">4px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">0.8</span>),</span><br><span class="line">      <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">0.4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 为导航菜单添加静态霓虹效果 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#nav</span> <span class="selector-class">.site-page</span>,</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#nav</span> <span class="selector-class">.menus_items</span> <span class="selector-class">.menus_item</span> <span class="selector-class">.menus_item_child</span> <span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>:</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#00BFFF</span>,</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">16px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.4</span>)</span><br><span class="line">    <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">transition</span>: text-shadow <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 手机端侧边栏静态霓虹效果 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#sidebar</span> <span class="selector-id">#sidebar-menus</span> <span class="selector-class">.menus_items</span> <span class="selector-class">.site-page</span> &#123;</span><br><span class="line">  <span class="attribute">text-shadow</span>:</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">2px</span> <span class="number">#00BFFF</span>,</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.8</span>),</span><br><span class="line">    <span class="number">0</span> <span class="number">0</span> <span class="number">16px</span> <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">0.4</span>)</span><br><span class="line">    <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="外挂标签"><a href="#外挂标签" class="headerlink" title="外挂标签"></a>外挂标签</h2><p>markdown以外的美化标签<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-butterfly-tag-plugins-plus --save</span><br></pre></td></tr></table></figure><p>考虑到hexo自带的markdown渲染插件<code>hexo-renderer-marked</code>与外挂标签语法的兼容性较差，建议将其替换成<a href="https://www.npmjs.com/package/hexo-renderer-kramed">hexo-renderer-kramed</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-kramed --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>或<code>_config.butterfly.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tag-plugins-plus</span></span><br><span class="line"><span class="comment">## 外挂标签，markdown以外的美化标签</span></span><br><span class="line"><span class="comment">## see https://akilar.top/posts/615e2dec/</span></span><br><span class="line"><span class="attr">tag_plugins:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># 开关</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">5</span> <span class="comment">#过滤器优先权</span></span><br><span class="line">  <span class="attr">issues:</span> <span class="literal">false</span> <span class="comment">#issues标签依赖注入开关</span></span><br><span class="line">  <span class="attr">link:</span></span><br><span class="line">    <span class="attr">placeholder:</span>  <span class="comment">#link_card标签默认的图标图片</span></span><br><span class="line">  <span class="attr">CDN:</span></span><br><span class="line">    <span class="attr">anima:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css</span> <span class="comment">#动画标签anima的依赖</span></span><br><span class="line">    <span class="attr">jquery:</span> <span class="string">https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js</span> <span class="comment">#issues标签依赖</span></span><br><span class="line">    <span class="attr">issues:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/issues.js</span> <span class="comment">#issues标签依赖</span></span><br><span class="line">    <span class="attr">iconfont:</span> <span class="string">//at.alicdn.com/t/font_2032782_8d5kxvn09md.js</span> <span class="comment">#参看https://akilar.top/posts/d2ebecef/</span></span><br><span class="line">    <span class="attr">carousel:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js</span></span><br><span class="line">    <span class="attr">tag_plugins_css:</span> <span class="string">https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css</span></span><br></pre></td></tr></table></figure></li><li><p>外挂标签的使用参考：<a href="https://www.fomal.cc/posts/2013454d.html">Markdown语法与外挂标签写法汇总</a></p></li></ol>              </div>            </details></p><h2 id="音乐插件"><a href="#音乐插件" class="headerlink" title="音乐插件"></a>音乐插件</h2><p>参考：<a href="https://butterfly.js.org/posts/507c070f/">Butterfly添加全局吸底Aplayer教程</a><br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-tag-aplayer --save</span><br></pre></td></tr></table></figure></li><li><p>添加配置：在<code>_config.yml</code>中添加：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-tag-aplayer</span></span><br><span class="line"><span class="comment"># 音乐播放器</span></span><br><span class="line"><span class="attr">aplayer:</span></span><br><span class="line">  <span class="attr">meting:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">asset_inject:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li><li><p>修改配置：在<code>_config.butterfly.yml</code>中修改<code>aplayerInject</code>配置项：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject the css and script (aplayer/meting)</span></span><br><span class="line"><span class="attr">aplayerInject:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></li><li><p>引入播放器</p><p>在主题配置文件<code>_config.butterfly.yml</code>中<code>inject</code>配置项的<code>bottom</code>子项引入如下元素，具体参数参考<a href="https://butterfly.js.org/posts/507c070f/">Butterfly添加全局吸底Aplayer教程</a></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/static/css/custom.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;link</span> <span class="string">rel=&quot;stylesheet&quot;</span> <span class="string">href=&quot;/static/css/title-night-light.css&quot;&gt;</span> <span class="comment"># 霓虹灯</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="comment"># - &lt;script src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;div</span> <span class="string">class=&quot;aplayer</span> <span class="literal">no</span><span class="string">-destroy&quot;</span> <span class="string">data-id=&quot;14320891825&quot;</span> <span class="string">data-server=&quot;netease&quot;</span> <span class="string">data-type=&quot;playlist&quot;</span> <span class="string">data-fixed=&quot;true&quot;</span> <span class="string">data-mini=&quot;true&quot;</span> <span class="string">data-autoplay=&quot;false&quot;</span> <span class="string">data-volume=&quot;0.3&quot;</span> <span class="string">data-order=&quot;random&quot;&gt;</span> <span class="string">&lt;/div&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>其中<code>data-id</code>为歌曲/歌单ID，在网页打开你的歌曲/歌单，将链接中<code>id=14320891825</code>填入此处。</p></li></ol>              </div>            </details></p><h2 id="文章标题旋转小风车"><a href="#文章标题旋转小风车" class="headerlink" title="文章标题旋转小风车"></a>文章标题旋转小风车</h2><p>为文章H1~H6标题头部添加旋转风车效果<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>修改配置：修改<code>_config.butterfly.yml</code>的<code>beautify.title_prefix_icon</code>配置项：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Configuration for beautifying the content of the article</span></span><br><span class="line"><span class="attr">beautify:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Specify the field to beautify (site or post)</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="comment"># Specify the icon to be used as a prefix for the title, such as &#x27;\f0c1&#x27;</span></span><br><span class="line">  <span class="attr">title_prefix_icon:</span> <span class="string">&#x27;\f863&#x27;</span></span><br><span class="line">  <span class="comment"># Specify the color of the title prefix icon, such as &#x27;#F47466&#x27;</span></span><br><span class="line">  <span class="attr">title_prefix_icon_color:</span> <span class="string">&#x27;#F47466&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>在<code>[BlogRoot]/static/css/custom.css</code>中添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ========================================</span></span><br><span class="line"><span class="comment">   文章页 H1-H6 标题风车动画效果</span></span><br><span class="line"><span class="comment">   ======================================== */</span></span><br><span class="line"><span class="comment">/* 变量定义 */</span></span><br><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="comment">/* 动画速度 */</span></span><br><span class="line">  <span class="attr">--animation-speed-normal</span>: <span class="number">4s</span>;</span><br><span class="line">  <span class="attr">--animation-speed-hover</span>: <span class="number">6s</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* 风车颜色配置 */</span></span><br><span class="line">  <span class="attr">--h1-color</span>: <span class="number">#ef50a8</span>;</span><br><span class="line">  <span class="attr">--h2-color</span>: <span class="number">#fb7061</span>;</span><br><span class="line">  <span class="attr">--h3-color</span>: <span class="number">#ffbf00</span>;</span><br><span class="line">  <span class="attr">--h4-color</span>: <span class="number">#a9e000</span>;</span><br><span class="line">  <span class="attr">--h5-color</span>: <span class="number">#57c850</span>;</span><br><span class="line">  <span class="attr">--h6-color</span>: <span class="number">#5ec1e0</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* 风车大小配置 */</span></span><br><span class="line">  <span class="attr">--h1-size</span>: <span class="number">1.3rem</span>;</span><br><span class="line">  <span class="attr">--h2-size</span>: <span class="number">1.1rem</span>;</span><br><span class="line">  <span class="attr">--h3-size</span>: <span class="number">0.95rem</span>;</span><br><span class="line">  <span class="attr">--h4-size</span>: <span class="number">0.8rem</span>;</span><br><span class="line">  <span class="attr">--h5-size</span>: <span class="number">0.7rem</span>;</span><br><span class="line">  <span class="attr">--h6-size</span>: <span class="number">0.66rem</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* 风车位置微调 */</span></span><br><span class="line">  <span class="attr">--h1-left</span>: -<span class="number">1.55rem</span>;</span><br><span class="line">  <span class="attr">--h1-top</span>: -<span class="number">0.23rem</span>;</span><br><span class="line">  <span class="attr">--h2-left</span>: -<span class="number">1.35rem</span>;</span><br><span class="line">  <span class="attr">--h2-top</span>: -<span class="number">0.12rem</span>;</span><br><span class="line">  <span class="attr">--h3-left</span>: -<span class="number">1.22rem</span>;</span><br><span class="line">  <span class="attr">--h3-top</span>: -<span class="number">0.09rem</span>;</span><br><span class="line">  <span class="attr">--h4-left</span>: -<span class="number">1.05rem</span>;</span><br><span class="line">  <span class="attr">--h4-top</span>: -<span class="number">0.09rem</span>;</span><br><span class="line">  <span class="attr">--h5-left</span>: -<span class="number">0.9rem</span>;</span><br><span class="line">  <span class="attr">--h5-top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attr">--h6-left</span>: -<span class="number">0.9rem</span>;</span><br><span class="line">  <span class="attr">--h6-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 风车旋转动画定义 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> windmill-rotate &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(-<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 基础风车样式 */</span></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-pseudo">:is</span>(<span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>)<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: windmill-rotate <span class="built_in">var</span>(--animation-speed-normal) linear infinite;</span><br><span class="line">  <span class="attribute">display</span>: inline-block; <span class="comment">/* 确保transform生效 */</span></span><br><span class="line">  <span class="attribute">transition</span>: color <span class="number">0.3s</span> ease; <span class="comment">/* 添加颜色过渡效果 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 各级标题风车样式 */</span></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h1</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--h1-color);</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="built_in">var</span>(--h1-left);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--h1-size);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--h1-top);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h2</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--h2-color);</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="built_in">var</span>(--h2-left);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--h2-size);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--h2-top);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h3</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--h3-color);</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="built_in">var</span>(--h3-left);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--h3-size);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--h3-top);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h4</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--h4-color);</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="built_in">var</span>(--h4-left);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--h4-size);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--h4-top);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h5</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--h5-color);</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="built_in">var</span>(--h5-left);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--h5-size);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--h5-top);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-tag">h6</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--h6-color);</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="built_in">var</span>(--h6-left);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">var</span>(--h6-size);</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="built_in">var</span>(--h6-top);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Hover效果 */</span></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-pseudo">:is</span>(<span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>)<span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--theme-color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#content-inner</span><span class="selector-class">.layout</span> <span class="selector-pseudo">:is</span>(<span class="selector-tag">h1</span>, <span class="selector-tag">h2</span>, <span class="selector-tag">h3</span>, <span class="selector-tag">h4</span>, <span class="selector-tag">h5</span>, <span class="selector-tag">h6</span>)<span class="selector-pseudo">:hover</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--theme-color);</span><br><span class="line">  <span class="attribute">animation-duration</span>: <span class="built_in">var</span>(--animation-speed-hover);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 响应式优化 */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width</span>: <span class="number">768px</span>) &#123;</span><br><span class="line">  <span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">    <span class="comment">/* 移动端可以适当调整大小 */</span></span><br><span class="line">    <span class="attr">--h1-size</span>: <span class="number">1.1rem</span>;</span><br><span class="line">    <span class="attr">--h2-size</span>: <span class="number">0.95rem</span>;</span><br><span class="line">    <span class="attr">--h3-size</span>: <span class="number">0.85rem</span>;</span><br><span class="line">    <span class="attr">--h4-size</span>: <span class="number">0.75rem</span>;</span><br><span class="line">    <span class="attr">--h5-size</span>: <span class="number">0.65rem</span>;</span><br><span class="line">    <span class="attr">--h6-size</span>: <span class="number">0.6rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="自定义恶搞标题"><a href="#自定义恶搞标题" class="headerlink" title="自定义恶搞标题"></a>自定义恶搞标题</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>新建文件<code>[BlogRoot]/static/js/title.js</code>，添加如下代码:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动态标题</span></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> originTitle = <span class="variable language_">document</span>.<span class="property">title</span>;      <span class="comment">// 自动获取当前页面标题</span></span><br><span class="line">  <span class="keyword">var</span> returnDelay = <span class="number">2000</span>;                <span class="comment">// 返回后多长时间恢复原标题</span></span><br><span class="line">  <span class="keyword">var</span> titleTimer = <span class="literal">null</span>;                 <span class="comment">// 定时器变量</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 标题池</span></span><br><span class="line">  <span class="keyword">var</span> titles = &#123;</span><br><span class="line">    <span class="attr">away</span>: [<span class="string">&#x27;👀 还会再见吗 燕子&#x27;</span>, <span class="string">&#x27;😢 我会想你的~&#x27;</span>, <span class="string">&#x27;😢 你带我走吧 燕子啊！&#x27;</span>, <span class="string">&#x27;🏃 跑哪里去了~&#x27;</span>, <span class="string">&#x27;😢 燕子没有你我怎么活~&#x27;</span>],</span><br><span class="line">    <span class="attr">back</span>: [<span class="string">&#x27;😊 欢迎回来！&#x27;</span>, <span class="string">&#x27;🎉 好久不见！&#x27;</span>, <span class="string">&#x27;🐖 抓到你啦~&#x27;</span>, <span class="string">&#x27;😀 终于等到你&#x27;</span>]</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 随机获取标题</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getRandomTitle</span>(<span class="params">type</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> titleArray = titles[type];</span><br><span class="line">    <span class="keyword">return</span> titleArray[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * titleArray.<span class="property">length</span>)];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 处理页面可见性变化</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleVisibilityChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 清理之前的定时器</span></span><br><span class="line">    <span class="keyword">if</span> (titleTimer) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(titleTimer);</span><br><span class="line">      titleTimer = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">hidden</span>) &#123;</span><br><span class="line">      <span class="comment">// 页面隐藏时</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">title</span> = <span class="title function_">getRandomTitle</span>(<span class="string">&#x27;away&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 页面显示时</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">title</span> = <span class="title function_">getRandomTitle</span>(<span class="string">&#x27;back&#x27;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// 根据returnDelay恢复原标题</span></span><br><span class="line">      titleTimer = <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">title</span> = originTitle;</span><br><span class="line">        titleTimer = <span class="literal">null</span>;  <span class="comment">// 清理引用</span></span><br><span class="line">      &#125;, returnDelay);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 绑定事件</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;visibilitychange&#x27;</span>, handleVisibilityChange);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 页面卸载时清理</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;beforeunload&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (titleTimer) &#123;</span><br><span class="line">      <span class="built_in">clearTimeout</span>(titleTimer);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// PJAX 支持</span></span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;pjax:complete&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    originTitle = <span class="variable language_">document</span>.<span class="property">title</span>;  <span class="comment">// 更新原始标题</span></span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></li><li><p>引入js</p><p>在<code>_config.butterfly.yml</code>中<code>inject</code>配置项引入该文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span> </span><br><span class="line">  <span class="attr">bottom:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">async</span> <span class="string">src=&quot;/static/js/title.js&quot;&gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><h2 id="Twikoo评论系统部署"><a href="#Twikoo评论系统部署" class="headerlink" title="Twikoo评论系统部署"></a>Twikoo评论系统部署</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>根据官方文档部署Twikoo服务<a href="https://twikoo.js.org/quick-start.html#针对-vercel-部署的更新方式">官方：Twikoo文档-针对Vercel的部署</a></p><p>博主使用的是MongoDB数据库+Vercel部署的方案，按照这两部分操作即可：<a href="https://twikoo.js.org/mongodb-atlas.html">MongoDB Atlas</a> + <a href="https://twikoo.js.org/backend.html#vercel-部署">云函数部署 | Vercel</a></p><p>（可选）在Vercel上部署完成后，可在项目页面的<code>Settings</code>-<code>Domains</code>中配置自己的域名</p></li><li><p>修改配置：修改<code>_config.butterfly.yml</code>中<code>comment</code>和<code>twikoo</code>配置项：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"><span class="comment"># Comments System</span></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="comment"># Up to two comments system, the first will be shown as default</span></span><br><span class="line">  <span class="comment"># Leave it empty if you don&#x27;t need comments</span></span><br><span class="line">  <span class="comment"># Choose: Disqus/Disqusjs/Livere/Gitalk/Valine/Waline/Utterances/Facebook Comments/Twikoo/Giscus/Remark42/Artalk</span></span><br><span class="line">  <span class="comment"># Format of two comments system : Disqus,Waline</span></span><br><span class="line">  <span class="attr">use:</span> <span class="string">Twikoo</span></span><br><span class="line">  <span class="comment"># Display the comment name next to the button</span></span><br><span class="line">  <span class="attr">text:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Lazyload: The comment system will be load when comment element enters the browser&#x27;s viewport.</span></span><br><span class="line">  <span class="comment"># If you set it to true, the comment count will be invalid</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Display comment count in post&#x27;s top_img</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Display comment count in Home Page</span></span><br><span class="line">  <span class="attr">card_post_count:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Twikoo</span></span><br><span class="line"><span class="comment"># https://github.com/imaegoo/twikoo</span></span><br><span class="line"><span class="attr">twikoo:</span></span><br><span class="line">  <span class="attr">envId:</span> <span class="comment"># 填入步骤1中的环境id</span></span><br><span class="line">  <span class="attr">region:</span></span><br><span class="line">  <span class="comment"># Use Twikoo visitor count as the page view count</span></span><br><span class="line">  <span class="attr">visitor:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">option:</span></span><br></pre></td></tr></table></figure></li><li><p>配置管理员密码</p><p>启动项目</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo cl; hexo s</span><br></pre></td></tr></table></figure><p>随意进入一篇文章，等待底部评论系统加载完成，点击右下角设置按钮进入Twikoo管理面板</p><p>第一次进入管理面板需设置管理员登录密码，在管理面板中可管理评论，配置选项也有比较详细的注释，这里不过多介绍</p></li></ol>              </div>            </details><h2 id="b站视频适配"><a href="#b站视频适配" class="headerlink" title="b站视频适配"></a>b站视频适配</h2><p>简单添加了几行css样式<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>在<code>[BlogRoot]/static/css/custom.css</code>中添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*哔哩哔哩视频适配*/</span></span><br><span class="line"><span class="selector-class">.aspect-ratio</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">75%</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">3%</span> auto;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.aspect-ratio</span> <span class="selector-tag">iframe</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">86%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>引用bilibili视频</p><p>网页版b站视频分享按钮中选择嵌入代码，复制代码</p><p>在你文章中（markdown文件）使用如下代码引入b站视频，<code>&lt;iframe&gt;&lt;/iframe&gt;</code>替换为复制的内容<br>注意：如果不希望自动播放，需在链接末尾加入<code>autoplay=0</code></p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">center</span> <span class="attr">class</span>=<span class="string">&quot;aspect-ratio&quot;</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;iframe src=&quot;https://player.bilibili.com/player.html?aid=80433022&amp;autoplay=0&quot; </span></span><br><span class="line"><span class="code">    allowfullscreen=&quot;true&quot;&gt; </span></span><br><span class="line"><span class="code">    &lt;/iframe&gt;</span></span><br><span class="line"><span class="code">&lt;/div&gt;</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="评论区输入提示"><a href="#评论区输入提示" class="headerlink" title="评论区输入提示"></a>评论区输入提示</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <p>在<code>[BlogRoot]/static/css/custom.css</code>中添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   评论框提示文字</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="comment">/* 定义提示文字内容 */</span></span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.el-input--small</span><span class="selector-class">.el-input-group</span><span class="selector-class">.el-input-group--prepend</span><span class="selector-pseudo">:nth-child</span>(<span class="number">1</span>)<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;输入QQ号会自动获取昵称和头像🐧&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.el-input--small</span><span class="selector-class">.el-input-group</span><span class="selector-class">.el-input-group--prepend</span><span class="selector-pseudo">:nth-child</span>(<span class="number">2</span>)<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;收到回复将会发送到您的邮箱📧&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.el-input--small</span><span class="selector-class">.el-input-group</span><span class="selector-class">.el-input-group--prepend</span><span class="selector-pseudo">:nth-child</span>(<span class="number">3</span>)<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;可以通过昵称访问您的网站🔗&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 提示框主体样式 */</span></span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.el-input--small</span><span class="selector-class">.el-input-group</span><span class="selector-class">.el-input-group--prepend</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">60px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(-<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">14px</span> <span class="number">18px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#444</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 提示框小三角箭头 */</span></span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.el-input--small</span><span class="selector-class">.el-input-group</span><span class="selector-class">.el-input-group--prepend</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: -<span class="number">48px</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">50%</span>);</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">12px</span> solid transparent;</span><br><span class="line">    <span class="attribute">border-top-color</span>: <span class="number">#444</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输入框获得焦点时显示提示 */</span></span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.el-input--small</span><span class="selector-class">.el-input-group</span><span class="selector-class">.el-input-group--prepend</span><span class="selector-pseudo">:focus-within</span><span class="selector-pseudo">::before</span>,</span><br><span class="line"><span class="selector-class">.el-input</span><span class="selector-class">.el-input--small</span><span class="selector-class">.el-input-group</span><span class="selector-class">.el-input-group--prepend</span><span class="selector-pseudo">:focus-within</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><h2 id="diy通知样式"><a href="#diy通知样式" class="headerlink" title="diy通知样式"></a>diy通知样式</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>新建<code>[BlogRoot]\source\static\js\custom.js</code>，添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   Toast 通知</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Toast 通知 - 显示消息提示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">message</span> - 消息内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">duration</span> - 显示时长，默认2000ms</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 用法：</span></span><br><span class="line"><span class="comment"> * showToast(&#x27;操作成功！&#x27;);</span></span><br><span class="line"><span class="comment"> * showToast(&#x27;切换完成&#x27;, 2000);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showToast</span>(<span class="params">message, duration = <span class="number">2000</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 检测当前主题</span></span><br><span class="line">    <span class="keyword">const</span> isDarkMode = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>) === <span class="string">&#x27;dark&#x27;</span> || </span><br><span class="line">                      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;DarkMode&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建通知容器</span></span><br><span class="line">    <span class="keyword">let</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;toast-container&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!container) &#123;</span><br><span class="line">        container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        container.<span class="property">id</span> = <span class="string">&#x27;toast-container&#x27;</span>;</span><br><span class="line">        container.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            position: fixed;</span></span><br><span class="line"><span class="string">            top: 20px;</span></span><br><span class="line"><span class="string">            right: 20px;</span></span><br><span class="line"><span class="string">            z-index: 9999;</span></span><br><span class="line"><span class="string">            pointer-events: none;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建通知元素</span></span><br><span class="line">    <span class="keyword">const</span> toast = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    toast.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;span style=&quot;margin-right: 8px;&quot;&gt;😊&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;<span class="subst">$&#123;message&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据主题设置样式</span></span><br><span class="line">    <span class="keyword">const</span> lightStyles = &#123;</span><br><span class="line">        <span class="attr">background</span>: <span class="string">&#x27;#f0f9ff&#x27;</span>,</span><br><span class="line">        <span class="attr">border</span>: <span class="string">&#x27;1px solid #bfdbfe&#x27;</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#1e293b&#x27;</span>,</span><br><span class="line">        <span class="attr">boxShadow</span>: <span class="string">&#x27;0 4px 12px rgba(0,0,0,0.15)&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> darkStyles = &#123;</span><br><span class="line">        <span class="attr">background</span>: <span class="string">&#x27;#1e293b&#x27;</span>,</span><br><span class="line">        <span class="attr">border</span>: <span class="string">&#x27;1px solid #475569&#x27;</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#e2e8f0&#x27;</span>,</span><br><span class="line">        <span class="attr">boxShadow</span>: <span class="string">&#x27;0 4px 12px rgba(0,0,0,0.4)&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> currentStyles = isDarkMode ? darkStyles : lightStyles;</span><br><span class="line">    </span><br><span class="line">    toast.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">`</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        align-items: center;</span></span><br><span class="line"><span class="string">        margin-bottom: 10px;</span></span><br><span class="line"><span class="string">        padding: 12px 16px;</span></span><br><span class="line"><span class="string">        background: <span class="subst">$&#123;currentStyles.background&#125;</span>;</span></span><br><span class="line"><span class="string">        border: <span class="subst">$&#123;currentStyles.border&#125;</span>;</span></span><br><span class="line"><span class="string">        color: <span class="subst">$&#123;currentStyles.color&#125;</span>;</span></span><br><span class="line"><span class="string">        border-radius: 8px;</span></span><br><span class="line"><span class="string">        box-shadow: <span class="subst">$&#123;currentStyles.boxShadow&#125;</span>;</span></span><br><span class="line"><span class="string">        transform: translateX(100%);</span></span><br><span class="line"><span class="string">        transition: all 0.3s ease;</span></span><br><span class="line"><span class="string">        pointer-events: auto;</span></span><br><span class="line"><span class="string">        max-width: 320px;</span></span><br><span class="line"><span class="string">        word-break: break-word;</span></span><br><span class="line"><span class="string">        font-size: 14px;</span></span><br><span class="line"><span class="string">        line-height: 1.4;</span></span><br><span class="line"><span class="string">        cursor: pointer;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line"></span><br><span class="line">    container.<span class="title function_">appendChild</span>(toast);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进入动画</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateX(0)&#x27;</span>;</span><br><span class="line">    &#125;, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自动消失</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateX(100%)&#x27;</span>;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (toast.<span class="property">parentNode</span>) &#123;</span><br><span class="line">                toast.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(toast);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">300</span>);</span><br><span class="line">    &#125;, duration);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击关闭</span></span><br><span class="line">    toast.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateX(100%)&#x27;</span>;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (toast.<span class="property">parentNode</span>) &#123;</span><br><span class="line">                toast.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(toast);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">300</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入<code>custom.js</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">head:</span></span><br><span class="line">    <span class="comment"># - &lt;link rel=&quot;stylesheet&quot; href=&quot;/xxx.css&quot;&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">src=&quot;/static/js/custom.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><h2 id="个人信息卡片美化"><a href="#个人信息卡片美化" class="headerlink" title="个人信息卡片美化"></a>个人信息卡片美化</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>在<code>[BlogRoot]/source/static/css/custom.css</code>中添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。<br>图片url换成你自己的</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   侧边栏个人信息卡片美化</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="comment">/* 背景图 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span> <span class="selector-id">#aside-content</span> &gt; <span class="selector-class">.card-widget</span><span class="selector-class">.card-info</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: </span><br><span class="line">    <span class="built_in">linear-gradient</span>(<span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.15</span>), <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.45</span>)),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">/static/img/aside-card-light.webp</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-attachment</span>: inherit;</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#aside-content</span> &gt; <span class="selector-class">.card-widget</span><span class="selector-class">.card-info</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: </span><br><span class="line">    <span class="built_in">linear-gradient</span>(<span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.15</span>), <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)),</span><br><span class="line">    <span class="built_in">url</span>(<span class="string">/static/img/aside-card-dark.webp</span>);</span><br><span class="line">  <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">  <span class="attribute">background-attachment</span>: inherit;</span><br><span class="line">  <span class="attribute">background-size</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 头像呼吸灯 - 增强版 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span> <span class="selector-class">.avatar-img</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: huxi_light <span class="number">4s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-class">.avatar-img</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: huxi_dark <span class="number">4s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 白天模式呼吸灯 - 1.5倍效果 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> huxi_light &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="number">#e9f5fa</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">6px</span> <span class="number">6px</span> <span class="number">#e9f5fa</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="number">#e9f5fa</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 夜间模式呼吸灯 - 1.5倍效果 */</span></span><br><span class="line"><span class="keyword">@keyframes</span> huxi_dark &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="number">#3daee2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">50%</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">6px</span> <span class="number">6px</span> <span class="number">#3daee2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="number">100%</span> &#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0px</span> <span class="number">0px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="number">#3daee2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Follow Me按钮 */</span></span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span> <span class="selector-id">#aside-content</span> &gt; <span class="selector-class">.card-widget</span><span class="selector-class">.card-info</span> &gt; <span class="selector-id">#card-info-btn</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#399cffba</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">74</span>, <span class="number">158</span>, <span class="number">242</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;light&quot;</span>]</span> <span class="selector-id">#aside-content</span> &gt; <span class="selector-class">.card-widget</span><span class="selector-class">.card-info</span> &gt; <span class="selector-id">#card-info-btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#fc7836ba</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2px</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">16px</span> <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">138</span>, <span class="number">80</span>, <span class="number">0.4</span>);</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#aside-content</span> &gt; <span class="selector-class">.card-widget</span><span class="selector-class">.card-info</span> &gt; <span class="selector-id">#card-info-btn</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#ff8157ba</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">0.3s</span> ease;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">2px</span> <span class="number">8px</span> <span class="built_in">rgba</span>(<span class="number">244</span>, <span class="number">132</span>, <span class="number">95</span>, <span class="number">0.3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-attr">[data-theme=<span class="string">&quot;dark&quot;</span>]</span> <span class="selector-id">#aside-content</span> &gt; <span class="selector-class">.card-widget</span><span class="selector-class">.card-info</span> &gt; <span class="selector-id">#card-info-btn</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#6366F1ba</span>;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translateY</span>(-<span class="number">2px</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">4px</span> <span class="number">16px</span> <span class="built_in">rgba</span>(<span class="number">99</span>, <span class="number">102</span>, <span class="number">241</span>, <span class="number">0.4</span>);</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details><h2 id="待定"><a href="#待定" class="headerlink" title="待定"></a>待定</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>                            </div>            </details><h2 id="追番页面、游戏推荐"><a href="#追番页面、游戏推荐" class="headerlink" title="追番页面、游戏推荐"></a>追番页面、游戏推荐</h2><p>参考：<a href="https://github.com/HCLonely/hexo-bilibili-bangumi">为Hexo博客添加追番/追剧页面</a><br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装插件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-bilibili-bangumi --save</span><br></pre></td></tr></table></figure></li><li><p>使用<code>bangumi</code>数据源（也可使用<code>bilibili</code>数据，但b站番剧不全故不推荐，仍想使用自行查看github仓库）</p><p>访问<a href="https://bgm.tv/">Bangumi 番组计划</a>，注册账号，收藏你像添加的番剧或游戏</p><p><code>f12</code>打开控制台，输入<code>CHOBITS_UID</code>获取用户ID</p></li><li><p>添加配置：在<code>_config.yml</code>中添加：</p><p><code>path</code>、<code>vimd</code>等参数替换为自己的</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hexo-bilibili-bangumi</span></span><br><span class="line"><span class="comment"># https://github.com/HCLonely/hexo-bilibili-bangumi</span></span><br><span class="line"><span class="attr">bangumi:</span> <span class="comment"># 追番设置</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span>           <span class="comment"># 是否启用</span></span><br><span class="line">  <span class="attr">source:</span> <span class="string">bangumi</span>          <span class="comment"># 数据源</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">animations/index.html</span>  <span class="comment"># 页面路径</span></span><br><span class="line">  <span class="attr">vmid:</span> <span class="string">x1ang</span>                <span class="comment"># 用户ID</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;追番列表&#x27;</span>      <span class="comment"># 页面标题</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;你所热爱的 就是你的生活&#x27;</span> <span class="comment"># 页面引言</span></span><br><span class="line">  <span class="attr">show:</span> <span class="number">2</span>              <span class="comment"># 初始显示页面: 0=想看, 1=在看, 2=看过</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span>       <span class="comment"># 是否启用图片懒加载</span></span><br><span class="line">  <span class="attr">metaColor:</span> <span class="string">&#x27;#f2b94b&#x27;</span>   <span class="comment"># meta 信息字体颜色</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&#x27;#6587b5&#x27;</span>       <span class="comment"># 简介字体颜色</span></span><br><span class="line">  <span class="attr">webp:</span> <span class="literal">true</span>          <span class="comment"># 是否使用 webp 格式图片</span></span><br><span class="line">  <span class="attr">pagination:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">progress:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">progressBar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">extraOrder:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">order:</span> <span class="string">&#x27;-score&#x27;</span></span><br><span class="line"><span class="attr">game:</span> <span class="comment"># 游戏设置，仅支持source: bgmv0</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">games/index.html</span></span><br><span class="line">  <span class="attr">source:</span> <span class="string">bgmv0</span></span><br><span class="line">  <span class="attr">vmid:</span> <span class="string">x1ang</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">&#x27;一部游戏一段人生&#x27;</span></span><br><span class="line">  <span class="attr">quote:</span> <span class="string">&#x27;跌宕起伏的故事，引人入胜的玩法，余音绕梁的旋律，沉浸式体验另一段时空&#x27;</span></span><br><span class="line">  <span class="attr">show:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">metaColor:</span> <span class="string">&#x27;#f2b94b&#x27;</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">&#x27;#99A9BF&#x27;</span></span><br><span class="line">  <span class="attr">webp:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">pagination:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">progress:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">progressBar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">extraOrder:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">order:</span> <span class="string">-score</span></span><br></pre></td></tr></table></figure></li><li><p>页面美化：在<code>[BlogRoot]/static/css/custom.css</code>文件中添加以下代码(具体颜色可以自己调节)：<br>参考：<a href="https://blog.anheyu.com/bangumis/">追番列表 | 安知鱼</a></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 番剧插件 */</span></span><br><span class="line"><span class="selector-id">#page</span> <span class="selector-id">#article-container</span> <span class="selector-class">.bangumi-tab</span><span class="selector-class">.bangumi-active</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#425aef</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f7f7fa</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#page</span> <span class="selector-id">#article-container</span> <span class="selector-class">.bangumi-tabs</span> <span class="selector-class">.bangumi-tab</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#page</span> <span class="selector-id">#article-container</span> <span class="selector-class">.bangumi-tabs</span> <span class="selector-tag">a</span><span class="selector-class">.bangumi-tab</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">column-gap</span>: <span class="number">#f7f7fa</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#page</span> <span class="selector-id">#article-container</span> <span class="selector-class">.bangumi-pagination</span> <span class="selector-tag">a</span><span class="selector-class">.bangumi-button</span> &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: none;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-button</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#425aef</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f7f7fa</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.bangumi-button</span><span class="selector-class">.bangumi-nextpage</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-button</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.bangumi-tab</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span> <span class="number">10px</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">svg</span><span class="selector-class">.icon</span><span class="selector-class">.faa-tada</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-info-item</span> &#123;</span><br><span class="line">  <span class="attribute">border-right</span>: <span class="number">1px</span> solid <span class="number">#f2b94b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-info-item</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f2b94b</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bangumi-info-item</span> <span class="selector-tag">em</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#f2b94b</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>获取数据：命令行运行：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo game -u;</span><br><span class="line">hexo bangumi -u;</span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="Github-Action"><a href="#Github-Action" class="headerlink" title="Github Action"></a>Github Action</h2><p>随着文章越来越多，在本地使用<code>Hexo</code>部署的时间也会越来越长，借助<code>Github Action</code>，我们只需将修改<code>push</code>到远程仓库，将工作交给<code>github</code>完成<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>获取Token</p><p>访问<a href="https://github.com/settings/tokens"><code>Github-&gt;头像-&gt;Settings-&gt;Developer Settings-&gt;Personal access tokens-&gt;Token(classic)</code></a><code>-&gt;generate new token(classic)</code></p><p><code>Token</code>名称随意，<code>Expiration</code>选择<code>No Expiration</code>，必须勾选<code>repo</code>项和<code>workflows</code>项，保存生成的<code>Token</code>。</p><p><em>注意：<code>Token</code>只会显示一次，后续无法查看，如果遗忘了只能重新生成。</em></p></li><li><p>创建源码仓库（如有可跳过）</p><p>需要创建一个用来存放<code>Hexo</code>博客源码的私有仓库，创建完成后需要使用<code>git</code>将本地的源码<code>push</code>到仓库。</p><p><code>git</code>使用方法这里不展开，可以参考：<a href="https://liaoxuefeng.com/books/git/introduction/index.html">简介 - Git教程 - 廖雪峰的官方网站</a></p><p>使用<code>git</code>提交前配置<code>.gitignore</code>，避免把一些可自动生成的文件上传：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># Hexo 生成的文件</span><br><span class="line">public/</span><br><span class="line">.deploy_git/</span><br><span class="line">db.json</span><br><span class="line"></span><br><span class="line"># 缓存与临时文件</span><br><span class="line">node_modules/</span><br><span class="line">tmp/</span><br><span class="line">.nyc_output/</span><br><span class="line">coverage/</span><br><span class="line">dist/</span><br><span class="line">npm-debug.log*</span><br><span class="line">yarn-debug.log*</span><br><span class="line">yarn-error.log*</span><br><span class="line"></span><br><span class="line"># 编辑器相关</span><br><span class="line">.DS_Store</span><br><span class="line">Thumbs.db</span><br><span class="line">.vscode/</span><br><span class="line">.idea/</span><br><span class="line"></span><br><span class="line"># 系统临时文件</span><br><span class="line">*.swp</span><br><span class="line">*.swo</span><br><span class="line">*.tmp</span><br><span class="line">*.log</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>配置<code>Github Action</code></p><p>新建<code>[Blogroot]/.github/workflows/autodeploy.yml</code>添加以下配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 当有改动推送到main分支时，启动Action</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">自动部署</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line">  <span class="attr">release:</span></span><br><span class="line">    <span class="attr">types:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">published</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">检查分支</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">ref:</span> <span class="string">main</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装</span> <span class="string">Node</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">&quot;20.x&quot;</span> <span class="comment"># 替换成你本地使用的node大版本，用node -v查看</span></span><br><span class="line">        <span class="attr">cache:</span> <span class="string">&#x27;npm&#x27;</span> <span class="comment"># 使用缓存，确保你的package-lock.json被正确上传</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装</span> <span class="string">Hexo</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        export TZ=&#x27;Asia/Shanghai&#x27;</span></span><br><span class="line"><span class="string">        npm install hexo-cli -g</span></span><br><span class="line"><span class="string"></span>        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">缓存</span> <span class="string">Hexo</span></span><br><span class="line">      <span class="attr">uses:</span> <span class="string">actions/cache@v4</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">cache</span></span><br><span class="line">      <span class="attr">with:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">        <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.OS</span> <span class="string">&#125;&#125;-node-modules-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          $&#123;&#123; runner.OS &#125;&#125;-node-modules-</span></span><br><span class="line"><span class="string"></span>          </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装依赖</span></span><br><span class="line">      <span class="attr">if:</span> <span class="string">steps.cache.outputs.cache-hit</span> <span class="type">!=</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">        npm install --prefer-offline --no-audit</span></span><br><span class="line"><span class="string"></span>        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">生成静态文件</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span> <span class="comment"># 有其他需要运行的命令，自行添加（例如glup压缩等）</span></span><br><span class="line">        <span class="string">hexo</span> <span class="string">clean</span></span><br><span class="line">        <span class="string">hexo</span> <span class="string">generate</span></span><br><span class="line">        </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">部署</span> </span><br><span class="line">      <span class="attr">run:</span> <span class="string">|</span> <span class="comment"># 末尾main:main指从本地main分支推送到远程main分支，本地分支名不用修改，远程改成博客静态文件仓库的主分支</span></span><br><span class="line">        <span class="string">cd</span> <span class="string">./public</span></span><br><span class="line">        <span class="string">git</span> <span class="string">init</span></span><br><span class="line">        <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&#x27;$&#123;&#123; secrets.GITHUBUSERNAME &#125;&#125;&#x27;</span></span><br><span class="line">        <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&#x27;$&#123;&#123; secrets.GITHUBEMAIL &#125;&#125;&#x27;</span></span><br><span class="line">        <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line">        <span class="string">git</span> <span class="string">commit</span> <span class="string">-m</span> <span class="string">&quot;$<span class="template-variable">&#123;&#123; github.event.head_commit.message &#125;&#125;</span> $(date +&quot;</span><span class="string">%Z</span> <span class="string">%Y-%m-%d</span> <span class="string">%A</span> <span class="string">%H:%M:%S&quot;)</span> <span class="string">Updated</span> <span class="string">By</span> <span class="string">Github</span> <span class="string">Actions&quot;</span></span><br><span class="line">        <span class="string">git</span> <span class="string">branch</span> <span class="string">-M</span> <span class="string">main</span></span><br><span class="line">        <span class="string">git</span> <span class="string">push</span> <span class="string">--force</span> <span class="string">--quiet</span> <span class="string">&quot;https://$<span class="template-variable">&#123;&#123; secrets.GITHUBUSERNAME &#125;&#125;</span>:$<span class="template-variable">&#123;&#123; secrets.GITHUBTOKEN &#125;&#125;</span>@github.com/$<span class="template-variable">&#123;&#123; secrets.GITHUBUSERNAME &#125;&#125;</span>/$<span class="template-variable">&#123;&#123; secrets.GITHUBUSERNAME &#125;&#125;</span>.github.io.git&quot;</span> <span class="string">main:main</span> </span><br></pre></td></tr></table></figure></li><li><p>添加仓库秘钥</p><p>到你的博客<strong>源码</strong>仓库的<code>Settings-&gt;Secrets and variables-&gt;Actions</code>中添加<code>Repository secrets</code></p><p>点击<code>New repository secret</code>，将<code>autodeploy.yml</code>中使用的几个秘钥添加：</p><p>GITHUBUSERNAME ：你的<code>github</code>用户名，例如：我的博客静态文件仓库为<code>x1angji/x1angji.github.io</code>，在此处填入<code>x1angji</code></p><p>GITHUBEMAIL ：用于接收部署信息的邮箱</p><p>GITHUBTOKEN ：第一步获取的<code>Token</code></p></li><li><p>自动部署</p><p>使用<code>git</code>随意推送一次提交到<code>源码</code>仓库</p><p>打开源码仓库，找到<code>Actions-&gt;自动部署</code>，根据提交记录点进刚刚的提交，点击<code>deploy</code>即可查看部署过程</p></li></ol>              </div>            </details></p><h1 id="源码魔改"><a href="#源码魔改" class="headerlink" title="源码魔改"></a>源码魔改</h1><p>该部分涉及到butterfly主题源码的修改，升级主题难以保留，需重新魔改</p><h2 id="分享本页"><a href="#分享本页" class="headerlink" title="分享本页"></a>分享本页</h2><p>参考：<a href="https://www.fomal.cc/posts/2d7ac914.html">博客魔改教程总结(三) | Fomalhaut🥝</a><br>前置条件：diy通知样式<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>侧边栏添加分享按钮，在<code>[ThemeRoot]/layout/include/rightside.pug</code>做以下修改：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -22,4 +22,7 @@</span></span><br><span class="line">       when &#x27;toc&#x27;</span><br><span class="line">         if showToc</span><br><span class="line">           button#mobile-toc-button.close(type=&quot;button&quot; title=_p(&quot;rightside.toc&quot;))</span><br><span class="line">             i.fas.fa-list-ul</span><br><span class="line"><span class="addition">+      when &#x27;share&#x27;</span></span><br><span class="line"><span class="addition">+        button.share(type=&quot;button&quot; title=&#x27;分享链接&#x27; onclick=&quot;pageShare()&quot;)</span></span><br><span class="line"><span class="addition">+          i.fas.fa-share-nodes</span></span><br></pre></td></tr></table></figure></li><li><p>新建<code>[BlogRoot]/source/static/js/page-share.js</code>，添加如下代码：</p><p>获取的<code>title</code>结尾会有字符<code>| [你的站点名]</code>，<code>subTitle</code>目的是去除结尾的字符，根据你的站点名修改<code>endsWith</code>和<code>substring</code>的参数。</p><p><code>writeText</code>的参数为复制内容</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分享本页</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">pageShare</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">origin</span> + <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">pathname</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 截取标题</span></span><br><span class="line">        <span class="keyword">var</span> title = <span class="variable language_">document</span>.<span class="property">title</span>; <span class="comment">//获取的title结尾会有字符&quot;| 你的站点名&quot;</span></span><br><span class="line">        <span class="keyword">var</span> subTitle = title.<span class="title function_">endsWith</span>(<span class="string">&quot;| x1ang&quot;</span>) ? title.<span class="title function_">substring</span>(<span class="number">0</span>, title.<span class="property">length</span> - <span class="number">7</span>) : title;修改</span><br><span class="line">        navigator.<span class="property">clipboard</span>.<span class="title function_">writeText</span>(<span class="string">&#x27;x1ang的站内分享\n标题：&#x27;</span> + subTitle + <span class="string">&#x27;\n链接：&#x27;</span> + url + <span class="string">&#x27;\n欢迎来访！🍭🍭🍭&#x27;</span>); <span class="comment">// 复制内容</span></span><br><span class="line">        <span class="title function_">showToast</span>(<span class="string">&#x27;本页链接已复制到剪切板~&#x27;</span>, <span class="number">2000</span>); <span class="comment">// 通知</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;复制失败！&#x27;</span>, err);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在<code>_config.butterfly.yml</code>中引入<code>ClipboardJS</code>依赖和<code>page-share</code>文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># ClipboardJS依赖</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">defer</span> <span class="string">src=&quot;/static/js/page-share.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># 分享本页</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="文章统计图"><a href="#文章统计图" class="headerlink" title="文章统计图"></a>文章统计图</h2><p>参考：<a href="https://blog.eurkon.com/post/1213ef82.html">Hexo 博客文章统计图</a><br>博主只保留了其中<code>categories</code>的文章分类统计和<code>archives</code>的文章发布统计<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>安装模块</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cheerio --save</span><br></pre></td></tr></table></figure></li><li><p>导入文章统计代码</p><p>新建 <code>[ThemeRoot]\scripts\helpers\charts.js</code>文件，然后添加以下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&#x27;moment&#x27;</span>)</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">&#x27;after_render:html&#x27;</span>, <span class="keyword">function</span> (<span class="params">locals</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> $ = cheerio.<span class="title function_">load</span>(locals)</span><br><span class="line">  <span class="keyword">const</span> post = $(<span class="string">&#x27;#posts-chart&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> tag = $(<span class="string">&#x27;#tags-chart&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> category = $(<span class="string">&#x27;#categories-chart&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> htmlEncode = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (post.<span class="property">length</span> &gt; <span class="number">0</span> || tag.<span class="property">length</span> &gt; <span class="number">0</span> || category.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (post.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; $(<span class="string">&#x27;#postsChart&#x27;</span>).<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (post.<span class="title function_">attr</span>(<span class="string">&#x27;data-encode&#x27;</span>) === <span class="string">&#x27;true&#x27;</span>) htmlEncode = <span class="literal">true</span></span><br><span class="line">      post.<span class="title function_">after</span>(<span class="title function_">postsChart</span>(post.<span class="title function_">attr</span>(<span class="string">&#x27;data-start&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (tag.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; $(<span class="string">&#x27;#tagsChart&#x27;</span>).<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (tag.<span class="title function_">attr</span>(<span class="string">&#x27;data-encode&#x27;</span>) === <span class="string">&#x27;true&#x27;</span>) htmlEncode = <span class="literal">true</span></span><br><span class="line">      tag.<span class="title function_">after</span>(<span class="title function_">tagsChart</span>(tag.<span class="title function_">attr</span>(<span class="string">&#x27;data-length&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (category.<span class="property">length</span> &gt; <span class="number">0</span> &amp;&amp; $(<span class="string">&#x27;#categoriesChart&#x27;</span>).<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (category.<span class="title function_">attr</span>(<span class="string">&#x27;data-encode&#x27;</span>) === <span class="string">&#x27;true&#x27;</span>) htmlEncode = <span class="literal">true</span></span><br><span class="line">      category.<span class="title function_">after</span>(<span class="title function_">categoriesChart</span>(category.<span class="title function_">attr</span>(<span class="string">&#x27;data-parent&#x27;</span>)))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (htmlEncode) &#123;</span><br><span class="line">      <span class="keyword">return</span> $.<span class="title function_">root</span>().<span class="title function_">html</span>().<span class="title function_">replace</span>(<span class="regexp">/&amp;amp;#/g</span>, <span class="string">&#x27;&amp;#&#x27;</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> $.<span class="title function_">root</span>().<span class="title function_">html</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> locals</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">postsChart</span> (<span class="params">startMonth</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> startDate = <span class="title function_">moment</span>(startMonth || <span class="string">&#x27;2020-01&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> endDate = <span class="title function_">moment</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> monthMap = <span class="keyword">new</span> <span class="title class_">Map</span>()</span><br><span class="line">  <span class="keyword">const</span> dayTime = <span class="number">3600</span> * <span class="number">24</span> * <span class="number">1000</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> time = startDate; time &lt;= endDate; time += dayTime) &#123;</span><br><span class="line">    <span class="keyword">const</span> month = <span class="title function_">moment</span>(time).<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (!monthMap.<span class="title function_">has</span>(month)) &#123;</span><br><span class="line">      monthMap.<span class="title function_">set</span>(month, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  hexo.<span class="property">locals</span>.<span class="title function_">get</span>(<span class="string">&#x27;posts&#x27;</span>).<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">post</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> month = post.<span class="property">date</span>.<span class="title function_">format</span>(<span class="string">&#x27;YYYY-MM&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (monthMap.<span class="title function_">has</span>(month)) &#123;</span><br><span class="line">      monthMap.<span class="title function_">set</span>(month, monthMap.<span class="title function_">get</span>(month) + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">const</span> monthArr = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([...monthMap.<span class="title function_">keys</span>()])</span><br><span class="line">  <span class="keyword">const</span> monthValueArr = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>([...monthMap.<span class="title function_">values</span>()])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;script id=&quot;postsChart&quot;&gt;</span></span><br><span class="line"><span class="string">    var color = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ? &#x27;#4c4948&#x27; : &#x27;rgba(255,255,255,0.7)&#x27;</span></span><br><span class="line"><span class="string">    var postsChart = echarts.init(document.getElementById(&#x27;posts-chart&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">    var postsOption = &#123;</span></span><br><span class="line"><span class="string">      title: &#123;</span></span><br><span class="line"><span class="string">        text: &#x27;文章发布统计图&#x27;,</span></span><br><span class="line"><span class="string">        x: &#x27;center&#x27;,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      tooltip: &#123;</span></span><br><span class="line"><span class="string">        trigger: &#x27;axis&#x27;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      xAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;日期&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;category&#x27;,</span></span><br><span class="line"><span class="string">        boundaryGap: false,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;monthArr&#125;</span></span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      yAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;value&#x27;,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        splitLine: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      series: [&#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;line&#x27;,</span></span><br><span class="line"><span class="string">        smooth: true,</span></span><br><span class="line"><span class="string">        lineStyle: &#123;</span></span><br><span class="line"><span class="string">            width: 0</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        showSymbol: false,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          opacity: 1,</span></span><br><span class="line"><span class="string">          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">            offset: 0,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(128, 255, 165)&#x27;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            offset: 1,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(1, 191, 236)&#x27;</span></span><br><span class="line"><span class="string">          &#125;])</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        areaStyle: &#123;</span></span><br><span class="line"><span class="string">          opacity: 1,</span></span><br><span class="line"><span class="string">          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">            offset: 0,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(128, 255, 165)&#x27;</span></span><br><span class="line"><span class="string">          &#125;, &#123;</span></span><br><span class="line"><span class="string">            offset: 1,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(1, 191, 236)&#x27;</span></span><br><span class="line"><span class="string">          &#125;])</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;monthValueArr&#125;</span>,</span></span><br><span class="line"><span class="string">        markLine: &#123;</span></span><br><span class="line"><span class="string">          data: [&#123;</span></span><br><span class="line"><span class="string">            name: &#x27;平均值&#x27;,</span></span><br><span class="line"><span class="string">            type: &#x27;average&#x27;,</span></span><br><span class="line"><span class="string">            label: &#123;</span></span><br><span class="line"><span class="string">              color: color</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;]</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    postsChart.setOption(postsOption);</span></span><br><span class="line"><span class="string">    window.addEventListener(&#x27;resize&#x27;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">      postsChart.resize();</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    postsChart.on(&#x27;click&#x27;, &#x27;series&#x27;, (event) =&gt; &#123;</span></span><br><span class="line"><span class="string">      if (event.componentType === &#x27;series&#x27;) window.location.href = &#x27;/archives/&#x27; + event.name.replace(&#x27;-&#x27;, &#x27;/&#x27;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tagsChart</span> (<span class="params">len</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> tagArr = []</span><br><span class="line">  hexo.<span class="property">locals</span>.<span class="title function_">get</span>(<span class="string">&#x27;tags&#x27;</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">tag</span>) &#123;</span><br><span class="line">    tagArr.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: tag.<span class="property">name</span>, <span class="attr">value</span>: tag.<span class="property">length</span>, <span class="attr">path</span>: tag.<span class="property">path</span> &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  tagArr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123; <span class="keyword">return</span> b.<span class="property">value</span> - a.<span class="property">value</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> dataLength = <span class="title class_">Math</span>.<span class="title function_">min</span>(tagArr.<span class="property">length</span>, len) || tagArr.<span class="property">length</span></span><br><span class="line">  <span class="keyword">const</span> tagNameArr = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dataLength; i++) &#123;</span><br><span class="line">    tagNameArr.<span class="title function_">push</span>(tagArr[i].<span class="property">name</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> tagNameArrJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tagNameArr)</span><br><span class="line">  <span class="keyword">const</span> tagArrJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(tagArr)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;script id=&quot;tagsChart&quot;&gt;</span></span><br><span class="line"><span class="string">    var color = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ? &#x27;#4c4948&#x27; : &#x27;rgba(255,255,255,0.7)&#x27;</span></span><br><span class="line"><span class="string">    var tagsChart = echarts.init(document.getElementById(&#x27;tags-chart&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">    var tagsOption = &#123;</span></span><br><span class="line"><span class="string">      title: &#123;</span></span><br><span class="line"><span class="string">        text: &#x27;Top <span class="subst">$&#123;dataLength&#125;</span> 标签统计图&#x27;,</span></span><br><span class="line"><span class="string">        x: &#x27;center&#x27;,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      tooltip: &#123;&#125;,</span></span><br><span class="line"><span class="string">      xAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;标签&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;category&#x27;,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color,</span></span><br><span class="line"><span class="string">          interval: 0</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;tagNameArrJson&#125;</span></span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      yAxis: &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;value&#x27;,</span></span><br><span class="line"><span class="string">        splitLine: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        nameTextStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisTick: &#123;</span></span><br><span class="line"><span class="string">          show: false</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLabel: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        axisLine: &#123;</span></span><br><span class="line"><span class="string">          show: true,</span></span><br><span class="line"><span class="string">          lineStyle: &#123;</span></span><br><span class="line"><span class="string">            color: color</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      series: [&#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;bar&#x27;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;tagArrJson&#125;</span>,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          borderRadius: [5, 5, 0, 0],</span></span><br><span class="line"><span class="string">          color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">            offset: 0,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(128, 255, 165)&#x27;</span></span><br><span class="line"><span class="string">          &#125;,</span></span><br><span class="line"><span class="string">          &#123;</span></span><br><span class="line"><span class="string">            offset: 1,</span></span><br><span class="line"><span class="string">            color: &#x27;rgba(1, 191, 236)&#x27;</span></span><br><span class="line"><span class="string">          &#125;])</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        emphasis: &#123;</span></span><br><span class="line"><span class="string">          itemStyle: &#123;</span></span><br><span class="line"><span class="string">            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [&#123;</span></span><br><span class="line"><span class="string">              offset: 0,</span></span><br><span class="line"><span class="string">              color: &#x27;rgba(128, 255, 195)&#x27;</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">              offset: 1,</span></span><br><span class="line"><span class="string">              color: &#x27;rgba(1, 211, 255)&#x27;</span></span><br><span class="line"><span class="string">            &#125;])</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        markLine: &#123;</span></span><br><span class="line"><span class="string">          data: [&#123;</span></span><br><span class="line"><span class="string">            name: &#x27;平均值&#x27;,</span></span><br><span class="line"><span class="string">            type: &#x27;average&#x27;,</span></span><br><span class="line"><span class="string">            label: &#123;</span></span><br><span class="line"><span class="string">              color: color</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;]</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    tagsChart.setOption(tagsOption);</span></span><br><span class="line"><span class="string">    window.addEventListener(&#x27;resize&#x27;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">      tagsChart.resize();</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    tagsChart.on(&#x27;click&#x27;, &#x27;series&#x27;, (event) =&gt; &#123;</span></span><br><span class="line"><span class="string">      if(event.data.path) window.location.href = &#x27;/&#x27; + event.data.path;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">categoriesChart</span> (<span class="params">dataParent</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> categoryArr = []</span><br><span class="line">  <span class="keyword">let</span> categoryParentFlag = <span class="literal">false</span></span><br><span class="line">  hexo.<span class="property">locals</span>.<span class="title function_">get</span>(<span class="string">&#x27;categories&#x27;</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">category</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (category.<span class="property">parent</span>) categoryParentFlag = <span class="literal">true</span></span><br><span class="line">    categoryArr.<span class="title function_">push</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: category.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">value</span>: category.<span class="property">length</span>,</span><br><span class="line">      <span class="attr">path</span>: category.<span class="property">path</span>,</span><br><span class="line">      <span class="attr">id</span>: category.<span class="property">_id</span>,</span><br><span class="line">      <span class="attr">parentId</span>: category.<span class="property">parent</span> || <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  categoryParentFlag = categoryParentFlag &amp;&amp; dataParent === <span class="string">&#x27;true&#x27;</span></span><br><span class="line">  categoryArr.<span class="title function_">sort</span>(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123; <span class="keyword">return</span> b.<span class="property">value</span> - a.<span class="property">value</span> &#125;)</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">translateListToTree</span> (<span class="params">data, parent</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> tree = []</span><br><span class="line">    <span class="keyword">let</span> temp</span><br><span class="line">    data.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (data[index].<span class="property">parentId</span> == parent) &#123;</span><br><span class="line">        <span class="keyword">let</span> obj = data[index];</span><br><span class="line">        temp = <span class="title function_">translateListToTree</span>(data, data[index].<span class="property">id</span>);</span><br><span class="line">        <span class="keyword">if</span> (temp.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          obj.<span class="property">children</span> = temp</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tree.<span class="title function_">indexOf</span>())</span><br><span class="line">          tree.<span class="title function_">push</span>(obj)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> tree</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> categoryNameJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(categoryArr.<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">category</span>) &#123; <span class="keyword">return</span> category.<span class="property">name</span> &#125;))</span><br><span class="line">  <span class="keyword">const</span> categoryArrJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(categoryArr)</span><br><span class="line">  <span class="keyword">const</span> categoryArrParentJson = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="title function_">translateListToTree</span>(categoryArr, <span class="string">&#x27;0&#x27;</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`</span></span><br><span class="line"><span class="string">  &lt;script id=&quot;categoriesChart&quot;&gt;</span></span><br><span class="line"><span class="string">    var color = document.documentElement.getAttribute(&#x27;data-theme&#x27;) === &#x27;light&#x27; ? &#x27;#4c4948&#x27; : &#x27;rgba(255,255,255,0.7)&#x27;</span></span><br><span class="line"><span class="string">    var categoriesChart = echarts.init(document.getElementById(&#x27;categories-chart&#x27;), &#x27;light&#x27;);</span></span><br><span class="line"><span class="string">    var categoryParentFlag = <span class="subst">$&#123;categoryParentFlag&#125;</span></span></span><br><span class="line"><span class="string">    var categoriesOption = &#123;</span></span><br><span class="line"><span class="string">      title: &#123;</span></span><br><span class="line"><span class="string">        text: &#x27;文章分类统计图&#x27;,</span></span><br><span class="line"><span class="string">        x: &#x27;center&#x27;,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      legend: &#123;</span></span><br><span class="line"><span class="string">        top: &#x27;bottom&#x27;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;categoryNameJson&#125;</span>,</span></span><br><span class="line"><span class="string">        textStyle: &#123;</span></span><br><span class="line"><span class="string">          color: color</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      tooltip: &#123;</span></span><br><span class="line"><span class="string">        trigger: &#x27;item&#x27;</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      series: []</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    categoriesOption.series.push(</span></span><br><span class="line"><span class="string">      categoryParentFlag ? </span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        nodeClick :false,</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;sunburst&#x27;,</span></span><br><span class="line"><span class="string">        radius: [&#x27;15%&#x27;, &#x27;90%&#x27;],</span></span><br><span class="line"><span class="string">        center: [&#x27;50%&#x27;, &#x27;55%&#x27;],</span></span><br><span class="line"><span class="string">        sort: &#x27;desc&#x27;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;categoryArrParentJson&#125;</span>,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          borderColor: &#x27;#fff&#x27;,</span></span><br><span class="line"><span class="string">          borderWidth: 2,</span></span><br><span class="line"><span class="string">          emphasis: &#123;</span></span><br><span class="line"><span class="string">            focus: &#x27;ancestor&#x27;,</span></span><br><span class="line"><span class="string">            shadowBlur: 10,</span></span><br><span class="line"><span class="string">            shadowOffsetX: 0,</span></span><br><span class="line"><span class="string">            shadowColor: &#x27;rgba(255, 255, 255, 0.5)&#x27;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      :</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        name: &#x27;文章篇数&#x27;,</span></span><br><span class="line"><span class="string">        type: &#x27;pie&#x27;,</span></span><br><span class="line"><span class="string">        radius: [30, 80],</span></span><br><span class="line"><span class="string">        roseType: &#x27;area&#x27;,</span></span><br><span class="line"><span class="string">        label: &#123;</span></span><br><span class="line"><span class="string">          color: color,</span></span><br><span class="line"><span class="string">          formatter: &#x27;&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&#x27;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        data: <span class="subst">$&#123;categoryArrJson&#125;</span>,</span></span><br><span class="line"><span class="string">        itemStyle: &#123;</span></span><br><span class="line"><span class="string">          emphasis: &#123;</span></span><br><span class="line"><span class="string">            shadowBlur: 10,</span></span><br><span class="line"><span class="string">            shadowOffsetX: 0,</span></span><br><span class="line"><span class="string">            shadowColor: &#x27;rgba(255, 255, 255, 0.5)&#x27;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    )</span></span><br><span class="line"><span class="string">    categoriesChart.setOption(categoriesOption);</span></span><br><span class="line"><span class="string">    window.addEventListener(&#x27;resize&#x27;, () =&gt; &#123; </span></span><br><span class="line"><span class="string">      categoriesChart.resize();</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    categoriesChart.on(&#x27;click&#x27;, &#x27;series&#x27;, (event) =&gt; &#123;</span></span><br><span class="line"><span class="string">      if(event.data.path) window.location.href = &#x27;/&#x27; + event.data.path;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">  &lt;/script&gt;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>categories</code>页面添加统计图</p><p>注意：一定要注释掉<code>type: categories</code>如果想保留分类页面原功能，参考完整教程</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 分类</span><br><span class="line">date: 2025-07-31 15:59:03</span><br><span class="line"><span class="section"># type: categories</span></span><br><span class="line">---</span><br><span class="line">&lt;!-- 引入echarts.js --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;!-- 文章分类统计图 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;categories-chart&quot;</span> <span class="attr">data-parent</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 320px; padding: 10px;&quot;</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li><li><p><code>archives</code>页面添加统计图</p><p>修改<code>[ThemeRoot]\layout\archive.pug</code>，如下：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -5,4 +5,8 @@</span></span><br><span class="line">  block content</span><br><span class="line">    include ./includes/mixins/article-sort.pug</span><br><span class="line">    #archive</span><br><span class="line"><span class="addition">+     &lt;!-- 引入echarts.js --&gt;</span></span><br><span class="line"><span class="addition">+     &lt;script src=&quot;https://npm.elemecdn.com/echarts@4.9.0/dist/echarts.min.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="addition">+     &lt;!-- 文章发布时间统计图 --&gt;</span></span><br><span class="line"><span class="addition">+     &lt;div id=&quot;posts-chart&quot; data-start=&quot;2024-09&quot; style=&quot;border-radius: 8px; height: 320px; padding: 5px;&quot;&gt;&lt;/div&gt;</span></span><br><span class="line">      .article-sort-title= `$&#123;_p(&#x27;page.articles&#x27;)&#125; - $&#123;getArchiveLength()&#125;`</span><br></pre></td></tr></table></figure></li><li><p><code>pjax</code>适配<br>修改<code>[ThemeRoot]/layout/includes/third-party/pjax.pug</code>如下：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -1,6 +1,6 @@</span></span><br><span class="line"> - var pjaxExclude = &#x27;a:not([target=&quot;_blank&quot;])&#x27;</span><br><span class="line"> if theme.pjax.exclude</span><br><span class="line">   each val in theme.pjax.exclude</span><br><span class="line">     - pjaxExclude += `:not([href=&quot;$&#123;val&#125;&quot;])`</span><br><span class="line"></span><br><span class="line"><span class="deletion">- - let pjaxSelectors = [&#x27;head &gt; title&#x27;, &#x27;#config-diff&#x27;, &#x27;#body-wrap&#x27;, &#x27;#rightside-config-hide&#x27;, &#x27;#rightside-config-show&#x27;, &#x27;.js-pjax&#x27;]</span></span><br><span class="line"><span class="addition">+ - let pjaxSelectors = [&#x27;head &gt; title&#x27;, &#x27;#config-diff&#x27;, &#x27;#body-wrap&#x27;, &#x27;#rightside-config-hide&#x27;, &#x27;#rightside-config-show&#x27;, &#x27;.js-pjax&#x27;, &#x27;#posts-chart&#x27;, &#x27;#categories-chart&#x27;]</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="昼夜切换动画"><a href="#昼夜切换动画" class="headerlink" title="昼夜切换动画"></a>昼夜切换动画</h2><p>参考：<a href="https://www.fomal.cc/posts/d739261b.html">博客魔改教程总结(四) | Fomalhaut🥝</a><br><strong>前置条件</strong>：diy页面通知样式<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>新建<code>[ThemeRoot]\layout\includes\sun_moon.pug</code>，复制如下代码：</p><p>这部分是用Pug模板语法定义的SVG图标，包含太阳（#icon-sun）和月亮（#icon-moon）。通过js控制这两个图标的旋转、显隐和透明度变化，实现日夜切换的动画效果。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">svg(aria-hidden=&#x27;true&#x27;, style=&#x27;position:absolute; overflow:hidden; width:0; height:0&#x27;)</span><br><span class="line">  symbol#icon-sun(viewBox=&#x27;0 0 1024 1024&#x27;)</span><br><span class="line">    path(d=&#x27;M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z&#x27;, fill=&#x27;#FFD878&#x27;, p-id=&#x27;8420&#x27;)</span><br><span class="line">    path(d=&#x27;M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z&#x27;, fill=&#x27;#FFE4A9&#x27;, p-id=&#x27;8421&#x27;)</span><br><span class="line">    path(d=&#x27;M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z&#x27;, fill=&#x27;#4D5152&#x27;, p-id=&#x27;8422&#x27;)</span><br><span class="line">    path(d=&#x27;M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z&#x27;, fill=&#x27;#4D5152&#x27;, p-id=&#x27;8423&#x27;)</span><br><span class="line">  symbol#icon-moon(viewBox=&#x27;0 0 1024 1024&#x27;)</span><br><span class="line">    path(d=&#x27;M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z&#x27;, fill=&#x27;#FFB531&#x27;, p-id=&#x27;11345&#x27;)</span><br><span class="line">    path(d=&#x27;M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z&#x27;, fill=&#x27;#030835&#x27;, p-id=&#x27;11346&#x27;)</span><br></pre></td></tr></table></figure></li><li><p>新建<code>[ThemeRoot]\source\css\_layout\sun_moon.styl</code>，复制如下代码：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.Cuteen_DarkSky</span>,</span><br><span class="line"><span class="selector-class">.Cuteen_DarkSky</span><span class="selector-pseudo">:before</span></span><br><span class="line">  <span class="attribute">content</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attribute">position</span> fixed</span><br><span class="line">  <span class="attribute">left</span> <span class="number">0</span></span><br><span class="line">  <span class="attribute">right</span> <span class="number">0</span></span><br><span class="line">  <span class="attribute">top</span> <span class="number">0</span></span><br><span class="line">  <span class="attribute">bottom</span> <span class="number">0</span></span><br><span class="line">  <span class="attribute">z-index</span> <span class="number">88888888</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.Cuteen_DarkSky</span></span><br><span class="line">  <span class="attribute">background</span> <span class="built_in">linear-gradient</span>(to top, <span class="number">#f8cd71</span> <span class="number">0</span>, <span class="number">#5bfde9</span> <span class="number">80%</span>)</span><br><span class="line">  <span class="selector-pseudo">&amp;:before</span></span><br><span class="line">    <span class="attribute">transition</span> <span class="number">2s</span> ease all</span><br><span class="line">    <span class="attribute">opacity</span> <span class="number">0</span></span><br><span class="line">    <span class="attribute">background</span> <span class="built_in">linear-gradient</span>(to top, <span class="number">#30cfd0</span> <span class="number">0</span>, <span class="number">#330867</span> <span class="number">100%</span>)</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.DarkMode</span></span><br><span class="line">  <span class="selector-class">.Cuteen_DarkSky</span></span><br><span class="line">    <span class="selector-pseudo">&amp;:before</span></span><br><span class="line">      <span class="attribute">opacity</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.Cuteen_DarkPlanet</span></span><br><span class="line">  <span class="attribute">z-index</span> <span class="number">99999999</span></span><br><span class="line">  <span class="attribute">position</span> fixed</span><br><span class="line">  <span class="attribute">left</span> -<span class="number">50%</span></span><br><span class="line">  <span class="attribute">top</span> -<span class="number">50%</span></span><br><span class="line">  <span class="attribute">width</span> <span class="number">200%</span></span><br><span class="line">  <span class="attribute">height</span> <span class="number">200%</span></span><br><span class="line">  -webkit-<span class="attribute">animation</span> CuteenPlanetMove <span class="number">2s</span> <span class="built_in">cubic-bezier</span>(<span class="number">0.7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="attribute">animation</span> CuteenPlanetMove <span class="number">2s</span> <span class="built_in">cubic-bezier</span>(<span class="number">0.7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">  <span class="attribute">transform-origin</span> center bottom</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@-webkit-keyframes</span> CuteenPlanetMove &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  to &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> CuteenPlanetMove &#123;</span><br><span class="line">  <span class="number">0%</span> &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  to &#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.Cuteen_DarkPlanet</span></span><br><span class="line">  <span class="selector-id">#sun</span></span><br><span class="line">    <span class="attribute">position</span> absolute</span><br><span class="line">    <span class="attribute">border-radius</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">left</span> <span class="number">44%</span></span><br><span class="line">    <span class="attribute">top</span> <span class="number">30%</span></span><br><span class="line">    <span class="attribute">height</span> <span class="number">6rem</span></span><br><span class="line">    <span class="attribute">width</span> <span class="number">6rem</span></span><br><span class="line">    <span class="attribute">background</span> <span class="number">#ffee94</span></span><br><span class="line">    <span class="attribute">box-shadow</span> <span class="number">0</span> <span class="number">0</span> <span class="number">40px</span> <span class="number">#ffee94</span></span><br><span class="line">    <span class="comment">// opacity 0</span></span><br><span class="line"></span><br><span class="line">  <span class="selector-id">#moon</span></span><br><span class="line">    <span class="attribute">position</span> absolute</span><br><span class="line">    <span class="attribute">border-radius</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">left</span> <span class="number">44%</span></span><br><span class="line">    <span class="attribute">top</span> <span class="number">30%</span></span><br><span class="line">    <span class="attribute">position</span> absolute</span><br><span class="line">    <span class="attribute">border-radius</span> <span class="number">100%</span></span><br><span class="line">    <span class="attribute">height</span> <span class="number">6rem</span></span><br><span class="line">    <span class="attribute">width</span> <span class="number">6rem</span></span><br><span class="line">    <span class="attribute">box-shadow</span> -<span class="number">1.8em</span> <span class="number">1.8em</span> <span class="number">0</span> <span class="number">0.2em</span> <span class="number">#fff</span></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.search</span></span><br><span class="line">  <span class="selector-tag">span</span></span><br><span class="line">    <span class="attribute">display</span> none</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.menus_item</span></span><br><span class="line">  <span class="selector-tag">a</span></span><br><span class="line">    <span class="attribute">text-decoration</span> none<span class="meta">!important</span></span><br></pre></td></tr></table></figure></li><li><p>新建<code>[BlogRoot]\source\static\js\custom.js</code>，复制如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><p>定义了一个通知函数，后面也会有用到，所以单独建了一个文件管理</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ===========================================</span></span><br><span class="line"><span class="comment">   Toast 通知</span></span><br><span class="line"><span class="comment">   =========================================== */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Toast 通知 - 显示消息提示</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">message</span> - 消息内容</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">number</span>&#125; <span class="variable">duration</span> - 显示时长，默认2000ms</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 用法：</span></span><br><span class="line"><span class="comment"> * showToast(&#x27;操作成功！&#x27;);</span></span><br><span class="line"><span class="comment"> * showToast(&#x27;切换完成&#x27;, 2000);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showToast</span>(<span class="params">message, duration = <span class="number">2000</span></span>) &#123;</span><br><span class="line">    <span class="comment">// 检测当前主题</span></span><br><span class="line">    <span class="keyword">const</span> isDarkMode = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>) === <span class="string">&#x27;dark&#x27;</span> || </span><br><span class="line">                      <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;DarkMode&#x27;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建通知容器</span></span><br><span class="line">    <span class="keyword">let</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;toast-container&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!container) &#123;</span><br><span class="line">        container = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">        container.<span class="property">id</span> = <span class="string">&#x27;toast-container&#x27;</span>;</span><br><span class="line">        container.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">`</span></span><br><span class="line"><span class="string">            position: fixed;</span></span><br><span class="line"><span class="string">            top: 20px;</span></span><br><span class="line"><span class="string">            right: 20px;</span></span><br><span class="line"><span class="string">            z-index: 9999;</span></span><br><span class="line"><span class="string">            pointer-events: none;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(container);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建通知元素</span></span><br><span class="line">    <span class="keyword">const</span> toast = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    toast.<span class="property">innerHTML</span> = <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;span style=&quot;margin-right: 8px;&quot;&gt;😊&lt;/span&gt;</span></span><br><span class="line"><span class="string">        &lt;span&gt;<span class="subst">$&#123;message&#125;</span>&lt;/span&gt;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 根据主题设置样式</span></span><br><span class="line">    <span class="keyword">const</span> lightStyles = &#123;</span><br><span class="line">        <span class="attr">background</span>: <span class="string">&#x27;#f0f9ff&#x27;</span>,</span><br><span class="line">        <span class="attr">border</span>: <span class="string">&#x27;1px solid #bfdbfe&#x27;</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#1e293b&#x27;</span>,</span><br><span class="line">        <span class="attr">boxShadow</span>: <span class="string">&#x27;0 4px 12px rgba(0,0,0,0.15)&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> darkStyles = &#123;</span><br><span class="line">        <span class="attr">background</span>: <span class="string">&#x27;#1e293b&#x27;</span>,</span><br><span class="line">        <span class="attr">border</span>: <span class="string">&#x27;1px solid #475569&#x27;</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="string">&#x27;#e2e8f0&#x27;</span>,</span><br><span class="line">        <span class="attr">boxShadow</span>: <span class="string">&#x27;0 4px 12px rgba(0,0,0,0.4)&#x27;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> currentStyles = isDarkMode ? darkStyles : lightStyles;</span><br><span class="line">    </span><br><span class="line">    toast.<span class="property">style</span>.<span class="property">cssText</span> = <span class="string">`</span></span><br><span class="line"><span class="string">        display: flex;</span></span><br><span class="line"><span class="string">        align-items: center;</span></span><br><span class="line"><span class="string">        margin-bottom: 10px;</span></span><br><span class="line"><span class="string">        padding: 12px 16px;</span></span><br><span class="line"><span class="string">        background: <span class="subst">$&#123;currentStyles.background&#125;</span>;</span></span><br><span class="line"><span class="string">        border: <span class="subst">$&#123;currentStyles.border&#125;</span>;</span></span><br><span class="line"><span class="string">        color: <span class="subst">$&#123;currentStyles.color&#125;</span>;</span></span><br><span class="line"><span class="string">        border-radius: 8px;</span></span><br><span class="line"><span class="string">        box-shadow: <span class="subst">$&#123;currentStyles.boxShadow&#125;</span>;</span></span><br><span class="line"><span class="string">        transform: translateX(100%);</span></span><br><span class="line"><span class="string">        transition: all 0.3s ease;</span></span><br><span class="line"><span class="string">        pointer-events: auto;</span></span><br><span class="line"><span class="string">        max-width: 320px;</span></span><br><span class="line"><span class="string">        word-break: break-word;</span></span><br><span class="line"><span class="string">        font-size: 14px;</span></span><br><span class="line"><span class="string">        line-height: 1.4;</span></span><br><span class="line"><span class="string">        cursor: pointer;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line"></span><br><span class="line">    container.<span class="title function_">appendChild</span>(toast);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进入动画</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateX(0)&#x27;</span>;</span><br><span class="line">    &#125;, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自动消失</span></span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateX(100%)&#x27;</span>;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (toast.<span class="property">parentNode</span>) &#123;</span><br><span class="line">                toast.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(toast);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">300</span>);</span><br><span class="line">    &#125;, duration);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 点击关闭</span></span><br><span class="line">    toast.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">transform</span> = <span class="string">&#x27;translateX(100%)&#x27;</span>;</span><br><span class="line">        toast.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (toast.<span class="property">parentNode</span>) &#123;</span><br><span class="line">                toast.<span class="property">parentNode</span>.<span class="title function_">removeChild</span>(toast);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">300</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建<code>[BlogRoot]\source\static\js\sun-moon.js</code>，复制如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存主题状态</span></span><br><span class="line"><span class="keyword">const</span> saveToLocal = &#123;</span><br><span class="line">    <span class="attr">set</span>: <span class="keyword">function</span>(<span class="params">key, value, expire</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (expire) &#123;</span><br><span class="line">            <span class="keyword">const</span> expireDate = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">            expireDate.<span class="title function_">setDate</span>(expireDate.<span class="title function_">getDate</span>() + expire);</span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">                <span class="attr">value</span>: value,</span><br><span class="line">                <span class="attr">expire</span>: expireDate.<span class="title function_">getTime</span>()</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">get</span>: <span class="keyword">function</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> item = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key);</span><br><span class="line">        <span class="keyword">if</span> (!item) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> data = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(item);</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">expire</span> &amp;&amp; <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() &gt; data.<span class="property">expire</span>) &#123;</span><br><span class="line">                <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> data.<span class="property">value</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">            <span class="keyword">return</span> item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">switchNightMode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="title function_">insertAdjacentHTML</span>(<span class="string">&#x27;beforeend&#x27;</span>, <span class="string">&#x27;&lt;div class=&quot;Cuteen_DarkSky&quot;&gt;&lt;div class=&quot;Cuteen_DarkPlanet&quot;&gt;&lt;div id=&quot;sun&quot;&gt;&lt;/div&gt;&lt;div id=&quot;moon&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&#x27;</span>),</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">contains</span>(<span class="string">&#x27;DarkMode&#x27;</span>) ? (<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;DarkMode&#x27;</span>), <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;isDark&#x27;</span>, <span class="string">&#x27;0&#x27;</span>), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-moon&#x27;</span>)) : (<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;DarkMode&#x27;</span>), <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;isDark&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-sun&#x27;</span>)),</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;Cuteen_DarkSky&#x27;</span>)[<span class="number">0</span>].<span class="property">style</span>.<span class="property">transition</span> = <span class="string">&#x27;opacity 3s&#x27;</span>;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;Cuteen_DarkSky&#x27;</span>)[<span class="number">0</span>].<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                        <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;Cuteen_DarkSky&#x27;</span>)[<span class="number">0</span>].<span class="title function_">remove</span>();</span><br><span class="line">                    &#125;, <span class="number">1e3</span>);</span><br><span class="line">                &#125;, <span class="number">2e3</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">const</span> nowMode = <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">getAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>) === <span class="string">&#x27;dark&#x27;</span> ? <span class="string">&#x27;dark&#x27;</span> : <span class="string">&#x27;light&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> (nowMode === <span class="string">&#x27;light&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// 先设置太阳月亮透明度</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sun&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;moon&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sun&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;moon&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">setAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>, <span class="string">&#x27;dark&#x27;</span>);</span><br><span class="line">        saveToLocal.<span class="title function_">set</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;dark&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="comment">// GLOBAL_CONFIG.Snackbar !== undefined &amp;&amp; btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-sun&#x27;</span>)</span><br><span class="line">        <span class="comment">// 延时弹窗提醒</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">showToast</span>(<span class="string">&quot;天黑请闭眼🌙&quot;</span>);</span><br><span class="line">        &#125;, <span class="number">2500</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 先设置太阳月亮透明度</span></span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sun&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;moon&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;sun&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;moon&quot;</span>).<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&quot;0&quot;</span>;</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">setAttribute</span>(<span class="string">&#x27;data-theme&#x27;</span>, <span class="string">&#x27;light&#x27;</span>);</span><br><span class="line">        saveToLocal.<span class="title function_">set</span>(<span class="string">&#x27;theme&#x27;</span>, <span class="string">&#x27;light&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;body&#x27;</span>).<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;DarkMode&#x27;</span>), <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;modeicon&#x27;</span>).<span class="title function_">setAttribute</span>(<span class="string">&#x27;xlink:href&#x27;</span>, <span class="string">&#x27;#icon-moon&#x27;</span>)</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">showToast</span>(<span class="string">&quot;天亮请睁眼🌞&quot;</span>);</span><br><span class="line">        &#125;, <span class="number">2500</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>修改<code>[ThemeRoot]\layout\includes\head.pug</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -75,3 +75,6 @@</span></span><br><span class="line"> include ./head/config_site.pug</span><br><span class="line"></span><br><span class="line"> !=fragment_cache(&#x27;injectHead&#x27;, function()&#123;return injectHtml(theme.inject.head)&#125;)</span><br><span class="line"><span class="addition">+</span></span><br><span class="line"><span class="addition">+// 日夜间模式切换动画</span></span><br><span class="line"><span class="addition">+include sun_moon.pug</span></span><br></pre></td></tr></table></figure></li><li><p>修改<code>[ThemeRoot]\layout\includes\rightside.pug</code>,把原本的昼夜切换按钮替换掉</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -13,4 +13,5 @@</span></span><br><span class="line">  when &#x27;darkmode&#x27;</span><br><span class="line">    if darkmode.enable &amp;&amp; darkmode.button</span><br><span class="line"><span class="deletion">-     button#darkmode(type=&quot;button&quot; title=_p(&#x27;rightside.night_mode_title&#x27;))</span></span><br><span class="line"><span class="deletion">-       i.fas.fa-adjust</span></span><br><span class="line"><span class="addition">+     a.icon-V.hidden(onclick=&#x27;switchNightMode()&#x27;,  title=_p(&#x27;rightside.night_mode_title&#x27;))</span></span><br><span class="line"><span class="addition">+       svg(width=&#x27;25&#x27;, height=&#x27;25&#x27;, viewBox=&#x27;0 0 1024 1024&#x27;)</span></span><br><span class="line"><span class="addition">+         use#modeicon(xlink:href=&#x27;#icon-moon&#x27;)</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="右键菜单"><a href="#右键菜单" class="headerlink" title="右键菜单"></a>右键菜单</h2><p>参考：<a href="https://www.fomal.cc/posts/d739261b.html">博客魔改教程总结(四) | Fomalhaut🥝</a><br><strong>前置条件</strong>：diy通知样式、昼夜切换动画<br>右键菜单中没有的功能，可以将其注释<br><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>              <ol><li><p>新建 <code>[ThemeRoot]\layout\includes\rightmenu.pug</code>，添加如下代码：<br>其中<code>关于博客</code>的<code>href</code>修改成你想跳转的页面</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#rightMenu.js-pjax</span><br><span class="line"> .rightMenu-group.rightMenu-small</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:window.history.back();&quot;)</span><br><span class="line">         i.fa.fa-arrow-left</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:window.history.forward();&quot;)</span><br><span class="line">         i.fa.fa-arrow-right</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:window.location.reload();&quot;)</span><br><span class="line">         i.fa.fa-refresh</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.scrollToTop();&quot;)</span><br><span class="line">         i.fa.fa-arrow-up</span><br><span class="line"> .rightMenu-group.rightMenu-line.hide#menu-text</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.copySelect();&quot;)</span><br><span class="line">         i.fa.fa-copy</span><br><span class="line">         span=&#x27;复制文本&#x27;</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:window.open(\&quot;https://www.google.com/search?q=\&quot;+window.getSelection().toString());window.location.reload();&quot;)</span><br><span class="line">         i.fa.fa-search</span><br><span class="line">         span=&#x27;谷歌搜索&#x27;</span><br><span class="line"> .rightMenu-group.rightMenu-line.hide#menu-too</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:window.open(window.getSelection().toString());window.location.reload();&quot;)</span><br><span class="line">         i.fa.fa-link</span><br><span class="line">         span=&#x27;转到链接&#x27;</span><br><span class="line"> .rightMenu-group.rightMenu-line.hide#menu-paste</span><br><span class="line">     a.rightMenu-item(href=&#x27;javascript:rmf.paste()&#x27;)</span><br><span class="line">         i.fa.fa-copy</span><br><span class="line">         span=&#x27;粘贴文本&#x27;</span><br><span class="line"> .rightMenu-group.rightMenu-line.hide#menu-post</span><br><span class="line">     a.rightMenu-item(href=&quot;#post-comment&quot;)</span><br><span class="line">         i.fas.fa-comment</span><br><span class="line">         span=&#x27;空降评论&#x27;</span><br><span class="line">     a.rightMenu-item.menu-link(href=&#x27;/categories/&#x27;)</span><br><span class="line">         i.fas.fa-folder-open</span><br><span class="line">         span=&#x27;文章分类&#x27;</span><br><span class="line">     a.rightMenu-item.menu-link(href=&#x27;/tags/&#x27;)</span><br><span class="line">         i.fas.fa-tags</span><br><span class="line">         span=&#x27;文章标签&#x27;</span><br><span class="line"> .rightMenu-group.rightMenu-line.hide#menu-to</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.openWithNewTab()&quot;)</span><br><span class="line">         i.fa.fa-window-restore</span><br><span class="line">         span=&#x27;新窗口打开&#x27;</span><br><span class="line">     a.rightMenu-item#menu-too(href=&quot;javascript:rmf.open()&quot;)</span><br><span class="line">         i.fa.fa-link</span><br><span class="line">         span=&#x27;转到链接&#x27;</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.copyLink()&quot;)</span><br><span class="line">         i.fa.fa-copy</span><br><span class="line">         span=&#x27;复制链接&#x27;</span><br><span class="line"> .rightMenu-group.rightMenu-line.hide#menu-img</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.saveAs()&quot;)</span><br><span class="line">         i.fa.fa-download</span><br><span class="line">         span=&#x27;保存图片&#x27;</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.openWithNewTab()&quot;)</span><br><span class="line">         i.fa.fa-window-restore</span><br><span class="line">         span=&#x27;在新窗口打开&#x27;</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.copyLink()&quot;)</span><br><span class="line">         i.fa.fa-copy</span><br><span class="line">         span=&#x27;复制图片链接&#x27;</span><br><span class="line"> .rightMenu-group.rightMenu-line</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.copyWordsLink()&quot;)</span><br><span class="line">         i.fa.fa-link</span><br><span class="line">         span=&#x27;复制地址&#x27;</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:switchNightMode();&quot;)</span><br><span class="line">         i.fa.fa-circle-half-stroke</span><br><span class="line">         span=&#x27;昼夜切换&#x27;</span><br><span class="line">     a.rightMenu-item(href=&quot;javascript:rmf.fullScreen();&quot;)</span><br><span class="line">         i.fas.fa-expand</span><br><span class="line">         span=&#x27;全屏切换&#x27;</span><br><span class="line">     a.rightMenu-item(href=&quot;/myself/&quot;)</span><br><span class="line">         i.fa.fa-info-circle</span><br><span class="line">         span=&#x27;关于我&#x27;</span><br></pre></td></tr></table></figure></li><li><p>修改<code>[ThemeRoot]/layout/includes/layout.pug</code>：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -36,2 +36,3 @@</span></span><br><span class="line">     include ./rightside.pug</span><br><span class="line"><span class="addition">+    !=partial(&#x27;includes/rightmenu&#x27;,&#123;&#125;, &#123;cache:true&#125;)</span></span><br><span class="line">     include ./additional-js.pug</span><br></pre></td></tr></table></figure></li><li><p>在<code>[BlogRoot]/source/static/css/custom.css</code>中添加如下代码，并在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 右键菜单 */</span></span><br><span class="line"><span class="selector-id">#rightMenu</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">  <span class="attribute">position</span>: fixed;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">160px</span>;</span><br><span class="line">  <span class="attribute">height</span>: fit-content;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">10%</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">10%</span>;</span><br><span class="line">    <span class="comment">/* 菜单面板背景色 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--card-bg);</span><br><span class="line">    <span class="comment">/* 菜单面板文字颜色 */</span></span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--font-color);</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">7px</span> <span class="number">6px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:nth-last-child</span>(<span class="number">1</span>)) &#123;</span><br><span class="line">  <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="built_in">var</span>(--font-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-class">.rightMenu-small</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">0.3s</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--font-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-class">.rightMenu-line</span> <span class="selector-class">.rightMenu-item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="comment">/* 鼠标悬浮选项颜色 */</span></span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--text-bg-hover);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span> <span class="selector-tag">i</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">5px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span> <span class="selector-class">.rightMenu-item</span> <span class="selector-tag">span</span> &#123;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-id">#rightMenu</span> <span class="selector-class">.rightMenu-group</span><span class="selector-class">.rightMenu-line</span> <span class="selector-class">.rightMenu-item</span> * &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.rightMenu-group</span><span class="selector-class">.hide</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建<code>[BlogRoot]/source/static/js/right-menu.js</code>，添加如下代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 切换右键模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">changeMouseMode</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;mouse&quot;</span>) == <span class="string">&quot;on&quot;</span>) &#123;</span><br><span class="line">        mouseMode = <span class="string">&quot;off&quot;</span>;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;mouse&quot;</span>, <span class="string">&quot;off&quot;</span>);</span><br><span class="line">        <span class="title function_">showToast</span>(<span class="string">&quot;鼠标右键已恢复系统样式！&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mouseMode = <span class="string">&quot;on&quot;</span>;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;mouse&quot;</span>, <span class="string">&quot;on&quot;</span>);</span><br><span class="line">        <span class="title function_">showToast</span>(<span class="string">&quot;鼠标右键已更换为特殊样式！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setMask</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//设置遮罩</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;rmMask&quot;</span>)[<span class="number">0</span>] != <span class="literal">undefined</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementsByClassName</span>(<span class="string">&quot;rmMask&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">    mask = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    mask.<span class="property">className</span> = <span class="string">&quot;rmMask&quot;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">width</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">height</span> = <span class="variable language_">window</span>.<span class="property">innerHeight</span> + <span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">background</span> = <span class="string">&#x27;#fff&#x27;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;.0&#x27;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;fixed&#x27;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">left</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    mask.<span class="property">style</span>.<span class="property">zIndex</span> = <span class="number">998</span>;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(mask);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;rightMenu&quot;</span>).<span class="property">style</span>.<span class="property">zIndex</span> = <span class="number">19198</span>;</span><br><span class="line">    <span class="keyword">return</span> mask;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">insertAtCursor</span>(<span class="params">myField, myValue</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//IE 浏览器</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">selection</span>) &#123;</span><br><span class="line">        myField.<span class="title function_">focus</span>();</span><br><span class="line">        sel = <span class="variable language_">document</span>.<span class="property">selection</span>.<span class="title function_">createRange</span>();</span><br><span class="line">        sel.<span class="property">text</span> = myValue;</span><br><span class="line">        sel.<span class="title function_">select</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//FireFox、Chrome等</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (myField.<span class="property">selectionStart</span> || myField.<span class="property">selectionStart</span> == <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> startPos = myField.<span class="property">selectionStart</span>;</span><br><span class="line">        <span class="keyword">var</span> endPos = myField.<span class="property">selectionEnd</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存滚动条</span></span><br><span class="line">        <span class="keyword">var</span> restoreTop = myField.<span class="property">scrollTop</span>;</span><br><span class="line">        myField.<span class="property">value</span> = myField.<span class="property">value</span>.<span class="title function_">substring</span>(<span class="number">0</span>, startPos) + myValue + myField.<span class="property">value</span>.<span class="title function_">substring</span>(endPos, myField.<span class="property">value</span>.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (restoreTop &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            myField.<span class="property">scrollTop</span> = restoreTop;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        myField.<span class="title function_">focus</span>();</span><br><span class="line">        myField.<span class="property">selectionStart</span> = startPos + myValue.<span class="property">length</span>;</span><br><span class="line">        myField.<span class="property">selectionEnd</span> = startPos + myValue.<span class="property">length</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        myField.<span class="property">value</span> += myValue;</span><br><span class="line">        myField.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rmf = &#123;&#125;;</span><br><span class="line">rmf.<span class="property">showRightMenu</span> = <span class="keyword">function</span> (<span class="params">isTrue, x = <span class="number">0</span>, y = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> $rightMenu = $(<span class="string">&#x27;#rightMenu&#x27;</span>);</span><br><span class="line">    $rightMenu.<span class="title function_">css</span>(<span class="string">&#x27;top&#x27;</span>, x + <span class="string">&#x27;px&#x27;</span>).<span class="title function_">css</span>(<span class="string">&#x27;left&#x27;</span>, y + <span class="string">&#x27;px&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isTrue) &#123;</span><br><span class="line">        $rightMenu.<span class="title function_">show</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $rightMenu.<span class="title function_">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rmf.<span class="property">copyWordsLink</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span></span><br><span class="line">    <span class="keyword">let</span> txa = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">    txa.<span class="property">value</span> = url;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(txa)</span><br><span class="line">    txa.<span class="title function_">select</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&quot;Copy&quot;</span>);</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(txa);</span><br><span class="line">&#125;</span><br><span class="line">rmf.<span class="property">switchReadMode</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> $body = <span class="variable language_">document</span>.<span class="property">body</span></span><br><span class="line">    $body.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&#x27;read-mode&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> newEle = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">    newEle.<span class="property">type</span> = <span class="string">&#x27;button&#x27;</span></span><br><span class="line">    newEle.<span class="property">className</span> = <span class="string">&#x27;fas fa-sign-out-alt exit-readmode&#x27;</span></span><br><span class="line">    $body.<span class="title function_">appendChild</span>(newEle)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">clickFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">        $body.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&#x27;read-mode&#x27;</span>)</span><br><span class="line">        newEle.<span class="title function_">remove</span>()</span><br><span class="line">        newEle.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;click&#x27;</span>, clickFn)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    newEle.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, clickFn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//复制选中文字</span></span><br><span class="line">rmf.<span class="property">copySelect</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&#x27;Copy&#x27;</span>, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//回到顶部</span></span><br><span class="line">rmf.<span class="property">scrollToTop</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 核心滚动功能</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> btf !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; btf.<span class="property">scrollToDest</span>) &#123;</span><br><span class="line">        btf.<span class="title function_">scrollToDest</span>(<span class="number">0</span>, <span class="number">500</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">behavior</span>: <span class="string">&#x27;smooth&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;touchmove&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">&#125;, &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">popupMenu</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">oncontextmenu</span> = <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">        <span class="comment">// if (event.ctrlKey) return true;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当关掉自定义右键时候直接返回</span></span><br><span class="line">        <span class="keyword">if</span> (mouseMode == <span class="string">&quot;off&quot;</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&#x27;.rightMenu-group.hide&#x27;</span>).<span class="title function_">hide</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getSelection</span>().<span class="title function_">toString</span>()) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#menu-text&#x27;</span>).<span class="title function_">show</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;post&#x27;</span>)) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#menu-post&#x27;</span>).<span class="title function_">show</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;page&#x27;</span>)) &#123;</span><br><span class="line">                $(<span class="string">&#x27;#menu-post&#x27;</span>).<span class="title function_">show</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> el = <span class="variable language_">window</span>.<span class="property">document</span>.<span class="property">body</span>;</span><br><span class="line">        el = event.<span class="property">target</span>;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="regexp">/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&amp;&#x27;\*\+,;=.]+$/</span></span><br><span class="line">        <span class="keyword">if</span> (a.<span class="title function_">test</span>(<span class="variable language_">window</span>.<span class="title function_">getSelection</span>().<span class="title function_">toString</span>()) &amp;&amp; el.<span class="property">tagName</span> != <span class="string">&quot;A&quot;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#menu-too&#x27;</span>).<span class="title function_">show</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (el.<span class="property">tagName</span> == <span class="string">&#x27;A&#x27;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#menu-to&#x27;</span>).<span class="title function_">show</span>()</span><br><span class="line">            rmf.<span class="property">open</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (el.<span class="property">href</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;http://&quot;</span>) == -<span class="number">1</span> &amp;&amp; el.<span class="property">href</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;https://&quot;</span>) == -<span class="number">1</span> || el.<span class="property">href</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;yisous.xyz&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    pjax.<span class="title function_">loadUrl</span>(el.<span class="property">href</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    location.<span class="property">href</span> = el.<span class="property">href</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            rmf.<span class="property">openWithNewTab</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="title function_">open</span>(el.<span class="property">href</span>);</span><br><span class="line">                <span class="comment">// window.location.reload();</span></span><br><span class="line">            &#125;</span><br><span class="line">            rmf.<span class="property">copyLink</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> url = el.<span class="property">href</span></span><br><span class="line">                <span class="keyword">let</span> txa = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">                txa.<span class="property">value</span> = url;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(txa)</span><br><span class="line">                txa.<span class="title function_">select</span>();</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&quot;Copy&quot;</span>);</span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(txa);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">tagName</span> == <span class="string">&#x27;IMG&#x27;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#menu-img&#x27;</span>).<span class="title function_">show</span>()</span><br><span class="line">            rmf.<span class="property">openWithNewTab</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="title function_">open</span>(el.<span class="property">src</span>);</span><br><span class="line">                <span class="comment">// window.location.reload();</span></span><br><span class="line">            &#125;</span><br><span class="line">            rmf.<span class="property">click</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                el.<span class="title function_">click</span>()</span><br><span class="line">            &#125;</span><br><span class="line">            rmf.<span class="property">copyLink</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> url = el.<span class="property">src</span></span><br><span class="line">                <span class="keyword">let</span> txa = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;textarea&quot;</span>);</span><br><span class="line">                txa.<span class="property">value</span> = url;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(txa)</span><br><span class="line">                txa.<span class="title function_">select</span>();</span><br><span class="line">                <span class="variable language_">document</span>.<span class="title function_">execCommand</span>(<span class="string">&quot;Copy&quot;</span>);</span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(txa);</span><br><span class="line">            &#125;</span><br><span class="line">            rmf.<span class="property">saveAs</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> a = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">                <span class="keyword">var</span> url = el.<span class="property">src</span>;</span><br><span class="line">                <span class="keyword">var</span> filename = url.<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>];</span><br><span class="line">                a.<span class="property">href</span> = url;</span><br><span class="line">                a.<span class="property">download</span> = filename;</span><br><span class="line">                a.<span class="title function_">click</span>();</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">revokeObjectURL</span>(url);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el.<span class="property">tagName</span> == <span class="string">&quot;TEXTAREA&quot;</span> || el.<span class="property">tagName</span> == <span class="string">&quot;INPUT&quot;</span>) &#123;</span><br><span class="line">            $(<span class="string">&#x27;#menu-paste&#x27;</span>).<span class="title function_">show</span>();</span><br><span class="line">            rmf.<span class="property">paste</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                navigator.<span class="property">permissions</span></span><br><span class="line">                    .<span class="title function_">query</span>(&#123;</span><br><span class="line">                        <span class="attr">name</span>: <span class="string">&#x27;clipboard-read&#x27;</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                    .<span class="title function_">then</span>(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (result.<span class="property">state</span> == <span class="string">&#x27;granted&#x27;</span> || result.<span class="property">state</span> == <span class="string">&#x27;prompt&#x27;</span>) &#123;</span><br><span class="line">                            <span class="comment">//读取剪贴板</span></span><br><span class="line">                            navigator.<span class="property">clipboard</span>.<span class="title function_">readText</span>().<span class="title function_">then</span>(<span class="function"><span class="params">text</span> =&gt;</span> &#123;</span><br><span class="line">                                <span class="variable language_">console</span>.<span class="title function_">log</span>(text)</span><br><span class="line">                                <span class="title function_">insertAtCursor</span>(el, text)</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="title class_">Snackbar</span>.<span class="title function_">show</span>(&#123;</span><br><span class="line">                                <span class="attr">text</span>: <span class="string">&#x27;请允许读取剪贴板！&#x27;</span>,</span><br><span class="line">                                <span class="attr">pos</span>: <span class="string">&#x27;top-center&#x27;</span>,</span><br><span class="line">                                <span class="attr">showAction</span>: <span class="literal">false</span>,</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> pageX = event.<span class="property">clientX</span> + <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">let</span> pageY = event.<span class="property">clientY</span>;</span><br><span class="line">        <span class="keyword">let</span> rmWidth = $(<span class="string">&#x27;#rightMenu&#x27;</span>).<span class="title function_">width</span>();</span><br><span class="line">        <span class="keyword">let</span> rmHeight = $(<span class="string">&#x27;#rightMenu&#x27;</span>).<span class="title function_">height</span>();</span><br><span class="line">        <span class="keyword">if</span> (pageX + rmWidth &gt; <span class="variable language_">window</span>.<span class="property">innerWidth</span>) &#123;</span><br><span class="line">            pageX -= rmWidth + <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pageY + rmHeight &gt; <span class="variable language_">window</span>.<span class="property">innerHeight</span>) &#123;</span><br><span class="line">            pageY -= pageY + rmHeight - <span class="variable language_">window</span>.<span class="property">innerHeight</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mask = <span class="title function_">setMask</span>();</span><br><span class="line">        <span class="comment">// 滚动消失的代码和阅读进度有冲突，因此放到readPercent.js里面了</span></span><br><span class="line">        $(<span class="string">&quot;.rightMenu-item&quot;</span>).<span class="title function_">click</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            $(<span class="string">&#x27;.rmMask&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;display: none&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        $(<span class="variable language_">window</span>).<span class="title function_">resize</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            rmf.<span class="title function_">showRightMenu</span>(<span class="literal">false</span>);</span><br><span class="line">            $(<span class="string">&#x27;.rmMask&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;display: none&#x27;</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        mask.<span class="property">onclick</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            $(<span class="string">&#x27;.rmMask&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;display: none&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        rmf.<span class="title function_">showRightMenu</span>(<span class="literal">true</span>, pageY, pageX);</span><br><span class="line">        $(<span class="string">&#x27;.rmMask&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&#x27;style&#x27;</span>, <span class="string">&#x27;display: flex&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        rmf.<span class="title function_">showRightMenu</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!(navigator.<span class="property">userAgent</span>.<span class="title function_">match</span>(<span class="regexp">/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i</span>))) &#123;</span><br><span class="line">    <span class="title function_">popupMenu</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> box = <span class="variable language_">document</span>.<span class="property">documentElement</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addLongtabListener</span>(<span class="params">target, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> timer = <span class="number">0</span> <span class="comment">// 初始化timer</span></span><br><span class="line"></span><br><span class="line">    target.<span class="property">ontouchstart</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        timer = <span class="number">0</span> <span class="comment">// 重置timer</span></span><br><span class="line">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">callback</span>();</span><br><span class="line">            timer = <span class="number">0</span></span><br><span class="line">        &#125;, <span class="number">380</span>) <span class="comment">// 超时器能成功执行，说明是长按</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    target.<span class="property">ontouchmove</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(timer) <span class="comment">// 如果来到这里，说明是滑动</span></span><br><span class="line">        timer = <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    target.<span class="property">ontouchend</span> = <span class="function">() =&gt;</span> &#123; <span class="comment">// 到这里如果timer有值，说明此触摸时间不足380ms，是点击</span></span><br><span class="line">        <span class="keyword">if</span> (timer) &#123;</span><br><span class="line">            <span class="built_in">clearTimeout</span>(timer)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">addLongtabListener</span>(box, popupMenu)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全屏</span></span><br><span class="line">rmf.<span class="property">fullScreen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">fullscreenElement</span>) <span class="variable language_">document</span>.<span class="title function_">exitFullscreen</span>();</span><br><span class="line">    <span class="keyword">else</span> <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">requestFullscreen</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 右键开关</span></span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;mouse&quot;</span>) == <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;mouse&quot;</span>, <span class="string">&quot;on&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> mouseMode = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;mouse&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>在<code>_config.butterfly.yml</code>的<code>inject</code>配置项中引入<code>right-menu.js</code>和<code>jQuery</code>依赖。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Inject</span></span><br><span class="line"><span class="comment"># Insert the code to head (before &#x27;&lt;/head&gt;&#x27; tag) and the bottom (before &#x27;&lt;/body&gt;&#x27; tag)</span></span><br><span class="line"><span class="attr">inject:</span></span><br><span class="line">  <span class="attr">bottom:</span></span><br><span class="line">    <span class="comment"># - &lt;script src=&quot;xxxx&quot;&gt;&lt;/script&gt;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">type=&quot;text/javascript&quot;</span> <span class="string">src=&quot;https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># 右键菜单依赖jQuery</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;script</span> <span class="string">type=&quot;text/javascript&quot;</span> <span class="string">src=&quot;/static/js/right-menu.js&quot;&gt;&lt;/script&gt;</span> <span class="comment"># diy右键菜单</span></span><br></pre></td></tr></table></figure></li><li><p>侧边栏右键开关</p><p>修改<code>[ThemeRoot]\layout\includes\rightside.pug</code></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@@ -30,4 +30,7 @@</span></span><br><span class="line">       when &#x27;comment&#x27;</span><br><span class="line">         if commentsJsLoad</span><br><span class="line">           a#to_comment(href=&quot;#post-comment&quot; title=_p(&quot;rightside.scroll_to_comment&quot;))</span><br><span class="line">             i.fas.fa-comments</span><br><span class="line"><span class="addition">+      when &#x27;mouse&#x27;</span></span><br><span class="line"><span class="addition">+        button.share(type=&quot;button&quot; title=&#x27;右键模式&#x27; onclick=&quot;changeMouseMode()&quot;)</span></span><br><span class="line"><span class="addition">+          i.fas.fa-mouse</span></span><br></pre></td></tr></table></figure><p>修改<code>_config.butterfly.yml</code>的<code>rightside_item_order</code>配置项：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Don&#x27;t modify the following settings unless you know how they work</span></span><br><span class="line"><span class="comment"># Choose: readmode,translate,darkmode,hideAside,toc,chat,comment</span></span><br><span class="line"><span class="comment"># Don&#x27;t repeat the same value</span></span><br><span class="line"><span class="attr">rightside_item_order:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Default: readmode,translate,darkmode,hideAside</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="string">readmode,translate,hideAside,mouse</span></span><br><span class="line">  <span class="comment"># Default: toc,chat,comment</span></span><br><span class="line">  <span class="attr">show:</span> <span class="string">toc,chat,comment,darkmode</span></span><br></pre></td></tr></table></figure></li></ol>              </div>            </details></p><h2 id="待定-1"><a href="#待定-1" class="headerlink" title="待定"></a>待定</h2><details class="folding-tag" gray><summary> 详细步骤 </summary>              <div class='content'>                            </div>            </details>]]></content>
      
      
      <categories>
          
          <category> 大冒险 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 魔改 </tag>
            
            <tag> 笔记 </tag>
            
            <tag> 插件 </tag>
            
            <tag> 博客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++查漏补缺</title>
      <link href="/2025/03/15/C-%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/"/>
      <url>/2025/03/15/C-%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="一、吸佳佳查漏补缺"><a href="#一、吸佳佳查漏补缺" class="headerlink" title="一、吸佳佳查漏补缺"></a>一、吸佳佳查漏补缺</h1><h2 id="编译器"><a href="#编译器" class="headerlink" title="编译器"></a>编译器</h2><h2 id="c-11"><a href="#c-11" class="headerlink" title="c++11"></a>c++11</h2><h3 id="移动语义"><a href="#移动语义" class="headerlink" title="移动语义"></a>移动语义</h3><p>它允许将一个对象的<strong>所有权</strong>从一个对象<strong>转移</strong>到另一个对象，而不需要进行数据的拷贝和搬迁。使程序在内存管理方面更加高效。</p><p>移动语义是通过右值引用来实现的，右值引用的语法是 <code>&amp;&amp;</code>，这是一种新的引用类型，用于表示<strong>即将销毁的对象</strong>。</p><p>但需要注意，使用<code>move</code>后原对象的状态是不确定的，不应再对其进行操作。</p><p>右值引用只能绑定到一个右值，不能绑定到一个左值。但是可以使用 <code>move</code> 函数将一个<strong>左值强制转换</strong>为右值引用，从而允许我们使用移动语义。</p><h5 id="左值和右值"><a href="#左值和右值" class="headerlink" title="左值和右值"></a>左值和右值</h5><ul><li>左值表示了一个占据内存中某个可识别的位置（也就是一个地址）的对象。（可寻址的对象）</li><li>右值则使用排除法来定义。是不可寻址的常量，或在表达式求值过程中创建的无名临时对象，短暂性的。</li></ul><h2 id="内存管理"><a href="#内存管理" class="headerlink" title="内存管理"></a>内存管理</h2><h4 id="内存分区"><a href="#内存分区" class="headerlink" title="内存分区"></a>内存分区</h4><p><strong>堆区</strong>：容量大于栈，由程序员管理，手动申请手动释放，程序中动态分配的内存在此区域</p><p><strong>栈区</strong>：由系统进行管理的区域。主要存放<strong>函数的参数</strong>以及<strong>局部变量</strong>。栈区的大小可以在编译器中由用户自行设定。</p><p><strong>文字常量区</strong>：储存常量字符串，文字常量区的内存是<strong>只读</strong>的。</p><p><strong>代码区</strong>：存放函数体的二进制代码。</p><p><strong>全局\静态区</strong>：储存<strong>全局变量</strong>和静态变量以及<strong>除了字符串</strong>以外的<strong>其他类型常量</strong>，其中<strong>被初始化</strong>的和<strong>未被初始化</strong>的又可以分为<strong>数据段</strong>和<strong>BSS</strong>。</p><h4 id="智能指针"><a href="#智能指针" class="headerlink" title="智能指针"></a>智能指针</h4><p>将分配的动态内存都交由有<strong>生命周期的对象</strong>来处理，那么在对象过期时，让它的析构函数删除指向的内存。</p><p>C++98 提供了 <code>auto_ptr</code> 模板的解决方案（<strong>已弃用</strong>）</p><p>C++11增加<code>unique_ptr</code>、<code>shared_ptr</code> 和<code>weak_ptr</code></p><h5 id="auto-ptr（已弃用）"><a href="#auto-ptr（已弃用）" class="headerlink" title="auto_ptr（已弃用）"></a>auto_ptr（<strong>已弃用</strong>）</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">auto_ptr&lt;Test&gt; <span class="title">test</span><span class="params">(<span class="keyword">new</span> Test)</span></span>;<span class="comment">// auto_ptr中重载了*和-&gt;，可以直接像普通指针一样使用</span></span><br></pre></td></tr></table></figure><p>auto_ptr 主要有三大问题：</p><p>复制和赋值会改变资源的所有权，不符合人的直觉。</p><p>在 STL 容器中使用<code>auto_ptr</code>存在重大风险，因为容器内的元素必需支持可复制（copy constructable）和可赋值（assignable）。</p><p>不支持对象数组的操作</p><h5 id="unique-ptr"><a href="#unique-ptr" class="headerlink" title="unique_ptr"></a>unique_ptr</h5><p>unique_ptr 和 auto_ptr用法几乎一样</p><h2 id="1、关键字"><a href="#1、关键字" class="headerlink" title="1、关键字"></a>1、关键字</h2><h5 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h5><p>内联函数<code>inline</code>（有时称作编译时期展开函数）是一种编程语言结构，用来<strong>建议</strong>编译器将指定的函数体插入并取代每一处调用该函数的地方，从而节省了每次调用函数带来的额外时间开支。类内部的函数一般会自动内联。</p><p>定义内联函数是一个空间代价换时间的操作，在现代处理器上，通常代码越小执行越快，因为指令缓存利用率高。</p><p>通常，编译器比程序设计者更清楚对于一个特定的函数是否合适进行内联扩展；一些情况下，对于程序员指定的某些内联函数，编译器可能更倾向于不使用内联甚至根本无法完成内联。</p><p><strong>c++17</strong>完全改变了<code>inline</code>的定义，从原来的优先内联改为<strong>容许多次定义</strong>，被<code>inline</code>修饰的函数会被定义成<strong>弱函数</strong>，会被其他普通函数覆盖。对于原本内联的功能<strong>完全交给编译器</strong>优化，较新的编译器启用优化模式，不管对于什么版本的c++标准都会自动决定函数的内联。</p><h5 id="new与malloc"><a href="#new与malloc" class="headerlink" title="new与malloc"></a>new与malloc</h5><p>malloc是C语言中的函数，而new是C++中的操作符</p><p>我的理解：new是malloc的超集，malloc只负责内存的分配，而new会确保了对象在创建时已经正确初始化。</p><ul><li>malloc申请之后返回的类型是void*，而new返回的指针带有类型。</li><li>malloc只负责内存的分配而不会调用类的构造函数，而new不仅会分配内存，而且会自动调用类的构造函数。</li></ul><h5 id="const-与-constexpr"><a href="#const-与-constexpr" class="headerlink" title="const 与 constexpr"></a>const 与 constexpr</h5><p><code>const</code> 修饰的变量只能读取，一旦被初始化就无法修改，可以在运行期间计算得出</p><p><code>constexpr</code> 修饰的对象必须是常量，即必须是编译期间可以计算出来的</p><p><code>constexpr</code>是C++11引入的，一方面是为了引入更多的编译时计算能力，另一方面也是解决 C++98 的 <code>const</code> 的双重语义问题。</p><p>在 C 里面，<code>const</code> 很明确只有<strong>「只读」</strong>一个语义，不会混淆。C++ 在此基础上增加了<strong>「常量」</strong>语义，也由 <code>const</code> 关键字来承担，引出来一些奇怪的问题。C++11 把<strong>「常量」</strong>语义拆出来，交给新引入的 <code>constexpr</code> 关键字。</p><p>例如在 C++ 标准中，只允许使用常量初始化数组，如<code>cin &gt;&gt; n; int arr2[n];</code> 其中 n 在程序运行中才确定，不属于常量。尽管在 C 语言的 C99 标准中支持了变长数组，使得很多编译器（如 GCC、Clang、G++）允许这种写法，但它是编译器扩展的特性，不符合 C++ 的标准行为。此时用 <code>const</code> 修饰的变量初始化数组可能会出现未知的问题。</p><p>注意：<code>constexpr</code> 并不强制要求函数在每个使用时都必须在编译时计算结果。它只是表示<strong>该函数可以在编译时求值</strong>，如果条件允许的话。</p><h5 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h5><p><code>volatile</code> 关键字是一种类型修饰符，用它声明的变量or对象表示可以被某些编译器未知的因素更改，比如：操作系统、硬件或者其它线程等。遇到这个关键字声</p><p>明的变量，编译器对访问该变量的代码就不再进行优化，从而可以提供对特殊地址的稳定访问。（<strong>被<code>volatile</code>修饰的变量或对象，不会被存入寄存器中，总是从内存中读取</strong>）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> a = i;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;i = %d&quot;</span>, a);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面汇编语句的作用就是改变内存中i的值为32，但是又不让编译器知道</span></span><br><span class="line">    __asm &#123;</span><br><span class="line">        mov dword ptr [ebp<span class="number">-4</span>], <span class="number">20</span>h</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> b = i;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;i = %d&quot;</span>, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">10</span></span><br><span class="line">i = <span class="number">32</span></span><br></pre></td></tr></table></figure><h4 id="1-1、储存类"><a href="#1-1、储存类" class="headerlink" title="1.1、储存类"></a>1.1、储存类</h4><p>用于定义 C++ 程序中变量/函数的范围（可见性）和生命周期。</p><h5 id="mutable"><a href="#mutable" class="headerlink" title="mutable"></a>mutable</h5><p><code>mutable</code> 用于修饰类的成员变量。被 mutable 修饰的成员变量可以被修改，即使它们所在的对象是 <code>const</code> 的。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_value</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value_; <span class="comment">// const 关键字表示该成员函数不会修改对象中的数据成员</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_value</span><span class="params">(<span class="type">int</span> value)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        value_ = value; <span class="comment">// mutable 关键字允许在 const 成员函数中修改成员变量</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">mutable</span> <span class="type">int</span> value_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="extern"><a href="#extern" class="headerlink" title="extern"></a>extern</h5><p>用于声明具有外部链接的变量或函数，它们可以在多个文件之间共享。默认情况下，全局变量和函数具有 <code>extern</code> 存储类。在一个文件中使用<code>extern</code>声明另一个文件中定义的全局变量或函数，可以实现<strong>跨文件共享</strong>。</p><h5 id="thread-local"><a href="#thread-local" class="headerlink" title="thread_local"></a>thread_local</h5><p>用于定义具有<strong>线程局部存储期</strong>的变量，每个线程都有自己的独立副本。线程局部变量的生命周期与线程的生命周期相同。</p><h5 id="static"><a href="#static" class="headerlink" title="static"></a>static</h5><p>用于定义静态变量或函数。静态变量或函数的性质：</p><p><strong>存储期</strong>：使用 <code>static</code> 修饰的变量在程序整个运行期间都存在，这意味着内存空间在程序启动时分配，直到程序结束才释放。现代编译器和链接器能对未被使用的静态变量进行优化。（<code>const</code>变量默认具有<code>static</code>存储期）</p><p><strong>链接性</strong>：<code>static</code> 修饰的变量或函数具有内部链接，只能在本文件中访问，避免了全局命名冲突。如果在头文件定义静态函数，被多个cpp调用，会生成多份函数代码。</p><h2 id="2、Lambda函数与表达"><a href="#2、Lambda函数与表达" class="headerlink" title="2、Lambda函数与表达"></a>2、Lambda函数与表达</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[capture](parameters)-&gt;return_type&#123;body&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[]      <span class="comment">// 沒有定义任何变量。使用未定义变量会引发错误。</span></span><br><span class="line">[x, &amp;y] <span class="comment">// x以传值方式传入（默认），y以引用方式传入。</span></span><br><span class="line">[&amp;]     <span class="comment">// 任何被使用到的外部变量都隐式地以引用方式加以引用。</span></span><br><span class="line">[=]     <span class="comment">// 任何被使用到的外部变量都隐式地以传值方式加以引用。</span></span><br><span class="line">[&amp;, x]  <span class="comment">// x显式地以传值方式加以引用。其余变量以引用方式加以引用。</span></span><br><span class="line">[=, &amp;z] <span class="comment">// z显式地以引用方式加以引用。其余变量以传值方式加以引用。</span></span><br></pre></td></tr></table></figure><p>另外有一点需要注意。对于[=]或[&amp;]的形式，lambda 表达式可以直接使用 this 指针。但是，对于[]的形式，如果要使用 this 指针，必须显式传入</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">this</span>]() &#123; <span class="keyword">this</span>-&gt;<span class="built_in">someFunc</span>(); &#125;();</span><br></pre></td></tr></table></figure><h2 id="3、随机数"><a href="#3、随机数" class="headerlink" title="3、随机数"></a>3、随机数</h2><h5 id="rand"><a href="#rand" class="headerlink" title="rand"></a>rand</h5><p><code>rand()</code> 函数包含在头文件 <code>&lt;cstdlib&gt;</code> 中，调用后会随机（伪随机）返回一个值域在0到<code>RAND_MAX</code>（保证均匀分布）的 <code>int</code> 变量</p><p>由于该函数使用的是<strong>线性同余方程</strong>生成随机数，所以<strong>循环节</strong>并不长，RAND_MAX一般为 <code>0x7fff</code>，即 <strong>32767</strong>（2^15−1）</p><p>在使用前需要先通过 <code>srand()</code> 函数设定随机数种子，通常采用时间作为种子。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Rand</span><span class="params">( <span class="type">int</span> x, <span class="type">int</span> y )</span><span class="comment">/* 获取一个在 [x,y] 范围中的随机数 */</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">rand</span>() % (y - x + <span class="number">1</span>) + x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">        <span class="built_in">srand</span>((<span class="type">unsigned</span>)<span class="built_in">time</span>(<span class="literal">NULL</span>));<span class="comment">// time(NULL) 是算法竞赛中最常用的种子之一,包含在头文件 &lt;ctime&gt; 中,缺点：一秒一变</span></span><br><span class="line">    <span class="built_in">srand</span>(chrono::system_clock::<span class="built_in">now</span>().<span class="built_in">time_since_epoch</span>().<span class="built_in">count</span>());<span class="comment">//精度可以达到纳秒包含在头文件chrono中</span></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>;i++ ) </span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="built_in">Rand</span>(<span class="number">1</span>,<span class="number">100</span>) &lt;&lt; endl; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="random-device"><a href="#random-device" class="headerlink" title="random_device"></a>random_device</h5><p><code>std::random_device</code> 是一种随机数生成器类型，在头文件 <code>&lt;random&gt;</code> 中，如果在 Linux 下调用会通过系统提供的一个系统噪音收集器来获取真随机数，在 Windows 下就会利用很多数据来计算熵，可以近似认为是真随机的。值域在 <strong>0 - 2^32 - 1</strong> 也就是 <code>unsigned int</code> 的值域范围</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">  random_device rd;</span><br><span class="line"></span><br><span class="line">  cout &lt;&lt; <span class="string">&quot;Random number: &quot;</span> &lt;&lt; <span class="built_in">rd</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="mt19937"><a href="#mt19937" class="headerlink" title="mt19937"></a>mt19937</h5><p>这个奇怪的名字来源于这个生成随机数的算法 <strong>Mersenne twister（梅森旋转算法）</strong>，至于其中的 1993719937 则是代表它生成的随机数的周期可以到达 <strong>2^19937−1</strong> 的惊人数量级，相比起 <code>rand()</code> 确实可以避免很多问题，而且 <code>mt19937</code> 几乎是最快的伪随机数生成器，效率非常高</p><p><code>std::mt19937</code> 是一个随机数生成器类型，在头文件 <code>&lt;random&gt;</code> 中，调用时其会返回一个 <code>unsigned int</code>，值域也在 <strong>0 - 2^32 - 1</strong>。</p><p>如果需要更大的值域范围可以使用 <code>std::mt19937_64</code>，唯一的区别就是返回值变成了一个 <code>unsigned long long</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * std::random_device rd;</span></span><br><span class="line"><span class="comment"> * std::mt19937 Rnd(rd());</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">std::mt19937 <span class="title">Rnd</span><span class="params">( std::random_device &#123;&#125; () )</span></span>; <span class="comment">// 这样写等价于上面注释掉的写法，种子为 random_device</span></span><br><span class="line">std::cout &lt;&lt; <span class="built_in">Rnd</span>() &lt;&lt; std::endl;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="shuffle"><a href="#shuffle" class="headerlink" title="shuffle"></a>shuffle</h5><p><code>std::shuffle()</code> 自 C++11 被引入，用于替代 <code>random_shuffle()</code>，在 <code>&lt;algorithm&gt;</code> 头文件中，它必须传入三个参数，前两个一样是容器的头尾迭代器，最后一个参数是随机数生成器</p><p>随机数生成器可以是 <code>std::random_device</code>，可以是 <code>std::mt19937</code>，也可以是 <code>std::default_random_engine</code>（同样 C++11 引入，用于替代 <code>rand()</code> 的随机数生成器，但是性能不及 <code>mt19937</code>，所以还是推荐 <code>mt19937</code>）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">std::mt19937 <span class="title">Rnd</span><span class="params">( std::random_device &#123;&#125; () )</span></span>;</span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">( &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125; )</span></span>;</span><br><span class="line">std::<span class="built_in">shuffle</span>( a.<span class="built_in">begin</span>(), a.<span class="built_in">end</span>(), Rnd );</span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">auto</span> x : a ) </span><br><span class="line">    &#123;</span><br><span class="line">std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>; <span class="comment">// 一种可能的输出：3 2 5 1 4     </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4、模板"><a href="#4、模板" class="headerlink" title="4、模板"></a>4、模板</h2><p>模板是泛型编程的基础，泛型编程即以一种独立于任何特定类型的方式编写代码。</p><p>模板是创建泛型类或函数的蓝图或公式。库容器，比如迭代器和算法，都是泛型编程的例子，它们都使用了模板的概念。</p><p>例如vector容器只有一个单一的定义，而形如<code>vector &lt;int&gt;</code>或 <code>vector &lt;string&gt;</code>等不同的类型的元素即是通过模板实现的。</p><h5 id="函数模板"><a href="#函数模板" class="headerlink" title="函数模板"></a>函数模板</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> type&gt; <span class="comment">// 在这里，type是函数所使用的数据类型的占位符名称。这个名称可以在函数定义中使用。</span></span><br><span class="line">ret-type func-<span class="built_in">name</span>(parameter list) </span><br><span class="line">&#123;   </span><br><span class="line"><span class="comment">// 函数的主体 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="类模板"><a href="#类模板" class="headerlink" title="类模板"></a>类模板</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">type</span>&gt; <span class="comment">// type可以在类被实例化的时候进行指定。可以使用一个逗号分隔的列表来定义多个泛型数据类型。</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">class</span>-name </span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// 类的主体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h6><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数模板的实例，返回两个数中的最大值，输入可以是int、double、string类型</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> T <span class="type">const</span>&amp; <span class="title">Max</span> <span class="params">(T <span class="type">const</span>&amp; a, T <span class="type">const</span>&amp; b)</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="keyword">return</span> a &lt; b ? b:a; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 类模板实例，Stack&lt;&gt;，实现了泛型方法来对元素进行入栈出栈操作</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123; </span><br><span class="line">  <span class="keyword">private</span>: </span><br><span class="line">    vector&lt;T&gt; elems;          <span class="comment">// 元素 </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">public</span>: </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(T <span class="type">const</span>&amp;)</span></span>;    <span class="comment">// 入栈</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pop</span><span class="params">()</span></span>;               <span class="comment">// 出栈</span></span><br><span class="line">    <span class="function">T <span class="title">top</span><span class="params">()</span> <span class="type">const</span></span>;            <span class="comment">// 返回栈顶元素</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span> <span class="type">const</span></span>&#123;       <span class="comment">// 如果为空则返回真。</span></span><br><span class="line">        <span class="keyword">return</span> elems.<span class="built_in">empty</span>(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> Stack&lt;T&gt;::<span class="built_in">push</span> (T <span class="type">const</span>&amp; elem) </span><br><span class="line">&#123; </span><br><span class="line">    <span class="comment">// 追加传入元素的副本</span></span><br><span class="line">    elems.<span class="built_in">push_back</span>(elem);    </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">......省去其余函数实现</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">    <span class="type">int</span> i = <span class="number">20</span>, j = <span class="number">30</span>;</span><br><span class="line">    string s1 = <span class="string">&quot;hello&quot;</span>, s2 = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Max(i, j): &quot;</span> &lt;&lt; <span class="built_in">Max</span>(i, j) &lt;&lt; endl; </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Max(s1, s2): &quot;</span> &lt;&lt; <span class="built_in">Max</span>(s1, s2) &lt;&lt; endl; </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    Stack&lt;<span class="type">int</span>&gt;         intStack; <span class="comment">// int 类型的栈 </span></span><br><span class="line">    Stack&lt;string&gt;   stringStack; <span class="comment">// string 类型的栈 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 操作 int 类型的栈 </span></span><br><span class="line">    intStack.<span class="built_in">push</span>(<span class="number">7</span>); </span><br><span class="line">    <span class="comment">// 操作 string 类型的栈 </span></span><br><span class="line">    stringStack.<span class="built_in">push</span>(<span class="string">&quot;hello&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6、数据结构"><a href="#6、数据结构" class="headerlink" title="6、数据结构"></a>6、数据结构</h2><h5 id="链表（Linked-List）"><a href="#链表（Linked-List）" class="headerlink" title="链表（Linked List）"></a><strong>链表（Linked List）</strong></h5><p>链表是一种动态数据结构，由一系列节点组成，每个节点包含数据和指向下一个节点的指针。</p><ul><li>动态调整大小，不需要提前定义容量。</li><li>插入和删除操作效率高，时间复杂度为 O(1)（在链表头部或尾部操作）。</li><li>线性查找，时间复杂度为 O(n)。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    Node* next;</span><br><span class="line">&#125;;</span><br><span class="line">Node* head = <span class="literal">nullptr</span>;</span><br><span class="line">Node* newNode = <span class="keyword">new</span> Node&#123;<span class="number">10</span>, <span class="literal">nullptr</span>&#125;;</span><br><span class="line">head = newNode; <span class="comment">// 插入新节点</span></span><br></pre></td></tr></table></figure><h5 id="栈（Stack）"><a href="#栈（Stack）" class="headerlink" title="栈（Stack）"></a><strong>栈（Stack）</strong></h5><p>栈是一种后进先出（LIFO, Last In First Out）的数据结构，常用于递归、深度优先搜索等场景。</p><ul><li>只允许在栈顶进行插入和删除操作。</li><li>时间复杂度为 O(1)。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">s.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">s.<span class="built_in">push</span>(<span class="number">2</span>);</span><br><span class="line">cout &lt;&lt; s.<span class="built_in">top</span>(); <span class="comment">// 输出 2</span></span><br><span class="line">s.<span class="built_in">pop</span>();</span><br></pre></td></tr></table></figure><h5 id="队列（Queue）"><a href="#队列（Queue）" class="headerlink" title="队列（Queue）"></a><strong>队列（Queue）</strong></h5><p>队列是一种先进先出（FIFO, First In First Out）的数据结构，常用于广度优先搜索、任务调度等场景。</p><ul><li>插入操作在队尾进行，删除操作在队头进行。</li><li>时间复杂度为 O(1)。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">q.<span class="built_in">push</span>(<span class="number">1</span>);</span><br><span class="line">q.<span class="built_in">push</span>(<span class="number">2</span>);</span><br><span class="line">cout &lt;&lt; q.<span class="built_in">front</span>(); <span class="comment">// 输出 1</span></span><br><span class="line">q.<span class="built_in">pop</span>();</span><br></pre></td></tr></table></figure><h5 id="双端队列（Deque）"><a href="#双端队列（Deque）" class="headerlink" title="双端队列（Deque）"></a><strong>双端队列（Deque）</strong></h5><p>双端队列允许在两端进行插入和删除操作，是栈和队列的结合体。</p><ul><li>允许在两端进行插入和删除。</li><li>时间复杂度为 O(1)。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">deque&lt;<span class="type">int</span>&gt; dq;</span><br><span class="line">dq.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">dq.<span class="built_in">push_front</span>(<span class="number">2</span>);</span><br><span class="line">cout &lt;&lt; dq.<span class="built_in">front</span>(); <span class="comment">// 输出 2</span></span><br><span class="line">dq.<span class="built_in">pop_front</span>();</span><br></pre></td></tr></table></figure><h5 id="哈希表（Hash-Table）"><a href="#哈希表（Hash-Table）" class="headerlink" title="哈希表（Hash Table）"></a><strong>哈希表（Hash Table）</strong></h5><p>将key使用哈希函数计算，结果取n的模，然后用一个大小为n的链表数组记录数据，在取模结果的位置上增加一个存放了key和value的链表节点。查找同理，计算哈希值-取模-找到链表数组中位置-遍历链表。</p><p>当链表长度过长，触发扩容机制。数组长度n翻倍，重新计算所有数据的位置，扩容时间复杂度O（NlogN）</p><p>哈希操作只是在使用上趋近于O（1）的水平</p><p>哈希表是一种通过键值对存储数据的数据结构，支持快速查找、插入和删除操作。C++ 中的 <code>unordered_map</code> 是哈希表的实现。</p><ul><li>使用哈希函数快速定位元素，时间复杂度为 O(1)。</li><li>不保证元素的顺序。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;string, <span class="type">int</span>&gt; hashTable;</span><br><span class="line">hashTable[<span class="string">&quot;apple&quot;</span>] = <span class="number">10</span>;</span><br><span class="line">cout &lt;&lt; hashTable[<span class="string">&quot;apple&quot;</span>]; <span class="comment">// 输出 10</span></span><br></pre></td></tr></table></figure><h5 id="哈希表的应用"><a href="#哈希表的应用" class="headerlink" title="哈希表的应用"></a>哈希表的应用</h5><h6 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h6><p>将每个数据通过k个哈希函数再取m的模，计算出k个特征值，在大小m位的位图中记录这k个特征值的位置</p><p>其中所需位图大小需要样本量n和允许的失误率p计算，哈希函数个数也就是特征值个数需要m和n计算</p><p><img src="吸佳佳查漏补缺.assets\image-20250407175948599.png" alt="image-20250407175948599"></p><h6 id="一致性哈希"><a href="#一致性哈希" class="headerlink" title="一致性哈希"></a>一致性哈希</h6><p>假设三台服务器用于存储数据，如何做到负载均衡？</p><p>将某哈希算法的哈希空间虚拟成一个圆环，所有的数据计算出来的哈希值都能映射在这个哈希环上。</p><p>对于每台服务器，按照负载能力分配不同数量的节点，用同样的哈希算法计算每个节点的哈希值也映射到哈希环上，节点数量较大时能近似认为是均匀分布的，节点之间的数据由顺时针方向上的节点对应的服务器管理。</p><p>这样由于哈希值分布的均匀性和离散性，可以做到负载均衡，同时如果需要新增服务器或者减少服务器，可以直接新增或者删除环上的节点，移动数据也只需要移动被影响的节点对应的数据。</p><h5 id="映射（Map）"><a href="#映射（Map）" class="headerlink" title="映射（Map）"></a><strong>映射（Map）</strong></h5><p><code>map</code> 是一种有序的键值对容器，底层实现是红黑树。与 <code>unordered_map</code> 不同，它保证键的顺序，查找、插入和删除的时间复杂度为 O(log n)。</p><ul><li>保证元素按键的顺序排列。</li><li>使用二叉搜索树实现。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">map&lt;string, <span class="type">int</span>&gt; myMap;</span><br><span class="line">myMap[<span class="string">&quot;apple&quot;</span>] = <span class="number">10</span>;</span><br><span class="line">cout &lt;&lt; myMap[<span class="string">&quot;apple&quot;</span>]; <span class="comment">// 输出 10</span></span><br></pre></td></tr></table></figure><h5 id="集合（Set）"><a href="#集合（Set）" class="headerlink" title="集合（Set）"></a><strong>集合（Set）</strong></h5><p><code>set</code> 是一种用于存储唯一元素的有序集合，底层同样使用红黑树实现。它保证元素不重复且有序。</p><ul><li>保证元素的唯一性。</li><li>元素自动按升序排列。</li><li>时间复杂度为 O(log n)。</li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">set&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">s.<span class="built_in">insert</span>(<span class="number">1</span>);</span><br><span class="line">s.<span class="built_in">insert</span>(<span class="number">2</span>);</span><br><span class="line">cout &lt;&lt; *s.<span class="built_in">begin</span>(); <span class="comment">// 输出 1</span></span><br></pre></td></tr></table></figure><h2 id="7、线程和进程"><a href="#7、线程和进程" class="headerlink" title="7、线程和进程"></a>7、线程和进程</h2><h3 id="7-1、进程"><a href="#7-1、进程" class="headerlink" title="7.1、进程"></a>7.1、进程</h3><ul><li>进程是操作系统中的一个独立执行单元。每个进程都有独立的内存空间、程序代码、数据和系统资源。</li><li>进程间通信相对复杂，通常需要通过进程间通信机制（IPC，Inter-Process Communication）来实现，如消息队列、信号量、管道等。</li><li>进程切换的代价相对较高，因为切换时需要保存和恢复完整的上下文信息，包括内存、寄存器等。</li></ul><h3 id="7-2、线程"><a href="#7-2、线程" class="headerlink" title="7.2、线程"></a>7.2、线程</h3><ul><li>线程是程序执行中的单一顺序控制流，多个线程可以在同一个进程中独立运行。</li><li>线程除了线程栈外其他数据都是共享的，如果同时读写数据可能造成数据不一致甚至程序崩溃的后果，因此<strong>线程之间重点关注同步</strong>。</li><li>最常解决竞争条件的方式是<strong>原子操作</strong>，其次便是<strong>线程同步</strong>。</li></ul><h4 id="7-2-1、原子操作"><a href="#7-2-1、原子操作" class="headerlink" title="7.2.1、原子操作"></a>7.2.1、原子操作</h4><p> 原子操作，一般都是指“不可分割的操作”；是一系列不可被 CPU 上下文交换的机器指令，这些指令组合在一起就形成了原子操作。在多核 CPU 下，当某个 CPU 核心开始运行原子操作时，会先暂停其它 CPU 内核对内存的操作，以保证原子操作不会被其它 CPU 内核所干扰。</p><p>正常情况下，我们想到就是使用<code>mutex</code>来解决上述对临界资源访问的问题，使用<code>mutex</code>程序执行不会导致混乱，但是每一次循环都要加锁解锁是的程序开销很大。  而原子操作是通过指令提供的支持，因此它的性能相比锁和消息传递会好很多。相比较于锁而言，原子类型不需要开发者处理加锁和释放锁的问题，同时支持修改，读取等操作，还具备较高的并发性能。</p><p>互斥量的加锁一般是针对一个代码段，而原子操作针对的一般都是一个变量。</p><h5 id="atomic"><a href="#atomic" class="headerlink" title="atomic"></a>atomic</h5><p>为了提高性能，C++11提供了原子类型<code>atomic&lt;T&gt;</code>，它提供了多线程间的原子操作，可以把原子操作理解成一种：不需要用到互斥量加锁（无锁）技术的多线程并发编程方式。</p><p>它定义在<code>&lt;atomic&gt;</code>头文件中，原子类型是封装了一个值的类型，它的访问保证不会导致数据的竞争，并且可以用于在不同的线程之间同步内存访问。这个类型必须有拷贝赋值运算符。这就意味着这个类型不能有任何虚函数或虚基类，以及必须使用编译器创建的拷贝赋值操作。不仅仅是这些，自定义类型中所有的基类和非静态数据成员也都需要支持拷贝赋值操作。</p><p><code>atomic</code>模板允许用户使用自定义类型创建一个原子变量</p><ul><li><code>load()</code>: 安全地读取原子变量的值。</li><li><code>store(value)</code>: 安全地将值写入原子变量。</li><li><code>exchange(value)</code>: 将原子变量的值替换为<code>value</code>，并返回原子变量的旧值。</li><li><code>compare_exchange_weak(expected, desired)</code>: 如果原子变量的当前值等于<code>expected</code>，则将其设置为<code>desired</code>，并返回<code>true</code>。否则，将<code>expected</code>设置为原子变量的当前值，并返回<code>false</code>。</li><li><code>compare_exchange_strong(expected, desired)</code>: 与<code>compare_exchange_weak</code>类似，但循环直到成功。</li></ul><h4 id="7-2-2、线程同步"><a href="#7-2-2、线程同步" class="headerlink" title="7.2.2、线程同步"></a>7.2.2、线程同步</h4><h5 id="互斥锁"><a href="#互斥锁" class="headerlink" title="互斥锁"></a>互斥锁</h5><p><code>mutex</code>是睡眠等待（sleep waiting）类型的锁，<strong>当线程抢互斥锁失败的时候，线程会陷入休眠</strong>。优点就是节省CPU资源，缺点就是休眠唤醒会消耗一点时间。它有 <strong><em>lock</em></strong> 和 <strong><em>unlock</em></strong> 两种状态，一旦获取，就会上锁，且只能由该线程解锁，期间，其他线程无法获取</p><h6 id="lock-guard"><a href="#lock-guard" class="headerlink" title="lock_guard"></a>lock_guard</h6><p>自动加锁：当一个 <code>lock_guard</code> 对象被创建时，它会自动为传入的 <code>mutex</code> 锁加锁。</p><p>自动释放锁：当 <code>lock_guard</code> 对象超出作用域时，它会自动释放锁。</p><h5 id="条件变量"><a href="#条件变量" class="headerlink" title="条件变量"></a>条件变量</h5><p>并发有互斥和等待两大需求，前者是因为线程间存在共享数据依赖而后者是线程间存在依赖，条件变量正是为了解决等待需求。</p><p>条件变量本质上也是一个多线程间共享的全局变量，它的功能是阻塞线程，被阻塞的线程直到接收到“条件成立”的信号后才能继续执行。</p><ul><li>条件变量并不是锁（但它几乎总是和互斥量一起使用的），而是线程间的一种通讯机制</li><li>条件变量本身也不包含条件，它被称为条件变量是因为它经常和条件语句（if/while）一起使用</li></ul><p>条件变量被用来阻塞一个线程，当条件不满足时，线程会解开互斥锁，并等待条件发生变化。一旦其他线程改变了条件变量，将通知相应的阻塞线程，这些线程重新锁定互斥锁，然后执行后续代码，最后再解开互斥锁。</p><p>具体流程：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">手动上锁——&gt;判断条件不满足——&gt;[条件变量自动解锁、阻塞线程、等待信号—— ——&gt;自动上锁]——&gt;判断条件满足——&gt;执行代码——&gt;手动解锁</span><br><span class="line">       [其他线程准备好条件后发送信号唤醒——^] <span class="comment">// 中括号中为系统封装，中括号外需要程序员实现</span></span><br></pre></td></tr></table></figure><p>背景：轮询模式与事件模式。以生产者和消费者模型为例。。。</p><h5 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h5><p>读写锁也称之为 <strong>共享-独占锁</strong>，一般用在<strong>读操作次数多于写操作次数</strong>的场合。</p><p>相较于互斥锁而言<strong>读写锁有一定的性能提升</strong>，应对的是单写多读模型：</p><ul><li>写独占：写锁占用时，其他线程加读锁或者写锁时都会阻塞（并非失败）</li><li>读共享：读锁占用时，其他线程加写锁时会阻塞，加读锁会成功</li></ul><p>读写锁有两种策略：</p><ul><li>强读同步：读锁优先，只要写锁没有占用那么就可以加读锁</li><li>强写同步：写锁优先，只能等到所有正在等待或者执行的写锁执行完成后才能加读锁</li></ul><p>大部分读写锁的实现都采用的是“强写同步”策略，对尝试加锁的操作进行排队，如果前面已经有尝试加写被锁阻塞住的话，后续加读锁也都会被阻塞住（尽管当前时刻是读锁占用的状态）。这样做的目的主要是为了避免“写饥饿”，在“多读少写”的情况下防止数据修改延迟过高。</p><h5 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h5><p>信号量分为有名信号量和无名信号量，无名信号量用于线程同步，有名信号量一般用于进程之间管理。</p><p>信号量本质上是一个非负的整数计数器，用于控制公共资源的访问，也被称为PV原子操作：</p><ul><li>P操作：“等待”操作，信号量<code>sem</code>先减一，若<code>sem</code>小于等于0则<code>P操作</code>被阻塞，直到有其他线程通过 <code>V操作</code> 将信号量的值增加至大于 0，从而唤醒等待的线程。</li><li>V操作：“释放”操作，信号量<code>sem</code>加一，若 <code>sem</code> 小于等于 0，表示有线程在等待信号量，<code>V操作</code> 会唤醒其中一个等待的线程。</li></ul><p>信号量允许<strong>多个线程</strong>同时进入临界区，而互斥量只允许<strong>一个线程</strong>进入临界区。</p><p>可以这样理解，互斥锁使用对同一个资源的互斥的方式达到线程同步的目的，信号量可以同步多个资源以达到线程同步</p><h2 id="8、C-标准库"><a href="#8、C-标准库" class="headerlink" title="8、C++ 标准库"></a>8、C++ 标准库</h2><h3 id="8-1、容器"><a href="#8-1、容器" class="headerlink" title="8.1、容器"></a>8.1、容器</h3><h4 id="8-1-1、顺序容器"><a href="#8-1-1、顺序容器" class="headerlink" title="8.1.1、顺序容器"></a>8.1.1、顺序容器</h4><h5 id="string"><a href="#string" class="headerlink" title="string"></a>string</h5><p>使用 <code>+</code> 连接字符串</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">std::string str1 = <span class="string">&quot;Hello, &quot;</span>;</span><br><span class="line">std::string str2 = <span class="string">&quot;World!&quot;</span>;</span><br><span class="line">std::string result = str1 + str2;</span><br></pre></td></tr></table></figure><ul><li><p><code>getline(cin, str)</code>：可以获取空格，以enter结尾</p></li><li><p><code>size()</code>：返回字符串的长度。</p></li><li><p><code>empty()</code>：检查字符串是否为空。</p></li><li><p><code>substr()</code>：返回从指定位置开始的子字符串。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string <span class="title">substr</span><span class="params">(<span class="type">size_t</span> __pos = <span class="number">0</span>, <span class="type">size_t</span> __n = npos)</span></span>;<span class="comment">// 返回从pos开始的n个字符</span></span><br></pre></td></tr></table></figure></li><li><p><code>find()</code>：查找子字符串在主字符串中的位置。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">find</span><span class="params">(basic_string&amp; __str, <span class="type">size_t</span> __pos)</span></span>;<span class="comment">// 从pos开始查找str的位置</span></span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">find</span><span class="params">(<span class="type">char</span> *__s, <span class="type">size_t</span> __pos, <span class="type">size_t</span> __n)</span></span>;<span class="comment">// 从pos开始查找以s开头长度为n的字符串的位置</span></span><br></pre></td></tr></table></figure></li><li><p><code>replace()</code>：替换字符串中的某些字符。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string &amp;<span class="title">replace</span><span class="params">(<span class="type">size_t</span> __pos, <span class="type">size_t</span> __n1, basic_string&amp; __str)</span></span>;<span class="comment">// 替换从pos开始的n个字符为str</span></span><br></pre></td></tr></table></figure></li><li><p><code>insert()</code>：在指定位置插入内容。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string &amp;<span class="title">insert</span><span class="params">(<span class="type">size_t</span> __pos, basic_string&amp; __str)</span></span>;<span class="comment">// 在pos处插入str</span></span><br><span class="line"><span class="function">string &amp;<span class="title">insert</span><span class="params">(<span class="type">size_t</span> __pos, <span class="type">size_t</span> __n, <span class="type">char</span> *__c)</span></span>;<span class="comment">// 在pos处插入n个char c</span></span><br></pre></td></tr></table></figure></li><li><p><code>append()</code>：在字符串末尾添加内容。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string &amp;<span class="title">append</span><span class="params">(basic_string&amp; __str)</span></span>;<span class="comment">// 末尾添加</span></span><br></pre></td></tr></table></figure></li><li><p><code>erase()</code>：删除指定位置的字符或子字符串。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">string&amp; <span class="title">erase</span><span class="params">(<span class="type">size_t</span> pos = <span class="number">0</span>, <span class="type">size_t</span> n = npos)</span></span>;<span class="comment">// 删除从pos开始的n个字符</span></span><br><span class="line"><span class="function">iterator <span class="title">erase</span><span class="params">(iterator position)</span></span>;             <span class="comment">// 删除position处的一个字符(position是个string类型的迭代器)</span></span><br><span class="line"><span class="function">iterator <span class="title">erase</span><span class="params">(iterator first, iterator last)</span></span>; <span class="comment">// 删除从first到last之间的字符(first和last都是迭代器)</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h5><ul><li><p><code>erase()</code> ：从指定容器删除指定位置的元素或某段范围内的元素</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">iterator <span class="title">erase</span><span class="params">( iterator _Where)</span></span>;<span class="comment">// 删除指定位置的元素，返回值是一个迭代器，指向删除元素的下一个元素；</span></span><br><span class="line"><span class="function">iterator <span class="title">erase</span><span class="params">( iterator _First,   iterator _Last)</span></span>;<span class="comment">// 删除从_First开始到_Last位置的元素</span></span><br></pre></td></tr></table></figure></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(vector&lt;<span class="type">int</span>&gt;::iterator it=arr.<span class="built_in">begin</span>(); it!=arr.<span class="built_in">end</span>(); )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(* it == <span class="number">0</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        it = arr.<span class="built_in">erase</span>(it);<span class="comment">//vector后面的元素会向前移位，形成新的容器，这样原来指向删除元素的迭代器（_Where）就失效了。</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">    &#123;</span><br><span class="line">        ++it;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">// 注意：调用erase(it)后，语义上来说it失效了，实际上指向的元素变成了下一个元素，再执行it++导致跳过该元素</span></span><br></pre></td></tr></table></figure><h5 id="list"><a href="#list" class="headerlink" title="list"></a>list</h5><h5 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h5><p>双端队列，<code>deque</code> 是在队列的两端都可以进行插入和删除的队列，且增删的效率均为O(1)。<code>deque</code> 支持随机访问，在表面上看起来是连续存储的，但在底层实现中却不是完全连续，而是分段连续的。</p><p><code>deque</code> 有一个中控器，中控器中包含了每一段连续地址的大小、开始地址（迭代器）、结束地址（迭代器），并包含一个指向开始地址的指针。实际访问到一个地址的元素，需要先访问中控器，找到相应的缓冲区，再在缓冲区中找到目标元素。因此 <code>deque</code> 的<strong>随机访问</strong>是比 <code>vector</code> 低效的。</p><p>与 <code>vector</code> 比较，    其头部插入和删除以及扩容时，不需要搬移元素，因此其效率是必vector高的。<br>与 <code>list</code> 比较，    其底层是连续空间，空间利用率比较高，不需要存储额外字段。</p><p>但是，<code>deque</code> 有一个致命缺陷：不适合遍历。因为在遍历时，<code>deque</code> 的迭代器要频繁的去检测是否移动到某段小空间的边界，导致效率低下，而序列式场景中，可能需要经常遍历，因此在实际中，需要线性结构时，大多数情况下优先考虑 <code>vector</code> 和 <code>list</code> </p><p> <code>deque</code> 的应用并不多，而目前能看到的一个应用就是，STL用其作为 <code>stack</code> 和 <code>queue</code> 的底层数据结构。</p><h4 id="8-1-2、关联容器"><a href="#8-1-2、关联容器" class="headerlink" title="8.1.2、关联容器"></a>8.1.2、关联容器</h4><h5 id="set"><a href="#set" class="headerlink" title="set"></a>set</h5><h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><h3 id="8-2、容器适配器"><a href="#8-2、容器适配器" class="headerlink" title="8.2、容器适配器"></a>8.2、容器适配器</h3><p><strong>适配器是指将一个类型的接口转化为另外一个接口</strong>。C++中的容器适配器的意思便是：在C++提供的<strong>底层容器的基础</strong>上实现我们所希望的功能，而向外表现出和容器一样的特点。</p><h5 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h5><h5 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h5><p>只要支持以下几种操作的容器均可作为<code>stack</code>和<code>queue</code>的底层容器：</p><ul><li>empty()：检测容器是否为空</li><li>size()：返回容器中有效元素个数</li><li>front()：返回容器中第一个元素的引用</li><li>push_back()：在容器尾部插入元素</li><li>pop_back()：删除容器尾部元素</li></ul><h5 id="priority-queue"><a href="#priority-queue" class="headerlink" title="priority_queue"></a>priority_queue</h5><p><strong>优先队列</strong>，是基于堆这种数据结构实现的，允许我们快速访问队列中具有最高（或最低）优先级的元素，但不支持随机访问也不提供迭代器。所以<code>priority_queue</code> 实际上是一个容器适配器，它提供了<strong>对底层容器的堆操作</strong>，其可选的底层容器包括vector、deque等，但注意<strong>不能使用list</strong>（list不支持随机访问迭代器。<code>priority_queue</code> 需要能够通过索引或迭代器直接访问任意元素），STL<strong>默认使用vector</strong>。</p><p>在 C++ 中，<code>priority_queue</code> 默认是一个最大堆，队列的顶部元素总是具有最大的值。</p><p>堆是一个特别完全二叉树的结构，即满足 父结点的键值总是大于（或者小于）它的子节点 的完全二叉树。</p><p>父节点的值恒小于等于子节点的值，称为最小堆（min heap）；父节点的值恒大于等于子节点的值，此堆称为最大堆（max heap）</p><ul><li><p><code>empty()</code>: 检查队列是否为空。</p></li><li><p><code>size()</code>: 返回队列中的元素数量。</p></li><li><p><code>top()</code>: 返回队列顶部的元素（不删除它）。</p></li><li><p><code>push()</code>: 向队列添加一个元素。</p></li><li><p><code>pop()</code>: 移除队列顶部的元素。</p><p>优先级判断重载：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">student</span> <span class="comment">// 法一：运算符重载&lt;</span></span><br><span class="line">&#123;</span><br><span class="line">  string name;</span><br><span class="line">  <span class="type">int</span> age;</span><br><span class="line">  <span class="built_in">student</span>(<span class="type">int</span> a) &#123;age = a;&#125;</span><br><span class="line">  <span class="type">bool</span> <span class="keyword">operator</span>&lt;(<span class="type">const</span> student&amp; a) <span class="type">const</span></span><br><span class="line">  &#123;</span><br><span class="line"><span class="keyword">return</span> age &lt; a.age;<span class="comment">// 不改变&lt;语义，按默认大的在堆顶</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ageCompare</span> <span class="comment">// 法二：重写仿函数</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span> <span class="params">(student a, student b)</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line"><span class="keyword">return</span> a.age &gt; b.age; <span class="comment">// 返回true代表后者优先级高放在堆顶，此处为年龄小的优先级高</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  priority_queue&lt;student&gt; students;</span><br><span class="line">  <span class="comment">// priority_queue&lt;student, vector&lt;student&gt;, ageCompare&gt; students;</span></span><br><span class="line"></span><br><span class="line">  students.<span class="built_in">push</span>(<span class="built_in">student</span>(<span class="number">10</span>));</span><br><span class="line">  students.<span class="built_in">push</span>(<span class="built_in">student</span>(<span class="number">20</span>));</span><br><span class="line">  students.<span class="built_in">push</span>(<span class="built_in">student</span>(<span class="number">15</span>));</span><br><span class="line">  cout &lt;&lt; students.<span class="built_in">top</span>().age &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="8-3、其他"><a href="#8-3、其他" class="headerlink" title="8.3、其他"></a>8.3、其他</h3><h4 id="sstream"><a href="#sstream" class="headerlink" title="sstream"></a>sstream</h4>]]></content>
      
      
      <categories>
          
          <category> 大冒险 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>笔记本氮化镓电源使用指北</title>
      <link href="/2024/10/28/%E7%AC%94%E8%AE%B0%E6%9C%AC%E6%B0%AE%E5%8C%96%E9%95%93%E7%94%B5%E6%BA%90%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8C%97/"/>
      <url>/2024/10/28/%E7%AC%94%E8%AE%B0%E6%9C%AC%E6%B0%AE%E5%8C%96%E9%95%93%E7%94%B5%E6%BA%90%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8C%97/</url>
      
        <content type="html"><![CDATA[<h1 id="笔记本氮化镓电源使用指北"><a href="#笔记本氮化镓电源使用指北" class="headerlink" title="笔记本氮化镓电源使用指北"></a>笔记本氮化镓电源使用指北</h1><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><hr><p><strong>宇宙安全免责声明：擅自使用非官方配件可能存在风险，建议谨慎操作</strong> </p><hr><p>本文为联想氮化镓电源+诱骗线使用指南。</p><p>仅基于联想拯救者r9000p3070 2021进行测试，但理论面向所有笔记本。</p><h3 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h3><p>笔记本的原厂电源适配器通常傻大黑重，短途出行需携带电脑情况下，电源是个很大的负担，各大厂商均有相应的解决方案，而本文的主角是联想的c170氮化镓充电器。<br><img src="https://photo.x1ang.com/静物摄影/241019-c170电源/c170.webp" alt="c170"></p><h4 id="酷态科15号"><a href="#酷态科15号" class="headerlink" title="酷态科15号"></a>酷态科15号</h4><p>虽然性能同样优异，但不是本文的主角，这里不过多介绍，只简单讲讲优劣</p><h5 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h5><p>负载能力同样优秀</p><p>多口，3c1a的设计，更适合出行</p><p>支持pd3.1,以及其他更多协议，对手机快充友好</p><p>插脚可折叠，收纳方便</p><h5 id="劣势"><a href="#劣势" class="headerlink" title="劣势"></a>劣势</h5><p>待机功耗高，空载竟然有发热情况</p><p>给非苹果笔记本供电最高只能支持到pd3.0的100w</p><h4 id="联想c140、c170"><a href="#联想c140、c170" class="headerlink" title="联想c140、c170"></a>联想c140、c170</h4><p>相比于其他竞品，c170散热好输出稳定，能长时间满功率输出（不同室温工况表现不同），且峰值输出功率能达200w；</p><p>c140也能稳定超载到150w长时工作，且相比c170额外支持pd3.1的28V5A档位。</p><p>协议、纹波、用料拆解推荐b站电锉刀的测评</p><p>直接复制插入你的 md 文章就行，修改里面的 aid 为你视频的 AV号：</p><div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=1352908756&autoplay=0"     allowfullscreen="true">     </iframe></div><div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=442003154&autoplay=0"     allowfullscreen="true">     </iframe></div><p>价格便宜，闲鱼二手价c170仅需170左右，c140仅需100上下（24年9月）；</p><h5 id="为什么需要诱骗线"><a href="#为什么需要诱骗线" class="headerlink" title="为什么需要诱骗线"></a>为什么需要诱骗线</h5><p>联想几乎只在与充电器同年的最新款拯救者上做了适配，小新、thinkbook等系列包括其他品牌笔记本使用均不能达到理想的效果，例如笔者的2021款的拯救者使用这类充电器时，显示低功率电源接入，cpu和gpu功耗都被限制在40w以内，完全发挥不出电脑的性能。对于其他品牌电脑，诱骗线同时又充当转接头使用。</p><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>白话文介绍，没有严谨依据，仅基于笔者一些浅薄的认知推测而来，如有错误欢迎指正。</p><p>以c135为例，c135的c2slim线的emark芯片接入笔记本时，向笔记本发送电源信息，笔记本接收信息确认是低功率电源，调用相应的功率分配方案，严格限制向电源索取的电流大小。诱骗线同样有emark芯片，用于伪造与原装砖头电源相同的eMark信号，笔记本认为接入的是原装电源，绕过了低功率调度。但是这引入了新的问题，高负载情况下笔记本会请求过大的电流，触发c135的过载保护机制，就需要软件限制cpu、gpu的功耗。</p><h5 id="功耗分配"><a href="#功耗分配" class="headerlink" title="功耗分配"></a>功耗分配</h5><p>gpu功耗推荐使用微星小飞机调整，cpu功耗控制只给拯救者用户推荐专用的llt（Lenovo Legion Toolkit）。</p><p>除去两大电老虎，笔记本其余部分功耗大约在25w左右，为硬盘高负载、显示器高亮等情况留足5w余量，总计30w周边功耗。</p><p>以c140为例，c140可以长时间150w超负荷输出，亲测2021款r9000p 3070可以cpu+gpu稳定25+100总共125w功率，进行35分钟烤鸡测试，未出现异常。</p><p><img src="https://assets.blog.x1ang.com/笔记本氮化镓电源使用指北/25w+100w.webp" alt="25w+100w"></p><p>100w功耗的3070laptop可以发挥本身95%的性能，下图分别为满血140w和使用c140时100w的gpu blender跑分。</p><p><img src="https://assets.blog.x1ang.com/笔记本氮化镓电源使用指北/140w跑分.webp" alt="140w跑分"></p><p><img src="https://assets.blog.x1ang.com/笔记本氮化镓电源使用指北/100w跑分.webp" alt="100w跑分"></p><p>如此性能差距在体验3a游戏时基本没有问题，在更吃cpu性能的fps和网游中，可以选择35+90的功耗分配，实测瓦罗兰特中低画质2.5k分辨率，帧率在150-200波动，理论上已经能完全应对短期出门的需求，但实际使用中还有瑕疵。</p><p>笔记本显卡几乎无法直接设置功耗墙，只能通过调整电压/频率曲线，拉直高频，让gpu以较低电压跑在较低频率下，但是功耗不止和电压频率相关。根据P<sub>dyn</sub> ≈ C·V<sup>2</sup>·f·α，相同的电压频率下功耗还受切换因子α和有效开关电容C影响，这里不探讨详细的逻辑，简而言之即功耗同时受负载影响，不同的游戏不同的场景，也分负载高低。要么限制电压、频率在很低的水平，要么就需要对不同的场景单独调整一份电频曲线，保证gpu功耗不会过高拉死电源，此外cpu睿频机制也可能会瞬时索取更高的功耗触发充电头的过载保护。</p><p>24的新品c170则给出完美答卷，相比c140，c170体积稍大一圈，改进了散热系统，大面积使用铜片以及石墨烯导热材料，移除了灌胶设计，体积增大重量却变轻了，同时负载能力提高了20w，能做到20+125的功耗分配。125w刚好是3070laptop的基础功耗(笔记本标称的满血140w实际上是125+15，额外的15w是向cpu动态借来的，可以用llt直接限制) ，不再需要调整电压/频率曲线，再者c170过载保护大概在200w左右，在cpu稳定20w工作的同时有30w的余量用于短时睿频，基本解决了上代电源的所有痛点。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这几款充电器都十分优秀，而且差异化明显，追求稳定性能c170，有pd3.1的需求选c140，刚需多口输出选酷态科，大人才做选择，小孩子全都要。</p><p>诱骗线可以上淘宝购买，这边不放第三方店铺，只需要下单前跟客服说明需求，就能保证不会买错。</p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 魔改 </tag>
            
            <tag> GaN电源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>紫金山-阿特拉斯彗星</title>
      <link href="/2024/10/18/%E7%B4%AB%E9%87%91%E5%B1%B1-%E9%98%BF%E7%89%B9%E6%8B%89%E6%96%AF%E5%BD%97%E6%98%9F/"/>
      <url>/2024/10/18/%E7%B4%AB%E9%87%91%E5%B1%B1-%E9%98%BF%E7%89%B9%E6%8B%89%E6%96%AF%E5%BD%97%E6%98%9F/</url>
      
        <content type="html"><![CDATA[<p>拍摄于市中心九级光污染区，此时彗星早已经过近日点，逐渐远离太阳系，亮度也越来越低，峰值亮度当天长春多云，完全没法拍摄。</p><p>蹲了几天总算迎来一个大晴天，但是空气质量也一般，远处地平线上空还有霾，在太阳落山与彗星没入地平线的大约半小时空窗期，间隔拍摄了350张，取部分效果最好的用ciril堆栈得到下图效果。</p><p>拍摄过程还是比较轻松愉快的，根据肉眼可见的金星做参照物，确定彗星位置，架好相机，确认构图，手动对焦远方地平线，曝光自动，就开始间隔拍摄。</p><p><img src="https://photo.x1ang.com/241012-紫金山-阿特拉斯彗星/紫金山-阿特拉斯彗星.webp" alt="紫金山-阿特拉斯彗星"></p><p>其余的顺手合了个延时</p><p>血的教训，拍到一半尽可能不要动光圈🤓👆，用的是佳能的一颗上古老头rf 17-40 f4 l，海鲜市场900就能拿下一颗成色较新的😋，光圈全开时画质一般，收一档会有很大改善。拍到一半想到这茬，给光圈缩到f5.6，导致画面突变，后期完效果更明显，也就是视频里画面突变的那一帧。</p><p>中途还因为太激动想回看打断了间隔拍摄🤣，也就是后面彗星闪现的那一段。</p><div align=center class="aspect-ratio">    <iframe src="https://player.bilibili.com/player.html?aid=115292491618169&autoplay=0"     allowfullscreen="true">     </iframe></div><p>这是早些天，用70200拍的彗星特写，彗星亮度高但是雾霾很严重🤬，堆栈后画面脏的要命，救不回来了。</p><p><img src="https://photo.x1ang.com/241012-紫金山-阿特拉斯彗星/彗星特写.webp" alt="彗星特写"></p><p>摄友不拍延时，帮忙按的合影，天台风好大，我好害怕，10月中旬的长春，20层楼高的屋顶，会教训每一个不戴厚羽绒的小丑🥶。</p><p><img src="https://photo.x1ang.com/241012-紫金山-阿特拉斯彗星/彗星合影.webp" alt="彗星合影"></p><p>拍摄日期是24.10.15，误入画面的应该是SpaceX的猎鹰9号火箭二级钝化火箭云👽，没有录下来比较遗憾。</p><p><img src="https://photo.x1ang.com/241012-紫金山-阿特拉斯彗星/猎鹰9号二级钝化火箭云.webp" alt="猎鹰9号二级钝化火箭云"></p><p><img src="https://photo.x1ang.com/241012-紫金山-阿特拉斯彗星/吉大通信天台月.webp" alt="吉大通信天台月"></p><p>又过了几天，想去隔壁小区楼顶找机位，给教学楼和彗星合影，可惜天台全锁死了😇，无奈用无人机应付两张。无人机的cmos实在太小，加上彗星亮度更低了，拍摄时间已经很晚，几乎不受太阳余晖影响，但效果仍不理想，全是噪点😤</p><p><img src="https://photo.x1ang.com/241012-紫金山-阿特拉斯彗星/南湖校区&amp;彗星.webp" alt="南湖校区&amp;彗星"></p><p>但是夕阳意外的好看🥰</p><p><img src="https://photo.x1ang.com/241012-紫金山-阿特拉斯彗星/南湖校区夜景.webp" alt="南湖校区夜景"></p>]]></content>
      
      
      <categories>
          
          <category> 摄影 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 彗星 </tag>
            
            <tag> 风光 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>解决索尼WH-1000XM4降噪模式啸叫问题</title>
      <link href="/2024/06/02/%E8%A7%A3%E5%86%B3%E7%B4%A2%E5%B0%BCWH-1000XM4%E9%99%8D%E5%99%AA%E6%A8%A1%E5%BC%8F%E5%95%B8%E5%8F%AB%E9%97%AE%E9%A2%98/"/>
      <url>/2024/06/02/%E8%A7%A3%E5%86%B3%E7%B4%A2%E5%B0%BCWH-1000XM4%E9%99%8D%E5%99%AA%E6%A8%A1%E5%BC%8F%E5%95%B8%E5%8F%AB%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="省流"><a href="#省流" class="headerlink" title="省流"></a>省流</h2><h3 id="故障"><a href="#故障" class="headerlink" title="故障"></a>故障</h3><p>故障体现为开启环境音模式、降噪模式时，而出现单边或双边发生啸叫，通过改变佩戴姿势、吹风机加热等方式能缓解啸叫问题，且拆开耳罩发现降噪咪头出油或其他异常。</p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>1688 上淘个新的咪头自己换上，网传最匹配的是莺歌声学 5822 的咪头，58 直径 22 厚度，但是他家坐地起价，原本售价几毛钱的咪头涨到 7 块一个，故尝试了其他规格的咪头，实测 6022 的也能正常使用，也能刚好放进耳机的卡槽里</p><h2 id="经过"><a href="#经过" class="headerlink" title="经过"></a>经过</h2><p>本人在东北上学，冬天户外冻鼻子冻耳朵，加上比较喜欢听歌，于是拿xm4当耳罩用，出门、上课路上都戴着，过分相信耳机的防水性能了，雪花甚至小雨落在耳机上不管不顾，耳机温度在室外降下来后没有保护措施直接戴进有暖气的教学楼，内部会凝结小水珠，这是冬天出门摄影，回宿舍相机镜头需要密封得出的经验，耳机也是如此，当时竟然没有考虑到。</p><p><img src="https://assets.blog.x1ang.com/解决索尼WH-1000XM4降噪模式啸叫问题/6507e462d8792944597b94fd8833e7c6_720.webp" alt="6507e462d8792944597b94fd8833e7c6_720"></p><p>过了段时间问题出现，开始啸叫频率很低，而且能通过重启解决，到后面故障频率越来越高，降噪模式打开戴不到5分钟就开始啸叫。于是想着怎么解决，当年网上相关信息很少，搜不到啸叫的具体原因，也只有部分博主提出用热风机加热可以缓解，但无法解决，电话咨询售后得知检验费90，对只是检验费，检出问题额外花钱修，没检出问题检验费也要收，斤斤计较的我这哪能忍。</p><p>于是拆机检查，不拆不要紧，一拆发现整个咪头周围都是油渍。上网搜索咪头、啸叫关键词，才搜索到一篇帖子，提到和我同样的故障，不过他是因为长期戴着睡觉，晚上捂的起汗导致的元器件受潮。</p><p><img src="https://assets.blog.x1ang.com/解决索尼WH-1000XM4降噪模式啸叫问题/7c7ae2bea8fcf46ef1960b4979569e0c.webp" alt="7c7ae2bea8fcf46ef1960b4979569e0c"></p><p>帖子里也提到了解决方案，1688 淘莺歌声学规格 5822 的咪头自己焊上，帖子里记录的他家一个咪头价格还在几毛钱左右，我去搜已经坐地起价到7r，十个起发70块钱，这和售后检查的价格差不多了，估摸了一下耳机里槽位的大小，冒险下单了 6022 规格的咪头，到货之后毫无意外刚刚好好塞进咪头的槽位。</p><p><img src="https://assets.blog.x1ang.com/解决索尼WH-1000XM4降噪模式啸叫问题/6bce0272a40e909aac5f4c7d31dc7457_720.webp" alt="6bce0272a40e909aac5f4c7d31dc7457_720"></p><p><img src="https://assets.blog.x1ang.com/解决索尼WH-1000XM4降噪模式啸叫问题/a49df9ca7b4722aa67c89b0a13593fbc_720.webp" alt="a49df9ca7b4722aa67c89b0a13593fbc_720">简单的点焊上，不出所料，降噪功能恢复了，除了耳压相比之前有变化，其他的功能完全没问题，到此也是圆满结束</p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 魔改 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>diy半导体小冰箱心得（待上传）</title>
      <link href="/2022/09/05/diy%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%B0%8F%E5%86%B0%E7%AE%B1%E5%BF%83%E5%BE%97/"/>
      <url>/2022/09/05/diy%E5%8D%8A%E5%AF%BC%E4%BD%93%E5%B0%8F%E5%86%B0%E7%AE%B1%E5%BF%83%E5%BE%97/</url>
      
        <content type="html"><![CDATA[<p>文章待上传<br><img src="https://assets.blog.x1ang.com/diy半导体小冰箱心得/IMG_20220716_193013.webp" alt="IMG_20220716_193013"><br><img src="https://assets.blog.x1ang.com/diy半导体小冰箱心得/IMG_20220724_071149.webp" alt="IMG_20220724_071149"><br><img src="https://assets.blog.x1ang.com/diy半导体小冰箱心得/IMG_20220905_230746.webp" alt="IMG_20220905_230746"><br><img src="https://assets.blog.x1ang.com/diy半导体小冰箱心得/IMG_20220905_230807.webp" alt="IMG_20220905_230807"><br><img src="https://assets.blog.x1ang.com/diy半导体小冰箱心得/IMG_20220905_232359.webp" alt="IMG_20220905_232359"></p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 魔改 </tag>
            
            <tag> 半导体 </tag>
            
            <tag> diy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>diy显示器心得（待上传）</title>
      <link href="/2022/07/08/diy%E6%98%BE%E7%A4%BA%E5%99%A8%E5%BF%83%E5%BE%97/"/>
      <url>/2022/07/08/diy%E6%98%BE%E7%A4%BA%E5%99%A8%E5%BF%83%E5%BE%97/</url>
      
        <content type="html"><![CDATA[<p>文章待上传<br><img src="https://assets.blog.x1ang.com/diy显示器心得/1657289625002.webp" alt="1657289625002"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20220708_003349.webp" alt="IMG_20220708_003349"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20220708_134829.webp" alt="IMG_20220708_134829"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20220708_172646.webp" alt="IMG_20220708_172646"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20220708_185245.webp" alt="IMG_20220708_185245"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20220708_221242.webp" alt="IMG_20220708_221242"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20220709_005148.webp" alt="IMG_20220709_005148"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20220709_005157.webp" alt="IMG_20220709_005157"><br><img src="https://assets.blog.x1ang.com/diy显示器心得/IMG_20230222_120111.webp" alt="IMG_20230222_120111"></p>]]></content>
      
      
      <categories>
          
          <category> 日常 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 魔改 </tag>
            
            <tag> diy </tag>
            
            <tag> 显示器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git学习笔记</title>
      <link href="/2021/10/14/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2021/10/14/git%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="git基本概念"><a href="#git基本概念" class="headerlink" title="git基本概念"></a>git基本概念</h2><p><strong>Git 是一个开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目</strong></p><p>通过<code>git</code>我们可以高效管理项目的变更改动，记录下每一个版本，并且可以随时回到任意一个历史版本。</p><p>也可实现项目的多人协同开发，<code>git</code>能管理所有人对项目的修改，辅助合并所有人的代码。</p><p>无论是个人小型项目开发，还是多人大型项目管理，又或是现今AI编程<code>Agent</code>模式，都离不开<code>git</code>。</p><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><h4 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h4><p><code>git</code>仓库分为<strong>本地仓库</strong>和<strong>远程仓库</strong>，其中本地仓库又可分为三个区，<strong>工作区</strong>、<strong>暂存区</strong>和<strong>版本库</strong>，远程仓库则通常使用<code>github</code>进行托管。</p><p>本地仓库即可完成版本控制，而远程仓库则是服务于多人协同开发（亦可用于个人项目管理）</p><p>使用<code>git init</code>将该目录变为<code>git</code>能够管理的仓库，会自动生成<code>.git</code>文件夹，即是暂存区和版本库的位置</p><ul><li><p>工作区：除<code>.git</code>以外的目录</p></li><li><p>暂存区：也叫<code>index</code>，存在于<code>.git/index</code>文件中，工作区的文件通过命令<strong>添加</strong>到暂存区</p></li><li><p>版本库：<code>.git</code>中除<code>index</code>文件以外的所有内容，暂存区的文件通过命令<strong>提交</strong>到版本库</p></li></ul><h4 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h4><p>在<code>git</code>中，<strong>分支是指向某个提交的可移动指针</strong>，切换分支就是在移动指针。</p><p>项目通常从主分支<code>main</code>起步，开发者可在其基础上创建功能分支进行<strong>并行开发</strong>，不同分支的修改<strong>互不影响</strong>，但它们通常<strong>共享同一基底</strong>，并可通过<strong>合并（merge）</strong>或<strong>变基（rebase）</strong>将成果汇入主分支<code>main</code>，从而把不同的工作整合为一条主线。</p><h2 id="git基本操作"><a href="#git基本操作" class="headerlink" title="git基本操作"></a>git基本操作</h2><p><img src="https://assets.blog.x1ang.com/git学习笔记/git-command.webp" alt="git-command"></p><h3 id="本地操作"><a href="#本地操作" class="headerlink" title="本地操作"></a>本地操作</h3><h4 id="添加与删除"><a href="#添加与删除" class="headerlink" title="添加与删除"></a>添加与删除</h4><p><strong>通过<code>git add</code>把文件添加到暂存区</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;pathspec&gt; ## 添加指定文件或文件夹</span><br></pre></td></tr></table></figure><p><code>pathspec</code>可选项：</p><ul><li>文件名/文件夹名</li><li><code>.</code>：表示所有文件，e.g.<code>git add .</code>添加所有文件</li></ul><p>项目中常有自动生成的缓存与临时文件等等，这些文件不必使用<code>git</code>进行管理，避免资源浪费，可借助<code>.gitignore</code>排除这些文件。</p><p>在根目录下（即<code>.git/</code>文件夹相同目录下）创建文件命名为<code>.gitignore</code>，在其中添加排除项，<code>git add</code>时会自动排除他们，具体写法自行百度。</p><p><strong>通过<code>git rm</code>把文件从暂存区中删除</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm &lt;pathspec&gt;</span><br></pre></td></tr></table></figure><h4 id="提交"><a href="#提交" class="headerlink" title="提交"></a>提交</h4><p><strong>通过<code>git commit</code>把暂存区的修改提交到版本库</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &lt;message&gt;</span><br></pre></td></tr></table></figure><p><code>message</code>：本次提交的说明，e.g.<code>&quot;test: add a file&quot;</code></p><h5 id="git提交规范"><a href="#git提交规范" class="headerlink" title="git提交规范"></a>git提交规范</h5><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">type</span>&gt;[optional scope]: &lt;description&gt;</span><br><span class="line"></span><br><span class="line">[optional body]</span><br><span class="line"></span><br><span class="line">[optional footer(s)]</span><br></pre></td></tr></table></figure><p><code>type</code>可选项（常用）：</p><ul><li><code>feat</code>: 添加新功能</li><li><code>fix</code>: 修复bug</li><li><code>docs</code>: 文档相关的修改</li><li><code>refactor</code>: 代码重构</li><li><code>perf</code>: 性能优化</li><li><code>test</code>: 添加或修改测试</li><li><code>revert</code>: 回滚之前的提交</li></ul><p>示例：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">feat(auth): add user login functionality</span><br><span class="line"></span><br><span class="line">Implement user login using OAuth2.<span class="number">0</span> protocol.</span><br><span class="line">This resolves issue #<span class="number">123</span>.</span><br><span class="line"></span><br><span class="line">BREAKING CHANGE: API endpoint <span class="keyword">for</span> user authentication has been changed.</span><br></pre></td></tr></table></figure><h4 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h4><p>通过<code>git restore</code>恢复或撤销文件的更改。</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">restore</span> &lt;options&gt; &lt;pathspec&gt;</span><br></pre></td></tr></table></figure><ul><li><strong><code>&lt;pathspec&gt;</code></strong>：要恢复的文件或目录路径。</li><li><strong><code>&lt;options&gt;</code></strong>：用于定制恢复行为的选项。</li></ul><p><code>options</code>可选项：</p><ul><li><code>-S</code>（<code>--staged</code>）：恢复暂存区的内容，默认使用版本库最近提交（即HEAD）替换暂存区。（只改动<code>staged</code>暂存区内容）</li><li><code>-W</code>（<code>--worktree</code>）：恢复工作区的内容，默认使用暂存区替换工作区。（只改动<code>worktree</code>工作区内容）</li><li><code>-s &lt;tree&gt;</code>（<code>--source=&lt;tree&gt;</code>）：配合1、2使用，指定恢复版本，<code>&lt;tree&gt;</code>可指定提交、分支、标签，e.g.<code>-s HEAD</code>指定最近一次提交</li></ul><p>在<code>git</code>中<code>HEAD</code>表示最近一次提交，<code>HEAD~n</code>表示前<code>n+1</code>个提交，e.g.<code>HEAD~0</code>等价<code>HEAD</code>表示上次提交，<code>HEAD~1</code>表示上上次提交。</p><p>若用贴合版本库名字的版本描述，<code>HEAD</code>为当前版本，<code>HEAD~1</code>为上个版本。</p><h3 id="远程操作"><a href="#远程操作" class="headerlink" title="远程操作"></a>远程操作</h3><h4 id="拉取"><a href="#拉取" class="headerlink" title="拉取"></a>拉取</h4><p><strong>通过<code>git clone</code>第一次从远程<code>Git</code>仓库克隆一个独立的本地仓库</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone &lt;repo&gt;</span><br></pre></td></tr></table></figure><p><code>repo</code>示例：</p><ul><li><code>git@github.com:org/repo.git</code></li><li><code>https://github.com/org/repo.git</code></li></ul><p>使用<code>clone</code>会自动把克隆的那个地址登记成名为<code>origin</code>的远程，以供fetch/pull/push等命令使用</p><p><strong>后续通过<code>git fetch</code>从远程仓库跟踪版本更新</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin</span><br></pre></td></tr></table></figure><p>注：该操作不会更改工作区和暂存区，只会更新版本库中内容，需要使用合并或变基的方式落地这些更新</p><h4 id="推送"><a href="#推送" class="headerlink" title="推送"></a>推送</h4><p><strong>通过<code>git push</code>将本地分支版本（版本库）上传到远程，合并到远程的分支</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push &lt;remote&gt; &lt;local-branch&gt;:&lt;remote-branch&gt;</span><br></pre></td></tr></table></figure><ul><li><strong><code>&lt;remote&gt;</code></strong>：远程名，如<code>origin</code>。</li><li><strong><code>&lt;local-branch&gt;:&lt;remote-branch&gt;</code></strong>：<code>&lt;本地分支名&gt;:&lt;远程分支名&gt;</code>，将本地的某分支推送到远端的某分支。</li></ul><p>若本地分支名与远程分支名相同，则可以省略为<code>git push &lt;remote&gt; &lt;branch&gt;</code></p><p>若<code>push</code>到远端和其他人<code>push</code>的代码产生冲突，需使用<code>git pull</code>将最新版本拉下来同步，解决冲突后重新<code>push</code>。</p><h4 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h4><p><strong>通过<code>git pull</code>从远程拉取分支版本到本地，合并到本地的分支。</strong>（等效于<code>git fetch</code>+<code>git merge</code>）</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull &lt;remote&gt; &lt;remote-branch&gt;:&lt;local-branch&gt;</span><br></pre></td></tr></table></figure><ul><li><strong><code>&lt;remote-branch&gt;:&lt;local-branch&gt;</code></strong>：将远程的某分支同步到本地的某分支。</li></ul><p>若要同步本地当前分支，则可以省略为<code>git pull &lt;remote&gt; &lt;remote-branch&gt;</code></p><p>若同步过程产生冲突，<code>Git</code>会把“冲突标记”直接写到工作区的文件里，使用<code>git status</code>查看哪些文件产生冲突，直接在<code>ide</code>中查看该文件并解决冲突（合并或取舍），解决后重新<code>add</code>、<code>commit</code>、<code>push</code>。</p><p>合并（merge）常让提交历史出现分叉、交错。若想把历史整理成一条清晰的直线，可用变基（rebase）：在<code>git pull</code>后加上<code>--rebase</code>，先拉取远端更新，再把你本地尚未推送的提交逐条重放到远端最新提交之上，相当于将远端分支作为新的基底，从而得到线性的提交历史。<br>e.g.<code>git pull --rebase origin main</code><br> <em>提示：<code>rebase</code>会改写提交哈希，别对已被他人基于的公共分支使用</em></p><h3 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h3><h4 id="分支-1"><a href="#分支-1" class="headerlink" title="分支"></a>分支</h4><p><strong>通过<code>git switch</code>创建、切换分支。</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git switch &lt;branch&gt; ## 切换到对应分支</span><br><span class="line">git switch -c &lt;branch&gt; ## 创建并切换到对应分支</span><br></pre></td></tr></table></figure><p><strong>通过<code>git branch</code>管理分支。</strong></p><ul><li><strong>列出</strong>：<code>git branch</code>（本地），<code>git branch -a</code>（含远端）</li><li><strong>创建但不切换</strong>：<code>git branch &lt;branch&gt; [&lt;start-point&gt;]</code></li><li><strong>创建并建立跟踪关系</strong>：<code>git branch --track &lt;local-branch&gt; origin/&lt;remote-branch&gt;</code></li><li><strong>重命名</strong>：<code>git branch -m &lt;old&gt; &lt;new&gt;</code>，重命名当前分支可省略<code>&lt;old&gt;</code></li><li><strong>删除</strong>：<code>git branch -d &lt;branch&gt;</code>，未合并的分支需要通过强制删除：<code>git branch -D &lt;branch&gt;</code></li></ul><h4 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h4><p><strong>通过<code>git status</code>查看当前仓库状态</strong></p><p>查看有哪些改动、哪些已暂存、哪些未暂存、哪些未跟踪、有没有冲突、分支与远端的关系等。</p><h2 id="git进阶操作"><a href="#git进阶操作" class="headerlink" title="git进阶操作"></a>git进阶操作</h2><p><strong>通过<code>git stash</code>储存工作现场</strong></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git stash</span><br><span class="line">Saved working directory and index state WIP on dev: f52c633 add merge</span><br></pre></td></tr></table></figure><p>用<code>git stash list</code>查看保存的工作现场</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git stash list</span><br><span class="line">stash@&#123;<span class="number">0</span>&#125;: WIP on dev: f52c633 add merge</span><br></pre></td></tr></table></figure><p>仅有一个工作现场时</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git stash apply #恢复现场</span><br><span class="line">$ git stash drop #删除stash中的内容</span><br><span class="line">$ git stash pop #恢复现场的同时删除stash中内容</span><br></pre></td></tr></table></figure><p>多个工作现场时，附带需要恢复的编号</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git stash pop stash@&#123;<span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 大冒险 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 笔记 </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
